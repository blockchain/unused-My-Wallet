function precisionToSatoshiBN(a){return Bitcoin.Util.parseValue(a).divide(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)).toString()))}function precisionToBTC(a){return Bitcoin.Util.formatValue(precisionToSatoshiBN(a))}function precisionFromBTC(a){return Bitcoin.Util.formatValue(Bitcoin.Util.parseValue(a).multiply(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)))))}function formatPrecision(a){return formatBTC(precisionToSatoshiBN(a).toString())}var MyWallet=new function(){var h=this;this.skip_init=false;var D="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var ag;var M;var j;var aD;var ai;var w;var d;var au=0;var Q=0;var ao=0;var K=0;var aN=0;var aB;var g={};var E=[];var F=false;var ar=0;var an=0;var ax=1000;var I={};var av;var ak;var x=0.5;var ad=10;var b={};var aI=0;var q;var S;var W=[];var B;var N=60000;var A=false;var X;var am=false;var V="en";var s={pbkdf2_iterations:10,fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false};this.setEncryptedWalletData=function(aP){if(!aP||aP.length==0){ag=null;av=null;return}ag=aP;av=ae();try{if(aI==0||s.always_keep_local_backup){localStorage.setItem("payload",ag)}}catch(aQ){console.log(aQ)}};this.setRealAuthType=function(aP){aI=aP};this.getLanguage=function(){return V};this.addEventListener=function(aP){W.push(aP)};this.getLogoutTime=function(){return s.logout_time};this.getDefaultPbkdf2Iterations=function(){return ad};this.getPbkdf2Iterations=function(){return s.pbkdf2_iterations};this.setLogoutTime=function(aP){s.logout_time=aP;clearInterval(S);S=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return F};this.getEncryptedWalletData=function(){return ag};this.getFeePolicy=function(){return s.fee_policy};this.setFeePolicy=function(aP){s.fee_policy=parseInt(aP)};this.setAlwaysKeepLocalBackup=function(aP){s.always_keep_local_backup=aP};this.getAlwaysKeepLocalBackup=function(){return s.always_keep_local_backup};this.getGuid=function(){return M};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aP){s.html5_notifications=aP};this.getTransactions=function(){return E};this.addressExists=function(aP){return I[aP]!=null};this.getAddressTag=function(aP){return I[aP].tag};this.setAddressTag=function(aQ,aP){I[aQ].tag=aP};this.getAddressBook=function(){return g};this.getAddressLabel=function(aP){return I[aP].label};this.setAddressLabel=function(aP,aQ){I[aP].label=aQ};this.setAddressBalance=function(aP,aQ){I[aP].balance=aQ};this.getAddressBookLabel=function(aP){return g[aP]};this.isWatchOnly=function(aP){return !I[aP]||I[aP].priv==null};this.getAddressBalance=function(aP){return I[aP].balance};this.getMixerFee=function(){return x};this.deleteAddress=function(aP){delete I[aP]};this.addAddressBookEntry=function(aQ,aP){g[aQ]=aP};this.getPrivateKey=function(aP){return I[aP].priv};this.setLabel=function(aP,aQ){I[aP].label=aQ;af();c()};this.securePost=function(aQ,aR,aS,aP){var aT=jQuery.extend({},aR);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aT.sharedKey=d;aT.guid=M;aT.format=aR.format?aR.format:"plain";$.ajax({dataType:aR.format?aR.format:"text",type:"POST",url:root+aQ,data:aT,success:function(aU){aS(aU)},error:function(aU){aP(aU)}})};this.isCorrectMainPassword=function(aP){return aD==aP};function ab(aQ,aS){var aP=Crypto.SHA256(aQ,{asBytes:true});for(var aR=1;aR<aS;++aR){aP=Crypto.SHA256(aP,{asBytes:true})}return Crypto.util.bytesToHex(aP)}this.setPbkdf2Iterations=function(aP,aR){var aQ=function(aS){console.log("Panic "+aS)};h.getSecondPassword(function(){try{if(F){try{for(var aS in I){var aU=I[aS];if(aU.priv){aU.priv=h.encrypt(h.decryptPK(aU.priv),d+ai,aP);if(!aU.priv){throw"addr.priv is null"}}}s.pbkdf2_iterations=aP;w=ab(d+ai,s.pbkdf2_iterations);h.checkAllKeys();h.backupWallet("update",function(){aR()},function(){aQ(aT)})}catch(aT){aQ(aT)}}else{h.backupWallet("update",function(){aR()},function(){aQ(aT)})}}catch(aT){aQ(aT)}},function(aS){aQ(aS)})};this.setDoubleEncryption=function(aR,aP,aT){var aQ=function(aU){console.log("Panic "+aU);window.location.reload()};try{if(F==aR){return}if(aR){h.getSecondPassword(function(){try{F=true;ai=aP;for(var aU in I){var aW=I[aU];if(aW.priv){aW.priv=i(B58.decode(aW.priv));if(!aW.priv){throw"addr.priv is null"}}}w=ab(d+ai,s.pbkdf2_iterations);ai=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){aT()},function(){aQ(aX)})}catch(aX){aQ(aX)}},function(aX){aQ(aX)})}catch(aV){aQ(aV)}},function(aU){aQ(aU)})}else{h.getSecondPassword(function(){try{for(var aU in I){var aW=I[aU];if(aW.priv){aW.priv=h.decryptPK(aW.priv);if(!aW.priv){throw"addr.priv is null"}}}F=false;ai=null;h.checkAllKeys();h.backupWallet("update",function(){aT()},function(){aQ(aV)})}catch(aV){aQ(aV)}},function(aU){aQ(aU)})}}catch(aS){aQ(aS)}};this.unArchiveAddr=function(aP){var aP=I[aP];if(aP.tag==2){aP.tag=null;c();af("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aP){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aP=I[aP];if(aP.tag==null||aP.tag==0){aP.tag=2;c();af("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};this.addWatchOnlyAddress=function(aP){return aL(aP)};this.addPrivateKey=function(aP,aR){if(ah()){return false}if(aP==null){throw"Cannot add null key."}if(aR==null){aR={}}var aU=aR.compressed?aP.getBitcoinAddressCompressed().toString():aP.getBitcoinAddress().toString();var aT=i(aP.priv);if(aT==null){throw"Error Encoding key"}var aQ=new Bitcoin.ECKey(h.decodePK(aT));if(aU!=aQ.getBitcoinAddress().toString()&&aU!=aQ.getBitcoinAddressCompressed().toString()){throw"Decoded Key address does not match generated address"}if(aL(aU,aT)){I[aU].tag=1;I[aU].created_time=aR.created_time?aR.created_time:0;I[aU].created_device_name=aR.app_name?aR.app_name:APP_NAME;I[aU].created_device_version=aR.app_version?aR.app_version:APP_VERSION;if(I[aU].priv!=aT){throw"Address priv does not match encoded"}try{ws.send('{"op":"addr_sub", "addr":"'+aU+'"}')}catch(aS){}}else{throw"Unable to add generated bitcoin address."}return aU};this._seed=function(aR){rng_seed_time();if(aD||aR){var aP=Crypto.util.bytesToWords(Crypto.SHA256(aD?aD:aR,{asBytes:true}));for(var aQ in aP){rng_seed_int(aP[aQ])}}if(!X){X=$("body").data("extra-seed")}if(X){var aP=Crypto.util.bytesToWords(Crypto.util.hexToBytes(X));for(var aQ in aP){rng_seed_int(aP[aQ])}}};this.generateNewKey=function(aQ){this._seed(aQ);var aP=new Bitcoin.ECKey(false);if(h.addPrivateKey(aP)){return aP}};this.setLoadingText=function(aP){$(".loading-text").text(aP)};function L(){try{$(".popover").remove()}catch(aP){}}$(window).resize(function(){$(".modal:visible").center();L()});function aK(aQ,aP){aQ.click(function(){z(aP.txIndex,aP.result)});aQ.find(".show-note").mouseover(function(){var aR=aP.note?aP.note:b[aP.hash];aF(this,aR,aP.hash)});aQ.find(".add-note").mouseover(function(){m(this,aP.hash)});return aQ}function t(aQ,aW){var aP=0;for(var aS=0;aS<aQ.inputs.length;++aS){var aR=aQ.inputs[aS].prev_out;if(!aR||!aR.addr){continue}var aV=I[aR.addr];if(aV){var aU=parseInt(aR.value);aP-=aU;if(aW){Q+=aU;aV.balance-=aU}}}for(var aT=0;aT<aQ.out.length;++aT){var aR=aQ.out[aT];if(!aR||!aR.addr){continue}var aV=I[aR.addr];if(aV){var aU=parseInt(aR.value);aP+=aU;if(aW){ao+=aU;aV.balance+=aU}}}return aP}function ae(){return Crypto.util.bytesToHex(Crypto.SHA256(ag,{asBytes:true}))}function y(aP){aP.onmessage=function(aX){try{var aU=$.parseJSON(aX.data);if(aU.op=="on_change"){var aY=ae();var aW=aU.checksum;console.log("On change old "+aY+" ==  new "+aW);if(aY!=aW){setTimeout(J,150)}}else{if(aU.op=="utx"){var aV=TransactionFromJSON(aU.x);for(var a0 in E){if(E[a0].txIndex==aV.txIndex){return}}var a2=t(aV,true);if(h.getHTML5Notifications()){var aT=function(a3){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(a3.iconUrl,a3.title,a3.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()=="granted"){new Notification(a3.title,a3).show()}}}}catch(a4){}};try{aT({title:a2>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(a2),iconUrl:resource+"cube48.png"})}catch(aX){console.log(aX)}}aV.result=a2;au+=a2;K++;aV.setConfirmations(0);playSound("beep");if(an==0&&ar==0){E.unshift(aV);var aZ=false;if(E.length>50){E.pop();aZ=true}}var aR=T();if("my-transactions"==aR){if(an==0&&ar==0){$("#no-transactions").hide();if(s.tx_display==0){var aQ=$("#transactions-compact").show();aK($(C(aV,I,g)),aV).prependTo(aQ.find("tbody")).find("div").hide().slideDown("slow");if(aZ){aQ.find("tbody tr:last-child").remove()}}else{var aQ=$("#transactions-detailed").show();aQ.prepend(aV.getHTML(I,g));if(aZ){aQ.find("div:last-child").remove()}setupSymbolToggle()}}}else{c()}}else{if(aU.op=="block"){for(var aS=0;aS<aU.x.txIndexes.length;++aS){for(var a1=0;a1<E.length;++a1){if(E[a1].txIndex==aU.x.txIndexes[aS]){if(E[a1].blockHeight==null||E[a1].blockHeight==0){E[a1].blockHeight=aU.x.height;break}}}}at(BlockFromJSON(aU.x));U()}}}}catch(aX){console.log(aX);console.log(aX.data)}};aP.onopen=function(){ap("ok");var aT='{"op":"blocks_sub"}';if(M!=null){aT+='{"op":"wallet_sub","guid":"'+M+'"}'}try{var aR=h.getActiveAddresses();for(var aQ in aR){aT+='{"op":"addr_sub", "addr":"'+aR[aQ]+'"}'}}catch(aS){alert(aS)}aP.send(aT)};aP.onclose=function(){ap("error")}}var aJ="ok";function ap(aQ){var aP=$("#logout");if(aQ=="loading_start"){aP.attr("src",resource+"logout-orange.png");return}else{if(aQ!="loading_stop"){aJ=aQ}}if(aJ=="ok"){aP.attr("src",resource+"logout.png")}else{if(aJ=="error"){aP.attr("src",resource+"logout-red.png")}}}this.makeNotice=function(aQ,aT,aS,aR){if(aS==null||aS.length==0){return}console.log(aS);if(aR==null){aR=5000}var aP=$('<div class="alert alert-block alert-'+aQ+'"></div>');aP.text(""+aS);if($("#"+aT).length>0){aP.attr("id",aT);return}$("#notices").append(aP).hide().fadeIn(200);if(aR>0){(function(){var aU=aP;setTimeout(function(){aU.fadeOut(250,function(){$(this).remove()})},aR)})()}};this.pkBytesToSipa=function(aP,aT){var aQ=new Bitcoin.ECKey(aP);while(aP.length<32){aP.unshift(0)}aP.unshift(128);if(aQ.getBitcoinAddress().toString()==aT){}else{if(aQ.getBitcoinAddressCompressed().toString()==aT){aP.push(1)}else{throw"Private Key does not match bitcoin address"+aT}}var aR=Crypto.SHA256(Crypto.SHA256(aP,{asBytes:true}),{asBytes:true});aP=aP.concat(aR.slice(0,4));var aS=B58.encode(aP);return aS};function aA(aP){return aP}function aq(aP){return h.decryptPK(aP)}function Z(aP){var aQ=h.decodePK(aP);return Crypto.util.bytesToBase64(aQ)}function k(aP){var aQ=h.decodePK(aP);return Crypto.util.bytesToHex(aQ)}this.base58ToSipa=function(aP,aQ){return h.pkBytesToSipa(h.decodePK(aP),aQ)};this.makeWalletJSON=function(aP){return h.makeCustomWalletJSON(aP,M,d)};this.makeCustomWalletJSON=function(aU,aQ,aW){var aT=aA;if(aU=="base64"){aT=Z}else{if(aU=="hex"){aT=k}else{if(aU=="sipa"){aT=h.base58ToSipa}else{if(aU=="base58"){aT=aq}}}}var aP='{\n	"guid" : "'+aQ+'",\n	"sharedKey" : "'+aW+'",\n';if(F&&w!=null&&aT==aA){aP+='	"double_encryption" : '+F+',\n	"dpasswordhash" : "'+w+'",\n'}if(s){aP+='	"options" : '+JSON.stringify(s)+",\n"}aP+='	"keys" : [\n';for(var aS in I){var aV=$.extend({},I[aS]);if(aV.priv!=null){aV.priv=aT(aV.priv,aV.addr)}for(var aR in aV){if(aV[aR]===null||aV[aR]===undefined){delete aV[aR]}}delete aV.balance;aP+=JSON.stringify(aV)+",\n";atLeastOne=true}if(atLeastOne){aP=aP.substring(0,aP.length-2)}aP+="\n	]";if(az(g)>0){aP+=',\n	"address_book" : [\n';for(var aS in g){aP+='	{"addr" : "'+aS+'",\n';aP+='	 "label" : "'+g[aS]+'"},\n'}aP=aP.substring(0,aP.length-2);aP+="\n	]"}if(az(b)>0){aP+=',\n	"tx_notes" : '+JSON.stringify(b)}aP+="\n}";return aP};this.get_history=function(aQ,aP){BlockchainAPI.get_history(function(aR){H(aR,false);c();if(aQ){aQ()}},function(){if(aP){aP()}},an,ar)};this.deleteAddressBook=function(aP){delete g[aP];af();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aP){$("#send-coins").find(".tab-pane.active").trigger("show",aP);if(aP){BlockchainAPI.get_ticker();$(".send").prop("disabled",false)}}function l(aP,aQ,aU){var aT=aP.val();aP.empty();for(var aS in I){var aV=I[aS];if(!aV||aV.tag==2){continue}var aR=aV.label;if(!aR){aR=aV.addr.substring(0,15)+"..."}if(aQ||aV.balance>0){aP.prepend('<option value="'+aV.addr+'">'+aR+" - "+formatBTC(aV.balance)+"</option>")}}aP.prepend('<option value="any" selected>Any Address</option>');if(!aU&&aT){aP.val(aT)}}function r(aR,aS){l(aR.find('select[name="from"]'),false,aS);l(aR.find('select[name="change"]'),true,aS);aR.find('select[name="change"]').prepend('<option value="new">New Address</option>');aR.find(".local-symbol").text(symbol_local.symbol);aR.find(".btc-symbol").text(symbol_btc.symbol);if(aS){aR.find("input").val("");aR.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aR.find(".amount-needed").text(0)}var aQ=aR.find(".recipient-container");if(aS){var aU=aQ.find(".recipient:first-child").clone();aQ.empty().append(aU)}function aP(){var aV=BigInteger.ZERO;aR.find('input[name="send-value"]').each(function(){aV=aV.add(precisionToSatoshiBN($(this).val()))});return aV}function aT(aV){aV.find('input[name="send-to-address"]').val("").typeahead({source:aw()}).next().click(function(){var aW=$(this).prev();h.scanQRCode(function(aX){console.log(aX);try{new Bitcoin.Address(aX);aW.val(aX)}catch(aY){loadScript("wallet/jsuri-1.1.1",function(){try{var aZ=new Uri(aX);aW.val(aZ.host());aV.find('input[name="send-value"]').val(aZ.getQueryParamValue("amount"))}catch(a0){h.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){h.makeNotice("error","error","Invalid Bitcoin Address or URI")})}},function(aX){h.makeNotice("error","misc-error",aX)})});aV.find('input[name="send-value"]').val("").bind("keyup change",function(aW){if(aW.keyCode=="9"){return}aR.find(".amount-needed").text(formatBTC(aP().toString()));aV.find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});aV.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aW){if(aW.keyCode=="9"){return}aV.find('input[name="send-value"]').val(formatSatoshi(parseFloat($(this).val())*symbol_local.conversion,sShift(symbol_btc),true))})}aQ.find(".recipient").each(function(){aT($(this))});aR.find(".remove-recipient").unbind().click(function(){var aV=aQ.find(".recipient").length;if(aV>1){if(aV==2){$(this).hide(200)}aQ.find(".recipient:last-child").remove()}});aR.find(".add-recipient").unbind().click(function(){var aV=aQ.find(".recipient:first-child").clone();aV.appendTo(aQ);aT(aV);aR.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aQ=[];for(var aP in I){aQ.push(aP)}return aQ};this.getPreferredAddress=function(){var aQ=null;for(var aP in I){var aR=I[aP];if(aQ==null){aQ=aR}if(aR.priv!=null){if(aQ==null){aQ=aR}if(aR.tag==null||aR.tag==0){aQ=aR;break}}}return aQ.addr};function aM(){console.log("backupInstructionsModal");var aP=$("#restore-backup-modal");aP.modal({keyboard:true,backdrop:"static",show:true});aP.find(".btn.btn-secondary").unbind().click(function(){aP.modal("hide")})}this.scanQRCode=function(aR,aP){var aQ=$("#qr-code-reader-modal");aQ.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader",function(){QRCodeReader.init(aQ,function(aS){aQ.modal("hide");aR(aS)},function(aS){aQ.modal("hide");aP(aS)})},aP);aQ.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();aQ.modal("hide");aP()})};this.getActiveAddresses=function(){var aR=[];for(var aP in I){var aQ=I[aP];if(aQ.tag!=2){aR.push(aQ.addr)}}return aR};this.getArchivedAddresses=function(){var aR=[];for(var aP in I){var aQ=I[aP];if(aQ.tag==2){aR.push(aQ.addr)}}return aR};function at(aS){if(aS!=null){aB=aS;for(var aQ in E){var aP=E[aQ];if(aP.blockHeight!=null&&aP.blockHeight>0){var aR=aB.height-aP.blockHeight+1;if(aR<=100){aP.setConfirmations(aB.height-aP.blockHeight+1)}else{aP.setConfirmations(null)}}else{aP.setConfirmations(0)}}}}function z(aQ,aP){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aQ+"?result="+aP+"&guid="+M})})}this.deleteNote=function(aP){delete b[aP];c();af()};function m(aP,aQ){(function(aS,aU){aS=$(aS);if(!aS.data("popover")){aS.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aS.data("popover").tip().is(":visible")){return}}aS.popover("show");aS.mouseleave(function(){if(!aS.__timeout){aS.__timeout=setTimeout(function(){aS.popover("hide")},250)}});function aR(){if(aS.__timeout){clearTimeout(aS.__timeout);aS.__timeout=null}}var aT=aS.data("popover").tip().mouseenter(aR);aT.find("textarea").focus(aR);aT.mouseleave(function(){aS.__timeout=setTimeout(function(){aS.popover("hide")},250)});aT.find("i").unbind().click(function(){aS.popover("hide")});aT.find("button").click(function(){var aV=stripHTML(aT.find("textarea").val()).replace(/'/g,"").replace(/"/g,"");if(aV.length>0){b[aU]=aV;af()}c()})})(aP,aQ)}function aF(aP,aQ,aR){(function(aS,aT,aV){aS=$(aS);if(!aS.data("popover")){var aW="Note";if(b[aV]){aW+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aS).popover({title:aW,trigger:"manual",content:aT})}else{if(aS.data("popover").tip().is(":visible")){return}}aS.popover("show");aS.mouseleave(function(){if(!aS.__timeout){aS.__timeout=setTimeout(function(){aS.popover("hide")},250)}});var aU=aS.data("popover").tip().mouseenter(function(){if(aS.__timeout){clearTimeout(aS.__timeout);aS.__timeout=null}});aU.find("img").unbind().click(function(){h.deleteNote(aV)});aU.mouseleave(function(){aS.__timeout=setTimeout(function(){aS.popover("hide")},250)})})(aP,aQ,aR)}function C(aS,aX,aU){var aY=aS.result;var aT='<tr class="pointer" id="tx-'+aS.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aQ=true;if(aY>=0){for(var aR=0;aR<aS.inputs.length;++aR){var aP=aS.inputs[aR].prev_out;if(!aP||!aP.addr){aQ=false;aT+='<span class="label">Newly Generated Coins</span>'}else{var aV=aX[aP.addr];if(aV){continue}aQ=false;aT+=formatOutput(aP,aX,aU)}}}else{if(aY<0){for(var aR=0;aR<aS.out.length;++aR){var aP=aS.out[aR];var aV=aX[aP.addr];if(aV&&aP.type==0){continue}aQ=false;aT+=formatOutput(aP,aX,aU)}}}if(aQ){aT+='<span class="label">Moved Between Wallet</info>'}aT+="</ul></div></td><td><div>";var aW=aS.note?aS.note:b[aS.hash];if(aW){aT+='<img src="'+resource+'note.png" class="show-note"> '}else{aT+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(aS.time>0){aT+=dateToString(new Date(aS.time*1000))}if(aS.confirmations==0){aT+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aS.confirmations>0){aT+=' <span class="label label-info pull-right hidden-phone">'+aS.confirmations+" Confirmations</span> "}}aT+="</div></td>";if(aY>0){aT+='<td style="color:green"><div>'+formatMoney(aY,true)+"</div></td>"}else{if(aY<0){aT+='<td style="color:red"><div>'+formatMoney(aY,true)+"</div></td>"}else{aT+="<td><div>"+formatMoney(aY,true)+"</div></td>"}}if(aS.balance==null){aT+="<td></td></tr>"}else{aT+='<td class="hidden-phone"><div>'+formatMoney(aS.balance)+"</div></td></tr>"}return aT}function T(){L();if(au==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(au,symbol,true));$("#balance2").html(formatSymbol(au,(symbol===symbol_local)?symbol_btc:symbol_local),true)}return j.attr("id")}function c(aP){var aQ=T();if("send-coins"==aQ){u(aP)}else{if("home-intro"==aQ){f(aP)}else{if("receive-coins"==aQ){aO(aP)}else{if("my-transactions"==aQ){U(aP)}}}}}function f(aP){$("#summary-n-tx").html(K);$("#summary-received").html(formatMoney(ao,true));$("#summary-sent").html(formatMoney(Q,true));$("#summary-balance").html(formatMoney(au,symbol));var aR=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aR+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});$(".paper-wallet-btn").unbind().click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showModal()})});if(h.isWatchOnly(aR)){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aQ=$("#my-primary-address");if(aQ.text()!=aR){aQ.text(aR);loadScript("wallet/jquery.qrcode",function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:aR})})}}}function R(){var aP=$("#export-warning").show();var aQ=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aP.hide();loadScript("wallet/import-export",function(){ImportExport.init(aQ,function(){aQ.show()},function(){ac($("#home-intro"))})},function(aR){h.makeNotice("error","misc-error",aR);ac($("#home-intro"))})},function(){ac($("#home-intro"))})})}function U(){var aQ=null;var aS=0;if(aQ!=null){clearInterval(aQ);aQ=null}var aP;if(s.tx_display==0){$("#transactions-detailed").hide();aP=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aP=$("#transactions-detailed").empty().show()}if(E.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aR=function(){for(var aW=aS;aW<E.length&&aW<(aS+10);++aW){var aV=E[aW];if(s.tx_display==0){aP.append(aK($(C(aV,I,g)),aV))}else{aP.append(aV.getHTML(I,g))}}aS+=10;if(aS<E.length){aQ=setTimeout(aR,15)}else{setupSymbolToggle();L();var aU=$(".pagination ul").empty();if(ar==0&&E.length<50){aU.hide();return}else{aU.show()}var aT=Math.ceil(aN/50);var aX=" disabled";if(ar>0){aX=""}aU.append($('<li class="prev'+aX+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(ar-1)}));for(var aW=0;aW<aT&&aW<=10;++aW){(function(aY){var aZ="";if(ar==aY){aZ=' class="active"'}aU.append($("<li"+aZ+'><a class="hidden-phone">'+aY+"</a></li>").click(function(){h.setPage(aY)}))})(aW)}var aX=" disabled";if(ar<aT){aX=""}aU.append($('<li class="next'+aX+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(ar+1)}))}};aR()}this.setPage=function(aP){ar=aP;scroll(0,0);h.get_history()};function v(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})}function H(aS,aR){if(!aR&&aS.mixer_fee){x=aS.mixer_fee}if(aS.disable_mixer){$("#shared-addresses,#send-shared").hide()}E.length=0;if(aS.wallet==null){ao=0;Q=0;au=0;K=0;aN=0;return}ao=aS.wallet.total_received;Q=aS.wallet.total_sent;au=aS.wallet.final_balance;K=aS.wallet.n_tx;aN=aS.wallet.n_tx_filtered;for(var aQ=0;aQ<aS.addresses.length;++aQ){if(I[aS.addresses[aQ].address]){I[aS.addresses[aQ].address].balance=aS.addresses[aQ].final_balance}}for(var aQ=0;aQ<aS.txs.length;++aQ){var aP=TransactionFromJSON(aS.txs[aQ]);aP.result=t(aP,false);E.push(aP)}if(aS.info){$("#nodes-connected").html(aS.info.nconnected);if(aS.info.latest_block){at(aS.info.latest_block)}if(aS.info.symbol_local){setLocalSymbol(aS.info.symbol_local)}if(aS.info.symbol_btc){setBTCSymbol(aS.info.symbol_btc)}}}function aG(){S=setTimeout(h.logout,h.getLogoutTime());for(var aQ in W){W[aQ]("did_decrypt")}window.location.hash="";try{var aP=localStorage.getItem("multiaddr");if(aP!=null){H($.parseJSON(aP),true);c()}}catch(aR){}h.get_history();ac($("#home-intro"));$("#initial_error,#initial_success").remove()}function J(aS,aP){for(var aQ in I){var aT=I[aQ];if(aT.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have un-saved keys");return}}console.log("Get wallet with checksum "+av);var aR={guid:M,sharedKey:d,format:"plain"};if(av&&av.length>0){aR.checksum=av}$.ajax({type:"GET",url:root+"wallet/wallet.aes.json",data:aR,success:function(aU){if(aU==null||aU.length==0||aU=="Not modified"){if(aS){aS()}return}console.log("Wallet data modified");h.setEncryptedWalletData(aU);if(Y()){h.get_history();c();if(aS){aS()}}else{window.location.reload();if(aP){aP()}}},error:function(){if(aP){aP()}}})}function Y(){try{if(ag==null||ag.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aS=null;h.decrypt(ag,aD,h.getDefaultPbkdf2Iterations(),function(aT){try{aS=$.parseJSON(aT);return(aS!=null)}catch(aU){return false}});if(aS==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aS.double_encryption&&aS.dpasswordhash){F=aS.double_encryption;w=aS.dpasswordhash}if(aS.options){$.extend(s,aS.options)}I={};for(var aQ=0;aQ<aS.keys.length;++aQ){var aP=aS.keys[aQ];if(aP.addr==null||aP.addr.length==0||aP.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}if(aP.tag==1){aP.tag=null}I[aP.addr]=aP}g={};if(aS.address_book){for(var aQ=0;aQ<aS.address_book.length;++aQ){h.addAddressBookEntry(aS.address_book[aQ].addr,aS.address_book[aQ].label)}}if(aS.tx_notes){b=aS.tx_notes}d=aS.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(av==null||av.length==0){av=ae()}J();e();return true}catch(aR){h.makeNotice("error","misc-error",aR)}return false}this.getPassword=function(aU,aV,aS){if(!aU.is(":visible")){aU.trigger("hidden");aU.unbind()}aU.modal({keyboard:false,backdrop:"static",show:true});aU.center();var aT=aU.find('input[name="password"]');var aX=aT,aP=false,aW=false;aU.find(".vkeyboard li").unbind().click(function(){var a0=$(this),aZ=a0.html();if(a0.hasClass("left-shift")||a0.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aP=(aP===true)?false:true;aW=false;return false}if(a0.hasClass("capslock")){$(".letter").toggleClass("uppercase");aW=true;return false}if(a0.hasClass("delete")){var aY=aX.val();aX.val(aY.substr(0,aY.length-1));return false}if(a0.hasClass("symbol")){aZ=$("span:visible",a0).html()}if(a0.hasClass("space")){aZ=" "}if(a0.hasClass("tab")){aZ="\t"}if(a0.hasClass("return")){aZ="\n"}if(a0.hasClass("uppercase")){aZ=aZ.toUpperCase()}if(aP===true){$(".symbol span").toggle();if(aW===false){$(".letter").toggleClass("uppercase")}aP=false}aX.val(aX.val()+aZ)});aT.keypress(function(aY){if(aY.keyCode==13){aY.preventDefault();aU.find(".btn.btn-primary").click()}});aT.val("");var aQ=aU.find(".btn.btn-primary");aQ.click(function(){if(aV){aS=null;var aY=aV;aV=null;setTimeout(function(){aU.modal("hide");aY(aT.val())},10)}else{aU.modal("hide")}});var aR=aU.find(".btn.btn-secondary");aR.click(function(){if(aS){var aY=aS;aS=null;aV=null;setTimeout(function(){aU.modal("hide");try{aY()}catch(aZ){h.makeNotice("error","misc-error",aZ)}},10)}else{aU.modal("hide")}});aU.on("hidden",function(){aT.unbind();aR.unbind();aQ.unbind();aU.unbind();if(aS){var aY=aS;aS=null;aV=null;setTimeout(function(){try{aY()}catch(aZ){h.makeNotice("error","misc-error",aZ)}},10)}})};this.makePairingQRCode=function(aQ,aP){h.getMainPassword(function(){loadScript("wallet/jquery.qrcode",function(){try{if(aP==1){h.securePost("wallet",{method:"pairing-encryption-password"},function(aS){aQ($("<div></div>").qrcode({width:300,height:300,text:"1|"+M+"|"+h.encrypt(d+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(aD)),aS,ad)}))},function(aS){h.makeNotice("error","misc-error",aS)})}else{if(aP==0){aQ($("<div></div>").qrcode({width:300,height:300,text:M+"|"+d+"|"+aD}))}}}catch(aR){h.makeNotice("error","misc-error",aR)}})},function(){h.logout()})};this.getMainPassword=function(aQ,aP){if(B>new Date().getTime()-N){return aQ(aD)}h.getPassword($("#main-password-modal"),function(aR){if(aD==aR){B=new Date().getTime();if(aQ){try{aQ(aD)}catch(aS){h.makeNotice("error","misc-error",aS)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aP){try{aP()}catch(aS){h.makeNotice("error","misc-error",aS)}}}},aP)};this.getSecondPassword=function(aR,aP){if(!F||ai!=null){if(aR){try{aR(ai)}catch(aQ){h.makeNotice("error","misc-error",aQ)}}return}h.getPassword($("#second-password-modal"),function(aS){try{if(aE(aS)){if(aR){try{aR(aS)}catch(aT){console.log(aT);h.makeNotice("error","misc-error",aT)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aP){try{aP()}catch(aT){h.makeNotice("error","misc-error",aT)}}}}catch(aT){if(aP){try{aP()}catch(aT){h.makeNotice("error","misc-error",aT)}}}},aP)};function a(){if(A){return}var aP=$("#restore-password");aD=aP.val();aP.val("");B=new Date().getTime();if(ag==null||ag.length==0){h.setLoadingText("Validating Authentication key");var aQ=$.trim($(".auth-"+q).find(".code").val());if(aQ.length==0||aQ.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.ajax({type:"POST",url:root+"wallet",data:{guid:M,payload:aQ,length:aQ.length,method:"get-wallet",format:"plain"},success:function(aR){try{if(aR==null||aR.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}h.setEncryptedWalletData(aR);$(".auth-"+q).hide();$(".auth-0").show();if(Y()){n();aG()}}catch(aS){h.makeNotice("error","misc-error",aS)}},error:function(aR){h.makeNotice("error","misc-error",aR.responseText)}})}else{if(Y()){n();aG()}}return true}function O(){$("#not-synced-warning-modal").modal("show").find(".btn.btn-danger").unbind().click(function(){$(this).modal("hide");am=true;c()})}function e(){ap("error");webSocketConnect(y);A=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.quickSendNoUI=function(aR,aQ,aP){loadScript("wallet/signer",function(){h.getSecondPassword(function(){try{var aT=initNewTx();aT.from_addresses=h.getActiveAddresses();aT.to_addresses.push({address:new Bitcoin.Address(aR),value:Bitcoin.Util.parseValue(aQ)});aT.addListener(aP);aT.start()}catch(aS){aP.on_error(aS)}},function(aS){aP.on_error(aS)})})};function G(){h.setLoadingText("Sending email backup");$.ajax({type:"POST",url:root+"wallet",data:{guid:M,sharedKey:d,method:"email-backup",format:"plain"},success:function(aP){h.makeNotice("success","backup-success",aP)},error:function(aP){h.makeNotice("error","misc-error",aP.responseText)}})}function af(aS,aR,aQ,aP){if(ak){clearInterval(ak);ak=null}ak=setTimeout(function(){h.backupWallet(aS,aR,aQ,aP)},3000)}this.backupWallet=function(aW,aV,aP){if(ak){clearInterval(ak);ak=null}try{if(aW==null){aW="update"}if(az(I)==0){return}var aR=h.makeWalletJSON();var aU=h.encrypt(aR,aD,ad);if(aU.length==0){throw"Error encrypting the JSON output"}var aT=null;h.decrypt(aU,aD,h.getDefaultPbkdf2Iterations(),function(aX){try{aT=$.parseJSON(aX);return(aT!=null)}catch(aY){return false}});if(aT==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aQ=av;h.setLoadingText("Saving wallet");h.setEncryptedWalletData(aU);$.ajax({type:"POST",url:root+"wallet",data:{guid:M,length:aU.length,payload:aU,sharedKey:d,checksum:av,old_checksum:aQ,method:aW},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aY){var a0=false;for(var aX in I){var aZ=I[aX];if(aZ.tag==1){aZ.tag=null;a0=true}}h.makeNotice("success","misc-success",aY);c();if(aV!=null){aV()}},error:function(aY){for(var aX in I){var aZ=I[aX];if(aZ.tag==1){O();break}}if(aY.responseText==null){h.makeNotice("error","misc-error","Error Saving Wallet",10000)}else{h.makeNotice("error","misc-error",aY.responseText,10000)}c();if(aP!=null){aP()}}})}catch(aS){h.makeNotice("error","misc-error","Error Saving Wallet: "+aS,10000);c();if(aP!=null){aP(aS)}else{throw aS}}};function aH(aP){if(F){if(ai==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aP,d+ai,s.pbkdf2_iterations)}else{return aP}return null}this.isBase58=function(aR,aQ){for(var aP=0;aP<aR.length;++aP){if(aR[aP]<0||aR[aP]>58){return false}}return true};this.encrypt=function(aR,aQ,aP){return Crypto.AES.encrypt(aR,aQ,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aP})};this.decrypt=function(aT,aS,aQ,aV,aR){try{var aP=Crypto.AES.decrypt(aT,aS,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aQ});if(aP!=null&&aP.length>0){if(aV(aP)){return aP}}}catch(aU){console.log(aU)}if(aQ!=10){try{var aP=Crypto.AES.decrypt(aT,aS,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10});if(aP!=null&&aP.length>0){if(aV(aP)){return aP}}}catch(aU){console.log(aU)}}try{var aP=Crypto.AES.decrypt(aT,aS);if(aP!=null&&aP.length>0){if(aV(aP)){return aP}}}catch(aU){console.log(aU)}try{var aP=Crypto.AES.decrypt(aT,aS,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aP!=null&&aP.length>0){if(aV(aP)){return aP}}}catch(aU){console.log(aU)}try{var aP=Crypto.AES.decrypt(aT,aS,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aP!=null&&aP.length>0){if(aV(aP)){return aP}}}catch(aU){console.log(aU)}if(aR!=null){aR()}return null};this.setGUID=function(aS,aQ){console.log("Set GUID "+aS);if(A){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();try{var aP=localStorage.getItem("guid")}catch(aT){}var aR=$("#restore-wallet-continue");aR.prop("disabled",true);$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+aS,data:{format:"json",resend_code:aQ},success:function(aV){aR.prop("disabled",false);$(".auth-"+q).hide();X=aV.extra_seed;M=aV.guid;q=aV.auth_type;aI=aV.real_auth_type;if(aV.language){V=aV.language}h.setEncryptedWalletData(aV.payload);war_checksum=aV.war_checksum;setLocalSymbol(aV.symbol_local);$("#restore-guid").val(M);$(".auth-"+q).show();$(".recover-wallet-btn").prop("disabled",false).click(function(){window.location=root+"wallet/forgot-password?guid="+M});$("#reset-two-factor-btn").prop("disabled",false).show().click(function(){window.location=root+"wallet/reset-two-factor?guid="+M});if(aV.initial_error){h.makeNotice("error","misc-error",aV.initial_error)}if(aV.initial_success){h.makeNotice("success","misc-success",aV.initial_success)}try{if(aP!=M){localStorage.clear();if(M!=D){localStorage.setItem("guid",M)}}}catch(aU){}},error:function(aV){console.log("Set GUID Success");aR.prop("disabled",false);if(aP==aS&&ag){h.makeNotice("error","misc-error","Error Contacting Server. Using Local Wallet Cache.");M=aP;av=ae();q=0;$("#restore-guid").val(M);$(".auth-"+q).show();return}try{var aU=$.parseJSON(aV.responseText);if(aU.initial_error){h.makeNotice("error","misc-error",aU.initial_error);return}}catch(aV){}if(aV.responseText){h.makeNotice("error","misc-error",aV.responseText)}else{h.makeNotice("error","misc-error","Error changing wallet identifier")}}})};function i(aP){var aQ=B58.encode(aP);return aH(aQ)}this.decryptPK=function(aP){if(F){if(ai==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aP,d+ai,s.pbkdf2_iterations,h.isBase58)}else{return aP}return null};this.decodePK=function(aQ){if(!aQ){throw"null PK passed to decodePK"}var aP=h.decryptPK(aQ);if(aP!=null){return B58.decode(aP)}return null};this.signmessage=function(aP,aR){var aT=I[aP];if(!aT.priv){throw"Cannot sign a watch only address"}var aS=h.decodePK(aT.priv);var aQ=new Bitcoin.ECKey(aS);return Bitcoin.Message.signMessage(aQ,aR,aT.addr)};function aE(aQ){var aP=Crypto.SHA256(d+aQ,{asBytes:true});var aT=ab(aP,s.pbkdf2_iterations-1);if(aT==w){ai=aQ;return true}if(s.pbkdf2_iterations!=10){var aR=ab(aP,10-1);if(aR==w){ai=aQ;w=aT;return true}}if(Crypto.util.bytesToHex(aP)==w){ai=aQ;w=aT;return true}var aS=Crypto.SHA256(aQ);if(aS==w){ai=aQ;w=aT;return true}return false}this.checkAllKeys=function(aP){for(var aQ in I){var aU=I[aQ];if(aU.addr==null){throw"Null Address Found in wallet "+aQ}if(aU.addr.toString()==null){throw"Error decoding wallet address "+aU.addr}if(aU.priv!=null){var aT=h.decodePK(aU.priv);var aS=new Bitcoin.ECKey(aT);var aR=aS.getBitcoinAddress().toString();if(aR!=aU.addr&&aS.getBitcoinAddressCompressed().toString()!=aU.addr){throw"Private key does not match bitcoin address "+aU.addr+" != "+aR}if(aP){aU.priv=i(aT)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aP){h.getMainPassword(function(){aD=aP;h.backupWallet("update",function(){h.logout()},function(){h.logout()})})};function ac(aP){if(aP===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aP;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function az(aR){var aQ=0,aP;for(aP in aR){aQ++}return aQ}function aa(aP){I[aP].priv=null}function ah(){if(az(I)>=ax){h.makeNotice("error","misc-error","We currently support a maximum of "+ax+" private keys, please remove some unused ones.");return true}return false}function aL(aR,aP){var aQ=I[aR];if(!aQ||aQ.length==0){I[aR]={addr:aR,priv:aP,balance:0};return true}else{if(!aQ.priv&&aP){aQ.priv=aP;return true}}return false}function o(){var aR=$("#add-address-book-entry-modal");aR.modal({keyboard:true,backdrop:"static",show:true});var aP=aR.find('input[name="label"]');var aQ=aR.find('input[name="address"]');aP.val("");aQ.val("");aR.find(".btn.btn-primary").unbind().click(function(){aR.modal("hide");var aT=stripHTML(aP.val());var aS=stripHTML(aQ.val());if(aT.length==0||aS.length==0){h.makeNotice("error","misc-error","You must enter an address and label for the address book entry");return false}var aV;try{aV=new Bitcoin.Address(aS);if(aV==null){throw"Null address"}}catch(aU){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aS]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aS,aT);af();$("#send-coins").find(".tab-pane").trigger("show",true)});aR.find(".btn.btn-secondary").unbind().click(function(){aR.modal("hide")})}this.logout=function(){if(S){clearTimeout(S)}if(M==D){window.location=root+"wallet/logout"}else{$.ajax({type:"GET",url:root+"wallet/logout",data:{format:"plain"},success:function(aP){window.location.reload()},error:function(){window.location.reload()}})}};function al(aV){var aX=$("#delete-address-modal");aX.modal({keyboard:true,backdrop:"static",show:true});aX.find(".btn.btn-primary").hide();aX.find(".btn.btn-danger").hide();$("#change-mind").hide();aX.find("#to-delete-address").html(aV.join(" "));aX.find("#delete-balance").empty();var aR=aX.find("#delete-balance");var aP=[];for(var aU in aV){var aW=aV[aU];if(I[aW]&&I[aW].priv){aP.push(aV[aU])}}BlockchainAPI.get_balance(aP,function(aY){aX.find(".btn.btn-primary").show(200);aX.find(".btn.btn-danger").show(200);aR.html("Balance "+formatBTC(aY));if(aY>0){aR.css("color","red")}else{aR.css("color","black")}},function(){aX.find(".btn.btn-primary").show(200);aX.find(".btn.btn-danger").show(200);aR.text("Error Fetching Balance")});var aS=false;var aU=0;var aQ=null;var aT=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aT-aU)};aX.find(".btn.btn-primary").unbind().click(function(){changeMind();aX.find(".btn.btn-primary").hide();aX.find(".btn.btn-danger").hide();aQ=setInterval(function(){if(aS){return}++aU;changeMind();if(aU==aT){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aY in aV){aa(aV[aY])}c();h.backupWallet();clearInterval(aQ)}},1000)});aX.find(".btn.btn-danger").unbind().click(function(){changeMind();aX.find(".btn.btn-primary").hide();aX.find(".btn.btn-danger").hide();aQ=setInterval(function(){if(aS){return}++aU;changeMind();if(aU==aT){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aY in aV){h.deleteAddress(aV[aY])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aQ)}}},1000)});aX.unbind().on("hidden",function(){if(aQ){aS=true;clearInterval(aQ);aQ=null}});aX.find(".btn.btn-secondary").unbind().click(function(){aX.modal("hide")})}function aw(){var aR=[];for(var aP in g){aR.push(g[aP])}for(var aP in I){var aQ=I[aP];if(aQ.tag!=2&&aQ.label){aR.push(aQ.label)}}return aR}function P(aP){h.getSecondPassword(function(){var aR=$("#sweep-address-modal");aR.modal("show");BlockchainAPI.get_balance(aP,function(aS){aR.find(".balance").text("Amount: "+formatBTC(aS))},function(){aR.find(".balance").text("Error Fetching Balance")});var aQ=aR.find('select[name="change"]');l(aQ,true);aR.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer",function(){BlockchainAPI.get_balance(aP,function(aS){var aT=initNewTx();aT.fee=aT.base_fee;aT.to_addresses.push({address:new Bitcoin.Address($.trim(aQ.val())),value:BigInteger.valueOf(aS).subtract(aT.fee)});aT.from_addresses=aP;aT.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aR.modal("hide")});aR.find(".btn.btn-secondary").unbind().click(function(){aR.modal("hide")})})}function ay(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aP){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){ac($("#home-intro"))});$("#my-transactions-btn").click(function(){ac($("#my-transactions"))});$("#send-coins-btn").click(function(){ac($("#send-coins"))});$("#import-export-btn").click(function(){ac($("#import-export"));R()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal",function(){verifyMessageModal()})});$("#generate-cold-storage").click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showColdStorageModal()},null,true)});$("#group-received").click(function(){loadScript("wallet/taint_grouping",function(){try{loadTaintData()}catch(aP){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){ac($("#my-account"));var aP=$("#account-settings-warning").show();var aQ=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aP.hide();loadScript("wallet/account",function(){AccountSettings.init(aQ,function(){aQ.show()},function(){ac($("#home-intro"))})},function(aR){h.makeNotice("error","misc-error",aR);ac($("#home-intro"))})},function(){ac($("#home-intro"))})})});$("#enable_archived_checkbox").change(function(){var aP=$(this).is(":checked");$(".archived_checkbox").prop("checked",false);$(".archived_checkbox").prop("disabled",!aP);$("#archived-sweep").prop("disabled",!aP);$("#archived-delete").prop("disabled",!aP)});$("#shared-addresses").on("show",function(){var aP=$(this);loadScript("wallet/shared-addresses",function(){buildSharedTable(aP)})});$("#active-addresses").on("show",function(){var aV=$(this).find("table:first");aV.find("tbody:gt(0)").remove();var aS=aV.find("tbody").empty();for(var aU in I){var aW=I[aU];if(aW.tag==2||(aW.tag==1&&!am)){continue}var aT="";if(aW.tag==1){aT=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aW.priv==null){aT=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aP="";var aR=aW.addr;if(aW.label!=null){aR=aW.label;aP='<span class="hidden-phone"> - '+aW.addr+"</span>"}var aQ=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aW.addr+'" target="new">'+aR+"</a>"+aP+" "+aT+'<div></td><td><span style="color:green">'+formatMoney(aW.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            <li><a href="#" class="pop act-pubkey">Show Public Key</a></li>            </ul></div></td></tr>');(function(aX){aQ.find(".act-archive").click(function(){h.archiveAddr(aX)});aQ.find(".act-label").click(function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(aX)})});aQ.find(".act-qr").click(function(){loadScript("wallet/address_modal",function(){showAddressModalQRCode(aX)})});aQ.find(".act-pubkey").click(function(){h.getSecondPassword(function(){var aY=h.getPrivateKey(aX);if(aY==null){h.makeNotice("eror","misc-error","Public Key Unknown");return}var aZ=new Bitcoin.ECKey(h.decodePK(aY));if(aZ.getBitcoinAddressCompressed().toString()==aX){var a0=aZ.getPubCompressed()}else{var a0=aZ.getPub()}h.makeNotice("success","pub-key","Public Key of "+aX+" is "+Crypto.util.bytesToHex(a0),20000)})});aQ.find(".act-sign").click(function(){loadScript("wallet/address_modal",function(){showAddressModalSignMessage(aX)})});aQ.find(".act-request").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aX+"</b>",src:root+"payment_request?address="+aX})})})})(aW.addr);if(aW.balance>0&&aW.priv){aV.prepend(aQ)}else{aV.append(aQ)}}ay()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").prop("checked",false);$("#archived-delete").prop("disabled",true);$("#archived-sweep").prop("disabled",true);$("#archived-addr tbody").empty();var aQ=$(this).find("tbody");var aP=h.getArchivedAddresses();var aR=function(){aQ.empty();for(var aV in aP){var aX=I[aP[aV]];if(aX.tag!=2||(aX.tag==1&&!am)){continue}var aU="";if(aX.priv==null){aU=' <font color="red">(Watch Only)</font>'}var aS="";var aT=aX.addr;if(aX.label!=null){aT=aX.label;aS='<span class="hidden-phone"> - '+aX.addr+"</span>"}var aW=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aX.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aX.addr+'" target="new">'+aT+"</a>"+aS+" "+aU+'<div></td><td><span style="color:green">'+formatBTC(aX.balance)+'</span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aY){aW.find(".act-unarchive").click(function(){h.unArchiveAddr(aY)})})(aX.addr);if(aX.balance>0&&aX.priv){aQ.prepend(aW)}else{aQ.append(aW)}}};aR();BlockchainAPI.get_balances(aP,function(aS){aR()},function(aS){h.makeNotice("error","misc-error",aS)})});$("#archived-sweep").click(function(){var aP=[];$(".archived_checkbox:checked").each(function(){var aQ=I[$(this).val()];if(aQ.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aP.push(aQ.addr)});if(aP.length==0){return}P(aP)});$("#archived-delete").click(function(){var aP=[];$(".archived_checkbox:checked").each(function(){aP.push($(this).val())});if(aP.length==0){return}al(aP)});$("#shared-never-ask").click(function(){SetCookie("shared-never-ask",$(this).is(":checked"))});$(".bitstamp-btn").click(function(){window.open(root+"r?url=https://www.bitstamp.net/?blockchaininfo=1",null,"scroll=1,status=1,location=1,toolbar=1,width=1000,height=700")});$(".deposit-btn").click(function(){var aR=$(this);var aQ=h.getPreferredAddress();var aP=aR.data("extra");if(aP==null){aP=""}loadScript("wallet/frame-modal",function(){showFrameModal({title:aR.data("title"),description:"Deposit into address <b>"+aQ+"</b>",top_right:'Have Questions? Read <a href="'+aR.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aQ+"&ptype="+aR.data("type")+"&guid="+M+"&sharedKey="+d+aP})})});$(".withdraw-btn").click(function(){var aP=$(this);h.getSecondPassword(function(){var aQ=h.getPreferredAddress();loadScript("wallet/frame-modal",function(){showFrameModal({title:aP.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(au)+"</b>",src:root+"withdraw?method="+aP.data("type")+"&address="+aQ+"&balance="+au+"&guid="+M+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){J();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{J(function(){h.getSecondPassword(function(){var aR=h.generateNewKey();if(!aR){return}var aQ=aR.getBitcoinAddress().toString();h.backupWallet("update",function(){h.makeNotice("info","new-address","Generated new Bitcoin Address "+aQ);loadScript("wallet/address_modal",function(){showLabelAddressModal(aQ)})})})})}catch(aP){h.makeNotice("error","misc-error",aP)}});$(".tx_filter a").click(function(){ar=0;an=$(this).data("value");h.get_history()});$(".tx_display a").click(function(){var aP=$(this).data("value");if(aP=="export"){v();return}s.tx_display=aP;c();af()});$("#email-backup-btn").click(function(){G()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+M+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+M+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aR,aQ){var aP=$(this);r(aP,aQ);aP.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aP,"quick",initNewTx())})})});$("#send-email").on("show",function(aR,aQ){var aP=$(this);r(aP,aQ);aP.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aP,"email",initNewTx())})})});$("#send-shared").on("show",function(aR,aQ){var aP=$(this);r(aP,aQ);aP.find(".mixer_fee").text(x);aP.find(".fees,.free,.bonus").show();if(x<0){aP.find(".fees,.free").hide()}else{if(x==0){aP.find(".fees,.bonus").hide()}else{aP.find(".free,.bonus").hide()}}aP.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aP,"shared",initNewTx())})});aP.find(".shared-fees").text("0.00");aP.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aT=parseFloat($(this).val());var aS=0;if(aT>0){if(x>0){aS=parseFloat(aT+((aT/100)*x))}else{aS=parseFloat(aT);aP.find(".bonus-value").text(formatPrecision((Math.min(aT,precisionFromBTC(200))/100)*x))}}if(precisionToBTC(aT)<0.1||precisionToBTC(aT)>250){aP.find(".shared-fees").text("0.00");aP.find(".send").prop("disabled",true)}else{aP.find(".shared-fees").text(formatBTC(aS*symbol_btc.conversion));aP.find(".send").prop("disabled",false)}aP.find('input[name="send-value"]').val(aS).trigger("keyup")})});$("#send-custom").on("show",function(aR,aQ){var aP=$(this);r(aP,aQ);aP.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aP,"custom",initNewTx())})});aP.find('select[name="from"]').unbind().change(function(){var aU=0;var aS=$(this).val();for(var aT in aS){if(aS[aT]=="any"){$(this).val("any");aU=au;break}else{var aV=I[aS[aT]];if(aV&&aV.balance){aU+=aV.balance}}}aP.find(".amount-available").text(formatBTC(aU))}).trigger("change");aP.find(".reset").unbind().click(function(){r(aP,true);aP.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aR,aQ){var aP=this;loadScript("wallet/dicegames",function(){try{DICEGame.init($(aP))}catch(aS){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aS){h.makeNotice("error","misc-error",aS)})});$("#send-sms").on("show",function(aR,aQ){if(aQ){return}var aP=$(this);r(aP);$.ajax({type:"GET",url:resource+"wallet/country_codes.html",success:function(aS){aP.find('select[name="sms-country-code"]').html(aS)},error:function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aP.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){var aS=initNewTx();startTxUI(aP,"sms",aS)})})});$("#address-book").on("show",function(){var aQ=$("#address-book-tbl tbody");if(az(g)>0){aQ.empty();for(var aP in g){var aR=$("<tr><td>"+g[aP]+'</td><td><div class="addr-book-entry">'+aP+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aS){aR.find(".act-delete").click(function(){h.deleteAddressBook(aS)})})(aP);aQ.append(aR)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aP){$(aP.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){ac($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();ay()}function p(){$(".resend-code").click(function(){h.setGUID(M,true)});$(".download-backup-btn").toggle(ag!=null).click(function(){$(this).attr("download","wallet.aes.json");if(!ag){h.makeNotice("error","error","No Wallet Data to Download");return}var aQ=("download" in document.createElement("a"));if(window.Blob&&window.URL&&aQ){var aR=new Blob([ag]);var aS=window.URL.createObjectURL(aR);$(this).attr("href",aS)}else{var aP=window.open(null,null,"width=700,height=800,toolbar=0");aP.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+ag+"</div></body></html>")}aM()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aP){if(aP.keyCode==13){aP.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aQ){aQ.preventDefault();var aP=$.trim($("#restore-guid").val());if(aP.length==0){return}if(M!=aP){h.setGUID(aP,false)}else{a()}});$(".modal").on("show",function(){L();$(this).center()}).on("shown",function(){L();$(this).center()})}function aj(aQ){var aR=Crypto.SHA256(aQ+"?");switch(aR.slice(0,2)){case"00":var aS=Crypto.SHA256(aQ,{asBytes:true});return aS;break;case"01":var aP=Crypto.util.hexToBytes(aR.slice(2,4))[0];var aT=Math.round(Math.pow(2,(aP/4)));var aS=Crypto.PBKDF2(aQ,"Satoshi Nakamoto",32,{iterations:aT,asBytes:true});return aS;break;default:console.log("invalid key");break}}function aC(){var aR,aP="";if(window.getSelection){aR=window.getSelection();if(aR.rangeCount){var aS=aR.getRangeAt(0).cloneContents();var aQ=document.createElement("div");aQ.appendChild(aS);aP=aQ.innerText}}else{if(document.selection&&document.selection.type=="Text"){aP=document.selection.createRange().htmlText}}return aP}this.detectPrivateKeyFormat=function(aQ){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aQ)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aQ)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aQ)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aQ)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aQ)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aQ)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aQ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aQ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aQ)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aQ)){var aP=Crypto.SHA256(aQ+"?",{asBytes:true});if(aP[0]===0||aP[0]===1){return"mini"}}throw"Unknown Key Format "+aQ};this.privateKeyStringToKey=function(aQ,aS){var aP=null;if(aS=="base58"){aP=B58.decode(aQ)}else{if(aS=="base64"){aP=Crypto.util.base64ToBytes(aQ)}else{if(aS=="hex"){aP=Crypto.util.hexToBytes(aQ)}else{if(aS=="mini"){aP=aj(aQ)}else{if(aS=="sipa"){var aR=B58.decode(aQ);aR.shift();aP=aR.slice(0,aR.length-4)}else{if(aS=="compsipa"){var aR=B58.decode(aQ);aR.shift();aR.pop();aP=aR.slice(0,aR.length-4)}else{throw"Unsupported Key Format"}}}}}}if(aP.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aP)};$(document).ready(function(){if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");var aQ=$(document.body);M=aQ.data("guid");d=aQ.data("sharedkey");if(h.skip_init){return}try{ag=localStorage.getItem("payload");if((!M||M.length==0)&&(isExtension||window.location.href.indexOf("/login")>0)){M=localStorage.getItem("guid")}}catch(aS){}if(M&&M.length==36){setTimeout(function(){h.setGUID(M,false)},10)}if(top.location!=self.location){top.location=self.location.href}aQ.click(function(){if(S){clearTimeout(S);S=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(S){clearTimeout(S);S=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).mousemove(function(aW){if(aW){rng_seed_int(aW.clientX*aW.clientY)}});p();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var aR=false;var aV=17,aU=86,aP=67,aT=67;$(document).keydown(function(aX){try{if(aX.keyCode==aV||aX.keyCode==aT){aR=true}if(aR&&aX.keyCode==aP){var aW=$.trim(aC());var aY=I[aW];if(aY!=null){if(aY.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aY.tag==1){O()}}}}}catch(aX){console.log(aX)}}).keyup(function(aW){if(aW.keyCode==aV||aW.keyCode==aT){aR=false}}).ajaxStart(function(){ap("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){ap("loading_stop");$(".loading-indicator").hide()})});function aO(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}};