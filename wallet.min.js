function precisionToSatoshiBN(a){return Bitcoin.Util.parseValue(a).divide(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)).toString()))}function precisionToBTC(a){return Bitcoin.Util.formatValue(precisionToSatoshiBN(a))}function precisionFromBTC(a){return Bitcoin.Util.formatValue(Bitcoin.Util.parseValue(a).multiply(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)))))}function formatPrecision(a){return formatBTC(precisionToSatoshiBN(a).toString())}var MyWallet=new function(){var h=this;this.skip_init=false;var D="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var af;var M;var j;var aC;var ah;var w;var d;var at=0;var Q=0;var an=0;var K=0;var aM=0;var aA;var g={};var E=[];var F=false;var aq=0;var am=0;var aw=1000;var I={};var au;var aj;var x=0.5;var ac=10;var b={};var aH=0;var q;var S;var V=[];var B;var N=60000;var A=false;var W;var al=false;var s={pbkdf2_iterations:10,fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false};this.setEncryptedWalletData=function(aO){if(!aO||aO.length==0){af=null;au=null;return}af=aO;au=ad();try{if(aH==0||s.always_keep_local_backup){localStorage.setItem("payload",af)}}catch(aP){console.log(aP)}};this.setRealAuthType=function(aO){this.real_auth_type=aO};this.addEventListener=function(aO){V.push(aO)};this.getLogoutTime=function(){return s.logout_time};this.getDefaultPbkdf2Iterations=function(){return ac};this.getPbkdf2Iterations=function(){return s.pbkdf2_iterations};this.setLogoutTime=function(aO){s.logout_time=aO;clearInterval(S);S=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return F};this.getEncryptedWalletData=function(){return af};this.getFeePolicy=function(){return s.fee_policy};this.setFeePolicy=function(aO){s.fee_policy=parseInt(aO)};this.setAlwaysKeepLocalBackup=function(aO){s.always_keep_local_backup=aO};this.getAlwaysKeepLocalBackup=function(){return s.always_keep_local_backup};this.getGuid=function(){return M};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aO){s.html5_notifications=aO};this.getTransactions=function(){return E};this.addressExists=function(aO){return I[aO]!=null};this.getAddressTag=function(aO){return I[aO].tag};this.setAddressTag=function(aP,aO){I[aP].tag=aO};this.getAddressBook=function(){return g};this.getAddressLabel=function(aO){return I[aO].label};this.setAddressLabel=function(aO,aP){I[aO].label=aP};this.setAddressBalance=function(aO,aP){I[aO].balance=aP};this.getAddressBookLabel=function(aO){return g[aO]};this.isWatchOnly=function(aO){return I[aO].priv==null};this.getAddressBalance=function(aO){return I[aO].balance};this.getMixerFee=function(){return x};this.deleteAddress=function(aO){delete I[aO]};this.addAddressBookEntry=function(aP,aO){g[aP]=aO};this.getPrivateKey=function(aO){return I[aO].priv};this.setLabel=function(aO,aP){I[aO].label=aP;ae();c()};this.securePost=function(aP,aQ,aR,aO){var aS=jQuery.extend({},aQ);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aS.sharedKey=d;aS.guid=M;aS.format=aQ.format?aQ.format:"plain";$.ajax({dataType:aQ.format?aQ.format:"text",type:"POST",url:root+aP,data:aS,success:function(aT){aR(aT)},error:function(aT){aO(aT)}})};this.isCorrectMainPassword=function(aO){return aC==aO};function aa(aP,aR){var aO=Crypto.SHA256(aP,{asBytes:true});for(var aQ=1;aQ<aR;++aQ){aO=Crypto.SHA256(aO,{asBytes:true})}return Crypto.util.bytesToHex(aO)}this.setPbkdf2Iterations=function(aO,aQ){var aP=function(aR){console.log("Panic "+aR)};h.getSecondPassword(function(){try{if(F){try{for(var aR in I){var aT=I[aR];if(aT.priv){aT.priv=h.encrypt(h.decryptPK(aT.priv),d+ah,aO);if(!aT.priv){throw"addr.priv is null"}}}s.pbkdf2_iterations=aO;w=aa(d+ah,s.pbkdf2_iterations);h.checkAllKeys();h.backupWallet("update",function(){aQ()},function(){aP(aS)})}catch(aS){aP(aS)}}else{h.backupWallet("update",function(){aQ()},function(){aP(aS)})}}catch(aS){aP(aS)}},function(aR){aP(aR)})};this.setDoubleEncryption=function(aQ,aO,aS){var aP=function(aT){console.log("Panic "+aT);window.location.reload()};try{if(F==aQ){return}if(aQ){h.getSecondPassword(function(){try{F=true;ah=aO;for(var aT in I){var aV=I[aT];if(aV.priv){aV.priv=i(B58.decode(aV.priv));if(!aV.priv){throw"addr.priv is null"}}}w=aa(d+ah,s.pbkdf2_iterations);ah=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){aS()},function(){aP(aW)})}catch(aW){aP(aW)}},function(aW){aP(aW)})}catch(aU){aP(aU)}},function(aT){aP(aT)})}else{h.getSecondPassword(function(){try{for(var aT in I){var aV=I[aT];if(aV.priv){aV.priv=h.decryptPK(aV.priv);if(!aV.priv){throw"addr.priv is null"}}}F=false;ah=null;h.checkAllKeys();h.backupWallet("update",function(){aS()},function(){aP(aU)})}catch(aU){aP(aU)}},function(aT){aP(aT)})}}catch(aR){aP(aR)}};this.unArchiveAddr=function(aO){var aO=I[aO];if(aO.tag==2){aO.tag=null;c();ae("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aO){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aO=I[aO];if(aO.tag==null||aO.tag==0){aO.tag=2;c();ae("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};this.addWatchOnlyAddress=function(aO){return aK(aO)};this.addPrivateKey=function(aP,aO){if(ag()){return false}if(aP==null){throw"Cannot add null key."}var aT=aO?aP.getBitcoinAddressCompressed().toString():aP.getBitcoinAddress().toString();var aS=i(aP.priv);if(aS==null){throw"Error Encoding key"}var aQ=new Bitcoin.ECKey(h.decodePK(aS));if(aT!=aQ.getBitcoinAddress().toString()&&aT!=aQ.getBitcoinAddressCompressed().toString()){throw"Decoded Key address does not match generated address"}if(aK(aT,aS)){I[aT].tag=1;if(I[aT].priv!=aS){throw"Address priv does not match encoded"}try{ws.send('{"op":"addr_sub", "addr":"'+aT+'"}')}catch(aR){}}else{throw"Unable to add generated bitcoin address."}return aT};this._seed=function(aQ){rng_seed_time();if(aC||aQ){var aO=Crypto.util.bytesToWords(Crypto.SHA256(aC?aC:aQ,{asBytes:true}));for(var aP in aO){rng_seed_int(aO[aP])}}if(!W){W=$("body").data("extra-seed")}if(W){var aO=Crypto.util.bytesToWords(Crypto.util.hexToBytes(W));for(var aP in aO){rng_seed_int(aO[aP])}}};this.generateNewKey=function(aP){this._seed(aP);var aO=new Bitcoin.ECKey(false);if(h.addPrivateKey(aO)){return aO}};this.setLoadingText=function(aO){$(".loading-text").text(aO)};function L(){try{$(".popover").remove()}catch(aO){}}$(window).resize(function(){$(".modal:visible").center();L()});function aJ(aP,aO){aP.click(function(){z(aO.txIndex,aO.result)});aP.find(".show-note").mouseover(function(){var aQ=aO.note?aO.note:b[aO.hash];aE(this,aQ,aO.hash)});aP.find(".add-note").mouseover(function(){m(this,aO.hash)});return aP}function t(aP,aV){var aO=0;for(var aR=0;aR<aP.inputs.length;++aR){var aQ=aP.inputs[aR].prev_out;if(!aQ||!aQ.addr){continue}var aU=I[aQ.addr];if(aU){var aT=parseInt(aQ.value);aO-=aT;if(aV){Q+=aT;aU.balance-=aT}}}for(var aS=0;aS<aP.out.length;++aS){var aQ=aP.out[aS];if(!aQ||!aQ.addr){continue}var aU=I[aQ.addr];if(aU){var aT=parseInt(aQ.value);aO+=aT;if(aV){an+=aT;aU.balance+=aT}}}return aO}function ad(){return Crypto.util.bytesToHex(Crypto.SHA256(af,{asBytes:true}))}function y(aO){aO.onmessage=function(aW){try{var aT=$.parseJSON(aW.data);if(aT.op=="on_change"){var aX=ad();var aV=aT.checksum;console.log("On change old "+aX+" ==  new "+aV);if(aX!=aV){setTimeout(J,250)}}else{if(aT.op=="utx"){var aU=TransactionFromJSON(aT.x);for(var aZ in E){if(E[aZ].txIndex==aU.txIndex){return}}var a1=t(aU,true);if(h.getHTML5Notifications()){var aS=function(a2){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(a2.iconUrl,a2.title,a2.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()=="granted"){new Notification(a2.title,a2).show()}}}}catch(a3){}};try{aS({title:a1>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(a1),iconUrl:resource+"cube48.png"})}catch(aW){console.log(aW)}}aU.result=a1;at+=a1;K++;aU.setConfirmations(0);playSound("beep");if(am==0&&aq==0){E.unshift(aU);var aY=false;if(E.length>50){E.pop();aY=true}}var aQ=T();if("my-transactions"==aQ){if(am==0&&aq==0){$("#no-transactions").hide();if(s.tx_display==0){var aP=$("#transactions-compact").show();aJ($(C(aU,I,g)),aU).prependTo(aP.find("tbody")).find("div").hide().slideDown("slow");if(aY){aP.find("tbody tr:last-child").remove()}}else{var aP=$("#transactions-detailed").show();aP.prepend(aU.getHTML(I,g));if(aY){aP.find("div:last-child").remove()}setupSymbolToggle()}}}else{c()}}else{if(aT.op=="block"){for(var aR=0;aR<aT.x.txIndexes.length;++aR){for(var a0=0;a0<E.length;++a0){if(E[a0].txIndex==aT.x.txIndexes[aR]){if(E[a0].blockHeight==null||E[a0].blockHeight==0){E[a0].blockHeight=aT.x.height;break}}}}ar(BlockFromJSON(aT.x));U()}}}}catch(aW){console.log(aW);console.log(aW.data)}};aO.onopen=function(){ao("ok");var aS='{"op":"blocks_sub"}';if(M!=null){aS+='{"op":"wallet_sub","guid":"'+M+'"}'}try{var aQ=h.getActiveAddresses();for(var aP in aQ){aS+='{"op":"addr_sub", "addr":"'+aQ[aP]+'"}'}}catch(aR){alert(aR)}aO.send(aS)};aO.onclose=function(){ao("error")}}var aI="ok";function ao(aP){var aO=$("#logout");if(aP=="loading_start"){aO.attr("src",resource+"logout-orange.png");return}else{if(aP!="loading_stop"){aI=aP}}if(aI=="ok"){aO.attr("src",resource+"logout.png")}else{if(aI=="error"){aO.attr("src",resource+"logout-red.png")}}}this.makeNotice=function(aP,aS,aR,aQ){if(aR==null||aR.length==0){return}console.log(aR);if(aQ==null){aQ=5000}var aO=$('<div class="alert alert-block alert-'+aP+'"></div>');aO.text(""+aR);if($("#"+aS).length>0){aO.attr("id",aS);return}$("#notices").append(aO).hide().fadeIn(200);if(aQ>0){(function(){var aT=aO;setTimeout(function(){aT.fadeOut(250,function(){$(this).remove()})},aQ)})()}};this.pkBytesToSipa=function(aO,aS){var aP=new Bitcoin.ECKey(aO);while(aO.length<32){aO.unshift(0)}aO.unshift(128);if(aP.getBitcoinAddress().toString()==aS){}else{if(aP.getBitcoinAddressCompressed().toString()==aS){aO.push(1)}else{throw"Private Key does not match bitcoin address"+aS}}var aQ=Crypto.SHA256(Crypto.SHA256(aO,{asBytes:true}),{asBytes:true});aO=aO.concat(aQ.slice(0,4));var aR=B58.encode(aO);return aR};function az(aO){return aO}function ap(aO){return h.decryptPK(aO)}function Y(aO){var aP=h.decodePK(aO);return Crypto.util.bytesToBase64(aP)}function k(aO){var aP=h.decodePK(aO);return Crypto.util.bytesToHex(aP)}this.base58ToSipa=function(aO,aP){return h.pkBytesToSipa(h.decodePK(aO),aP)};this.makeWalletJSON=function(aO){return h.makeCustomWalletJSON(aO,M,d)};this.makeCustomWalletJSON=function(aS,aP,aU){var aR=az;if(aS=="base64"){aR=Y}else{if(aS=="hex"){aR=k}else{if(aS=="sipa"){aR=h.base58ToSipa}else{if(aS=="base58"){aR=ap}}}}var aO='{\n	"guid" : "'+aP+'",\n	"sharedKey" : "'+aU+'",\n';if(F&&w!=null&&aR==az){aO+='	"double_encryption" : '+F+',\n	"dpasswordhash" : "'+w+'",\n'}if(s){aO+='	"options" : '+JSON.stringify(s)+",\n"}aO+='	"keys" : [\n';for(var aQ in I){var aT=I[aQ];aO+='	{"addr" : "'+aT.addr+'"';if(aT.priv!=null){aO+=',\n	 "priv" : "'+aR(aT.priv,aT.addr)+'"'}if(aT.tag==2){aO+=',\n	 "tag" : '+aT.tag}if(aT.label!=null){aO+=',\n	 "label" : "'+aT.label+'"'}aO+="},\n";atLeastOne=true}if(atLeastOne){aO=aO.substring(0,aO.length-2)}aO+="\n	]";if(ay(g)>0){aO+=',\n	"address_book" : [\n';for(var aQ in g){aO+='	{"addr" : "'+aQ+'",\n';aO+='	 "label" : "'+g[aQ]+'"},\n'}aO=aO.substring(0,aO.length-2);aO+="\n	]"}if(ay(b)>0){aO+=',\n	"tx_notes" : '+JSON.stringify(b)}aO+="\n}";return aO};this.get_history=function(aP,aO){BlockchainAPI.get_history(function(aQ){H(aQ,false);c();if(aP){aP()}},function(){if(aO){aO()}},am,aq)};this.deleteAddressBook=function(aO){delete g[aO];ae();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aO){$("#send-coins").find(".tab-pane.active").trigger("show",aO);if(aO){BlockchainAPI.get_ticker();$(".send").prop("disabled",false)}}function l(aO,aP,aT){var aS=aO.val();aO.empty();for(var aR in I){var aU=I[aR];if(!aU||aU.tag==2){continue}var aQ=aU.label;if(!aQ){aQ=aU.addr.substring(0,15)+"..."}if(aP||aU.balance>0){aO.prepend('<option value="'+aU.addr+'">'+aQ+" - "+formatBTC(aU.balance)+"</option>")}}aO.prepend('<option value="any" selected>Any Address</option>');if(!aT&&aS){aO.val(aS)}}function r(aQ,aR){l(aQ.find('select[name="from"]'),false,aR);l(aQ.find('select[name="change"]'),true,aR);aQ.find('select[name="change"]').prepend('<option value="new">New Address</option>');aQ.find(".local-symbol").text(symbol_local.symbol);aQ.find(".btc-symbol").text(symbol_btc.symbol);if(aR){aQ.find("input").val("");aQ.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aQ.find(".amount-needed").text(0)}var aP=aQ.find(".recipient-container");if(aR){var aT=aP.find(".recipient:first-child").clone();aP.empty().append(aT)}function aO(){var aU=BigInteger.ZERO;aQ.find('input[name="send-value"]').each(function(){aU=aU.add(precisionToSatoshiBN($(this).val()))});return aU}function aS(aU){aU.find('input[name="send-to-address"]').val("").typeahead({source:av()}).next().click(function(){var aV=$(this).prev();h.scanQRCode(function(aW){console.log(aW);try{new Bitcoin.Address(aW);aV.val(aW)}catch(aX){loadScript("wallet/jsuri-1.1.1",function(){try{var aY=new Uri(aW);aV.val(aY.host());aU.find('input[name="send-value"]').val(aY.getQueryParamValue("amount"))}catch(aZ){h.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){h.makeNotice("error","error","Invalid Bitcoin Address or URI")})}},function(aW){h.makeNotice("error","misc-error",aW)})});aU.find('input[name="send-value"]').val("").bind("keyup change",function(aV){if(aV.keyCode=="9"){return}aQ.find(".amount-needed").text(formatBTC(aO().toString()));aU.find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});aU.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aV){if(aV.keyCode=="9"){return}aU.find('input[name="send-value"]').val(formatSatoshi(parseFloat($(this).val())*symbol_local.conversion,sShift(symbol_btc),true))})}aP.find(".recipient").each(function(){aS($(this))});aQ.find(".remove-recipient").unbind().click(function(){var aU=aP.find(".recipient").length;if(aU>1){if(aU==2){$(this).hide(200)}aP.find(".recipient:last-child").remove()}});aQ.find(".add-recipient").unbind().click(function(){var aU=aP.find(".recipient:first-child").clone();aU.appendTo(aP);aS(aU);aQ.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aP=[];for(var aO in I){aP.push(aO)}return aP};this.getPreferredAddress=function(){var aP=null;for(var aO in I){var aQ=I[aO];if(aP==null){aP=aQ}if(aQ.priv!=null){if(aP==null){aP=aQ}if(aQ.tag==null||aQ.tag==0){aP=aQ;break}}}return aP.addr};function aL(){console.log("backupInstructionsModal");var aO=$("#restore-backup-modal");aO.modal({keyboard:true,backdrop:"static",show:true});aO.find(".btn.btn-secondary").unbind().click(function(){aO.modal("hide")})}this.scanQRCode=function(aQ,aO){var aP=$("#qr-code-reader-modal");aP.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader",function(){QRCodeReader.init(aP,function(aR){aP.modal("hide");aQ(aR)},function(aR){aP.modal("hide");aO(aR)})},aO);aP.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();aP.modal("hide");aO()})};this.getActiveAddresses=function(){var aQ=[];for(var aO in I){var aP=I[aO];if(aP.tag!=2){aQ.push(aP.addr)}}return aQ};this.getArchivedAddresses=function(){var aQ=[];for(var aO in I){var aP=I[aO];if(aP.tag==2){aQ.push(aP.addr)}}return aQ};function ar(aR){if(aR!=null){aA=aR;for(var aP in E){var aO=E[aP];if(aO.blockHeight!=null&&aO.blockHeight>0){var aQ=aA.height-aO.blockHeight+1;if(aQ<=100){aO.setConfirmations(aA.height-aO.blockHeight+1)}else{aO.setConfirmations(null)}}else{aO.setConfirmations(0)}}}}function z(aP,aO){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aP+"?result="+aO+"&guid="+M})})}this.deleteNote=function(aO){delete b[aO];c();ae()};function m(aO,aP){(function(aR,aT){aR=$(aR);if(!aR.data("popover")){aR.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aR.data("popover").tip().is(":visible")){return}}aR.popover("show");aR.mouseleave(function(){if(!aR.__timeout){aR.__timeout=setTimeout(function(){aR.popover("hide")},250)}});function aQ(){if(aR.__timeout){clearTimeout(aR.__timeout);aR.__timeout=null}}var aS=aR.data("popover").tip().mouseenter(aQ);aS.find("textarea").focus(aQ);aS.mouseleave(function(){aR.__timeout=setTimeout(function(){aR.popover("hide")},250)});aS.find("i").unbind().click(function(){aR.popover("hide")});aS.find("button").click(function(){var aU=$.trim($("<div>"+aS.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aU.length>0){b[aT]=aU;ae()}c()})})(aO,aP)}function aE(aO,aP,aQ){(function(aR,aS,aU){aR=$(aR);if(!aR.data("popover")){var aV="Note";if(b[aU]){aV+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aR).popover({title:aV,trigger:"manual",content:aS})}else{if(aR.data("popover").tip().is(":visible")){return}}aR.popover("show");aR.mouseleave(function(){if(!aR.__timeout){aR.__timeout=setTimeout(function(){aR.popover("hide")},250)}});var aT=aR.data("popover").tip().mouseenter(function(){if(aR.__timeout){clearTimeout(aR.__timeout);aR.__timeout=null}});aT.find("img").unbind().click(function(){h.deleteNote(aU)});aT.mouseleave(function(){aR.__timeout=setTimeout(function(){aR.popover("hide")},250)})})(aO,aP,aQ)}function C(aR,aW,aT){var aX=aR.result;var aS='<tr class="pointer" id="tx-'+aR.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aP=true;if(aX>=0){for(var aQ=0;aQ<aR.inputs.length;++aQ){var aO=aR.inputs[aQ].prev_out;if(!aO||!aO.addr){aP=false;aS+='<span class="label">Newly Generated Coins</span>'}else{var aU=aW[aO.addr];if(aU){continue}aP=false;aS+=formatOutput(aO,aW,aT)}}}else{if(aX<0){for(var aQ=0;aQ<aR.out.length;++aQ){var aO=aR.out[aQ];var aU=aW[aO.addr];if(aU&&aO.type==0){continue}aP=false;aS+=formatOutput(aO,aW,aT)}}}if(aP){aS+='<span class="label">Moved Between Wallet</info>'}aS+="</ul></div></td><td><div>";var aV=aR.note?aR.note:b[aR.hash];if(aV){aS+='<img src="'+resource+'note.png" class="show-note"> '}else{aS+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(aR.time>0){aS+=dateToString(new Date(aR.time*1000))}if(aR.confirmations==0){aS+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aR.confirmations>0){aS+=' <span class="label label-info pull-right hidden-phone">'+aR.confirmations+" Confirmations</span> "}}aS+="</div></td>";if(aX>0){aS+='<td style="color:green"><div>'+formatMoney(aX,true)+"</div></td>"}else{if(aX<0){aS+='<td style="color:red"><div>'+formatMoney(aX,true)+"</div></td>"}else{aS+="<td><div>"+formatMoney(aX,true)+"</div></td>"}}if(aR.balance==null){aS+="<td></td></tr>"}else{aS+='<td class="hidden-phone"><div>'+formatMoney(aR.balance)+"</div></td></tr>"}return aS}function T(){L();if(at==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(at,symbol,true));$("#balance2").html(formatSymbol(at,(symbol===symbol_local)?symbol_btc:symbol_local),true)}return j.attr("id")}function c(aO){var aP=T();if("send-coins"==aP){u(aO)}else{if("home-intro"==aP){f(aO)}else{if("receive-coins"==aP){aN(aO)}else{if("my-transactions"==aP){U(aO)}}}}}function f(aO){$("#summary-n-tx").html(K);$("#summary-received").html(formatMoney(an,true));$("#summary-sent").html(formatMoney(Q,true));$("#summary-balance").html(formatMoney(at,symbol));var aQ=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aQ+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});$(".paper-wallet-btn").unbind().click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showModal()})});if(h.isWatchOnly(aQ)){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aP=$("#my-primary-address");if(aP.text()!=aQ){aP.text(aQ);loadScript("wallet/jquery.qrcode",function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:aQ})})}}}function R(){var aO=$("#export-warning").show();var aP=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aO.hide();loadScript("wallet/import-export",function(){ImportExport.init(aP,function(){aP.show()},function(){ab($("#home-intro"))})},function(aQ){h.makeNotice("error","misc-error",aQ);ab($("#home-intro"))})},function(){ab($("#home-intro"))})})}function U(){var aP=null;var aR=0;if(aP!=null){clearInterval(aP);aP=null}var aO;if(s.tx_display==0){$("#transactions-detailed").hide();aO=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aO=$("#transactions-detailed").empty().show()}if(E.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aQ=function(){for(var aV=aR;aV<E.length&&aV<(aR+10);++aV){var aU=E[aV];if(s.tx_display==0){aO.append(aJ($(C(aU,I,g)),aU))}else{aO.append(aU.getHTML(I,g))}}aR+=10;if(aR<E.length){aP=setTimeout(aQ,15)}else{setupSymbolToggle();L();var aT=$(".pagination ul").empty();if(aq==0&&E.length<50){aT.hide();return}else{aT.show()}var aS=Math.ceil(aM/50);var aW=" disabled";if(aq>0){aW=""}aT.append($('<li class="prev'+aW+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(aq-1)}));for(var aV=0;aV<aS&&aV<=10;++aV){(function(aX){var aY="";if(aq==aX){aY=' class="active"'}aT.append($("<li"+aY+'><a class="hidden-phone">'+aX+"</a></li>").click(function(){h.setPage(aX)}))})(aV)}var aW=" disabled";if(aq<aS){aW=""}aT.append($('<li class="next'+aW+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(aq+1)}))}};aQ()}this.setPage=function(aO){aq=aO;scroll(0,0);h.get_history()};function v(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})}function H(aR,aQ){if(!aQ&&aR.mixer_fee){x=aR.mixer_fee}if(aR.disable_mixer){$("#shared-addresses,#send-shared").hide()}E.length=0;if(aR.wallet==null){an=0;Q=0;at=0;K=0;aM=0;return}an=aR.wallet.total_received;Q=aR.wallet.total_sent;at=aR.wallet.final_balance;K=aR.wallet.n_tx;aM=aR.wallet.n_tx_filtered;for(var aP=0;aP<aR.addresses.length;++aP){if(I[aR.addresses[aP].address]){I[aR.addresses[aP].address].balance=aR.addresses[aP].final_balance}}for(var aP=0;aP<aR.txs.length;++aP){var aO=TransactionFromJSON(aR.txs[aP]);aO.result=t(aO,false);E.push(aO)}if(aR.info){$("#nodes-connected").html(aR.info.nconnected);if(aR.info.latest_block){ar(aR.info.latest_block)}if(aR.info.symbol_local){setLocalSymbol(aR.info.symbol_local)}if(aR.info.symbol_btc){setBTCSymbol(aR.info.symbol_btc)}}}function aF(){S=setTimeout(h.logout,h.getLogoutTime());for(var aP in V){V[aP]("did_decrypt")}window.location.hash="";try{var aO=localStorage.getItem("multiaddr");if(aO!=null){H($.parseJSON(aO),true);c()}}catch(aQ){}h.get_history();ab($("#home-intro"));$("#initial_error,#initial_success").remove()}function J(){for(var aO in I){var aQ=I[aO];if(aQ.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have un-saved keys");return}}console.log("Get wallet with checksum "+au);var aP={guid:M,sharedKey:d,format:"plain"};if(au&&au.length>0){aP.checksum=au}$.ajax({type:"GET",url:root+"wallet/wallet.aes.json",data:aP,success:function(aR){if(aR==null||aR.length==0||aR=="Not modified"){return}console.log("Wallet data modified");h.setEncryptedWalletData(aR);if(X()){h.get_history();c()}else{window.location.reload()}}})}function X(){try{if(af==null||af.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aR=null;h.decrypt(af,aC,h.getDefaultPbkdf2Iterations(),function(aS){try{aR=$.parseJSON(aS);return(aR!=null)}catch(aT){return false}});if(aR==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aR.double_encryption&&aR.dpasswordhash){F=aR.double_encryption;w=aR.dpasswordhash}if(aR.options){$.extend(s,aR.options)}I={};for(var aP=0;aP<aR.keys.length;++aP){var aO=aR.keys[aP];if(aO.addr==null||aO.addr.length==0||aO.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}if(aO.tag==1){aO.tag=null}I[aO.addr]=aO}g={};if(aR.address_book){for(var aP=0;aP<aR.address_book.length;++aP){h.addAddressBookEntry(aR.address_book[aP].addr,aR.address_book[aP].label)}}if(aR.tx_notes){b=aR.tx_notes}d=aR.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(au==null||au.length==0){au=ad()}J();e();return true}catch(aQ){h.makeNotice("error","misc-error",aQ)}return false}this.getPassword=function(aT,aU,aR){if(!aT.is(":visible")){aT.trigger("hidden");aT.unbind()}aT.modal({keyboard:false,backdrop:"static",show:true});aT.center();var aS=aT.find('input[name="password"]');var aW=aS,aO=false,aV=false;aT.find(".vkeyboard li").unbind().click(function(){var aZ=$(this),aY=aZ.html();if(aZ.hasClass("left-shift")||aZ.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aO=(aO===true)?false:true;aV=false;return false}if(aZ.hasClass("capslock")){$(".letter").toggleClass("uppercase");aV=true;return false}if(aZ.hasClass("delete")){var aX=aW.val();aW.val(aX.substr(0,aX.length-1));return false}if(aZ.hasClass("symbol")){aY=$("span:visible",aZ).html()}if(aZ.hasClass("space")){aY=" "}if(aZ.hasClass("tab")){aY="\t"}if(aZ.hasClass("return")){aY="\n"}if(aZ.hasClass("uppercase")){aY=aY.toUpperCase()}if(aO===true){$(".symbol span").toggle();if(aV===false){$(".letter").toggleClass("uppercase")}aO=false}aW.val(aW.val()+aY)});aS.keypress(function(aX){if(aX.keyCode==13){aX.preventDefault();aT.find(".btn.btn-primary").click()}});aS.val("");var aP=aT.find(".btn.btn-primary");aP.click(function(){if(aU){aR=null;var aX=aU;aU=null;setTimeout(function(){aT.modal("hide");aX(aS.val())},10)}else{aT.modal("hide")}});var aQ=aT.find(".btn.btn-secondary");aQ.click(function(){if(aR){var aX=aR;aR=null;aU=null;setTimeout(function(){aT.modal("hide");try{aX()}catch(aY){h.makeNotice("error","misc-error",aY)}},10)}else{aT.modal("hide")}});aT.on("hidden",function(){aS.unbind();aQ.unbind();aP.unbind();aT.unbind();if(aR){var aX=aR;aR=null;aU=null;setTimeout(function(){try{aX()}catch(aY){h.makeNotice("error","misc-error",aY)}},10)}})};this.makePairingQRCode=function(aP,aO){h.getMainPassword(function(){loadScript("wallet/jquery.qrcode",function(){try{if(aO==1){h.securePost("wallet",{method:"pairing-encryption-password"},function(aR){aP($("<div></div>").qrcode({width:300,height:300,text:"1|"+M+"|"+h.encrypt(d+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(aC)),aR,ac)}))},function(aR){h.makeNotice("error","misc-error",aR)})}else{if(aO==0){aP($("<div></div>").qrcode({width:300,height:300,text:M+"|"+d+"|"+aC}))}}}catch(aQ){h.makeNotice("error","misc-error",aQ)}})},function(){h.logout()})};this.getMainPassword=function(aP,aO){if(B>new Date().getTime()-N){return aP(aC)}h.getPassword($("#main-password-modal"),function(aQ){if(aC==aQ){B=new Date().getTime();if(aP){try{aP(aC)}catch(aR){h.makeNotice("error","misc-error",aR)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aO){try{aO()}catch(aR){h.makeNotice("error","misc-error",aR)}}}},aO)};this.getSecondPassword=function(aQ,aO){if(!F||ah!=null){if(aQ){try{aQ(ah)}catch(aP){h.makeNotice("error","misc-error",aP)}}return}h.getPassword($("#second-password-modal"),function(aR){try{if(aD(aR)){if(aQ){try{aQ(aR)}catch(aS){console.log(aS);h.makeNotice("error","misc-error",aS)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aO){try{aO()}catch(aS){h.makeNotice("error","misc-error",aS)}}}}catch(aS){if(aO){try{aO()}catch(aS){h.makeNotice("error","misc-error",aS)}}}},aO)};function a(){if(A){return}var aO=$("#restore-password");aC=aO.val();aO.val("");B=new Date().getTime();if(af==null||af.length==0){h.setLoadingText("Validating Authentication key");var aP=$.trim($(".auth-"+q).find(".code").val());if(aP.length==0||aP.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.ajax({type:"POST",url:root+"wallet",data:{guid:M,payload:aP,length:aP.length,method:"get-wallet",format:"plain"},success:function(aQ){try{if(aQ==null||aQ.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}h.setEncryptedWalletData(aQ);$(".auth-"+q).hide();$(".auth-0").show();if(X()){n();aF()}}catch(aR){h.makeNotice("error","misc-error",aR)}},error:function(aQ){h.makeNotice("error","misc-error",aQ.responseText)}})}else{if(X()){n();aF()}}return true}function O(){$("#not-synced-warning-modal").modal("show").find(".btn.btn-danger").unbind().click(function(){$(this).modal("hide");al=true;c()})}function e(){ao("error");webSocketConnect(y);A=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.quickSendNoUI=function(aQ,aP,aO){loadScript("wallet/signer",function(){h.getSecondPassword(function(){try{var aS=initNewTx();aS.from_addresses=h.getActiveAddresses();aS.to_addresses.push({address:new Bitcoin.Address(aQ),value:Bitcoin.Util.parseValue(aP)});aS.addListener(aO);aS.start()}catch(aR){aO.on_error(aR)}},function(aR){aO.on_error(aR)})})};function G(){h.setLoadingText("Sending email backup");$.ajax({type:"POST",url:root+"wallet",data:{guid:M,sharedKey:d,method:"email-backup",format:"plain"},success:function(aO){h.makeNotice("success","backup-success",aO)},error:function(aO){h.makeNotice("error","misc-error",aO.responseText)}})}function ae(aR,aQ,aP,aO){if(aj){clearInterval(aj);aj=null}aj=setTimeout(function(){h.backupWallet(aR,aQ,aP,aO)},3000)}this.backupWallet=function(aV,aU,aO){if(aj){clearInterval(aj);aj=null}try{if(aV==null){aV="update"}if(ay(I)==0){return}var aQ=h.makeWalletJSON();var aT=h.encrypt(aQ,aC,ac);if(aT.length==0){throw"Error encrypting the JSON output"}var aS=null;h.decrypt(aT,aC,h.getDefaultPbkdf2Iterations(),function(aW){try{aS=$.parseJSON(aW);return(aS!=null)}catch(aX){return false}});if(aS==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aP=au;h.setLoadingText("Saving wallet");h.setEncryptedWalletData(aT);$.ajax({type:"POST",url:root+"wallet",data:{guid:M,length:aT.length,payload:aT,sharedKey:d,checksum:au,old_checksum:aP,method:aV},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aX){var aZ=false;for(var aW in I){var aY=I[aW];if(aY.tag==1){aY.tag=null;aZ=true}}h.makeNotice("success","misc-success",aX);c();if(aU!=null){aU()}},error:function(aX){for(var aW in I){var aY=I[aW];if(aY.tag==1){O();break}}if(aX.responseText==null){h.makeNotice("error","misc-error","Error Saving Wallet",10000)}else{h.makeNotice("error","misc-error",aX.responseText,10000)}c();if(aO!=null){aO()}}})}catch(aR){h.makeNotice("error","misc-error","Error Saving Wallet: "+aR,10000);c();if(aO!=null){aO(aR)}else{throw aR}}};function aG(aO){if(F){if(ah==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aO,d+ah,s.pbkdf2_iterations)}else{return aO}return null}this.isBase58=function(aQ,aP){for(var aO=0;aO<aQ.length;++aO){if(aQ[aO]<0||aQ[aO]>58){return false}}return true};this.encrypt=function(aQ,aP,aO){return Crypto.AES.encrypt(aQ,aP,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aO})};this.decrypt=function(aS,aR,aP,aU,aQ){try{var aO=Crypto.AES.decrypt(aS,aR,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aP});if(aO!=null&&aO.length>0){if(aU(aO)){return aO}}}catch(aT){console.log(aT)}if(aP!=10){try{var aO=Crypto.AES.decrypt(aS,aR,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10});if(aO!=null&&aO.length>0){if(aU(aO)){return aO}}}catch(aT){console.log(aT)}}try{var aO=Crypto.AES.decrypt(aS,aR);if(aO!=null&&aO.length>0){if(aU(aO)){return aO}}}catch(aT){console.log(aT)}try{var aO=Crypto.AES.decrypt(aS,aR,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aO!=null&&aO.length>0){if(aU(aO)){return aO}}}catch(aT){console.log(aT)}try{var aO=Crypto.AES.decrypt(aS,aR,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aO!=null&&aO.length>0){if(aU(aO)){return aO}}}catch(aT){console.log(aT)}if(aQ!=null){aQ()}return null};this.setGUID=function(aR,aP){console.log("Set GUID "+aR);if(A){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();try{var aO=localStorage.getItem("guid")}catch(aS){}var aQ=$("#restore-wallet-continue");aQ.prop("disabled",true);$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+aR,data:{format:"json",resend_code:aP},success:function(aU){aQ.prop("disabled",false);$(".auth-"+q).hide();W=aU.extra_seed;M=aU.guid;q=aU.auth_type;aH=aU.real_auth_type;h.setEncryptedWalletData(aU.payload);war_checksum=aU.war_checksum;setLocalSymbol(aU.symbol_local);$("#restore-guid").val(M);$(".auth-"+q).show();$(".recover-wallet-btn").prop("disabled",false).click(function(){window.location=root+"wallet/forgot-password?guid="+M});$("#reset-two-factor-btn").prop("disabled",false).show().click(function(){window.location=root+"wallet/reset-two-factor?guid="+M});if(aU.initial_error){h.makeNotice("error","misc-error",aU.initial_error)}if(aU.initial_success){h.makeNotice("success","misc-success",aU.initial_success)}try{if(aO!=M){localStorage.clear();if(M!=D){localStorage.setItem("guid",M)}}}catch(aT){}},error:function(aU){console.log("Set GUID Success");aQ.prop("disabled",false);if(aO==aR&&af){h.makeNotice("error","misc-error","Error Contacting Server. Using Local Wallet Cache.");M=aO;au=ad();q=0;$("#restore-guid").val(M);$(".auth-"+q).show();return}try{var aT=$.parseJSON(aU.responseText);if(aT.initial_error){h.makeNotice("error","misc-error",aT.initial_error);return}}catch(aU){}if(aU.responseText){h.makeNotice("error","misc-error",aU.responseText)}else{h.makeNotice("error","misc-error","Error changing wallet identifier")}}})};function i(aO){var aP=B58.encode(aO);return aG(aP)}this.decryptPK=function(aO){if(F){if(ah==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aO,d+ah,s.pbkdf2_iterations,h.isBase58)}else{return aO}return null};this.decodePK=function(aP){var aO=h.decryptPK(aP);if(aO!=null){return B58.decode(aO)}return null};this.signmessage=function(aO,aQ){var aS=I[aO];var aR=h.decodePK(aS.priv);var aP=new Bitcoin.ECKey(aR);return Bitcoin.Message.signMessage(aP,aQ,aS.addr)};function aD(aP){var aO=Crypto.SHA256(d+aP,{asBytes:true});var aS=aa(aO,s.pbkdf2_iterations-1);if(aS==w){ah=aP;return true}if(s.pbkdf2_iterations!=10){var aQ=aa(aO,10-1);if(aQ==w){ah=aP;w=aS;return true}}if(Crypto.util.bytesToHex(aO)==w){ah=aP;w=aS;return true}var aR=Crypto.SHA256(aP);if(aR==w){ah=aP;w=aS;return true}return false}this.checkAllKeys=function(aO){for(var aP in I){var aT=I[aP];if(aT.addr==null){throw"Null Address Found in wallet "+aP}if(aT.addr.toString()==null){throw"Error decoding wallet address "+aT.addr}if(aT.priv!=null){var aS=h.decodePK(aT.priv);var aR=new Bitcoin.ECKey(aS);var aQ=aR.getBitcoinAddress().toString();if(aQ!=aT.addr&&aR.getBitcoinAddressCompressed().toString()!=aT.addr){throw"Private key does not match bitcoin address "+aT.addr+" != "+aQ}if(aO){aT.priv=i(aS)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aO){h.getMainPassword(function(){aC=aO;h.backupWallet("update",function(){h.logout()},function(){h.logout()})})};function ab(aO){if(aO===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aO;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function ay(aQ){var aP=0,aO;for(aO in aQ){aP++}return aP}function Z(aO){I[aO].priv=null}function ag(){if(ay(I)>=aw){h.makeNotice("error","misc-error","We currently support a maximum of "+aw+" private keys, please remove some unused ones.");return true}return false}function aK(aQ,aO){var aP=I[aQ];if(!aP||aP.length==0){I[aQ]={addr:aQ,priv:aO,balance:0};return true}else{if(!aP.priv&&aO){aP.priv=aO;return true}}return false}function o(){var aQ=$("#add-address-book-entry-modal");aQ.modal({keyboard:true,backdrop:"static",show:true});var aO=aQ.find('input[name="label"]');var aP=aQ.find('input[name="address"]');aO.val("");aP.val("");aQ.find(".btn.btn-primary").unbind().click(function(){aQ.modal("hide");var aS=$.trim($("<div>"+aO.val()+"</div>").text());var aR=$.trim(aP.val());if(aS.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aS.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aR.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aU;try{aU=new Bitcoin.Address(aR);if(aU==null){throw"Null address"}}catch(aT){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aR]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aR,aS);ae();$("#send-coins").find(".tab-pane").trigger("show",true)});aQ.find(".btn.btn-secondary").unbind().click(function(){aQ.modal("hide")})}this.logout=function(){if(S){clearTimeout(S)}if(M==D){window.location=root+"wallet/logout"}else{$.ajax({type:"GET",url:root+"wallet/logout",data:{format:"plain"},success:function(aO){window.location.reload()},error:function(){window.location.reload()}})}};function ak(aU){var aW=$("#delete-address-modal");aW.modal({keyboard:true,backdrop:"static",show:true});aW.find(".btn.btn-primary").hide();aW.find(".btn.btn-danger").hide();$("#change-mind").hide();aW.find("#to-delete-address").html(aU.join(" "));aW.find("#delete-balance").empty();var aQ=aW.find("#delete-balance");var aO=[];for(var aT in aU){var aV=aU[aT];if(I[aV]&&I[aV].priv){aO.push(aU[aT])}}BlockchainAPI.get_balance(aO,function(aX){aW.find(".btn.btn-primary").show(200);aW.find(".btn.btn-danger").show(200);aQ.html("Balance "+formatBTC(aX));if(aX>0){aQ.css("color","red")}else{aQ.css("color","black")}},function(){aW.find(".btn.btn-primary").show(200);aW.find(".btn.btn-danger").show(200);aQ.text("Error Fetching Balance")});var aR=false;var aT=0;var aP=null;var aS=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aS-aT)};aW.find(".btn.btn-primary").unbind().click(function(){changeMind();aW.find(".btn.btn-primary").hide();aW.find(".btn.btn-danger").hide();aP=setInterval(function(){if(aR){return}++aT;changeMind();if(aT==aS){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aX in aU){Z(aU[aX])}c();h.backupWallet();clearInterval(aP)}},1000)});aW.find(".btn.btn-danger").unbind().click(function(){changeMind();aW.find(".btn.btn-primary").hide();aW.find(".btn.btn-danger").hide();aP=setInterval(function(){if(aR){return}++aT;changeMind();if(aT==aS){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aX in aU){h.deleteAddress(aU[aX])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aP)}}},1000)});aW.unbind().on("hidden",function(){if(aP){aR=true;clearInterval(aP);aP=null}});aW.find(".btn.btn-secondary").unbind().click(function(){aW.modal("hide")})}function av(){var aQ=[];for(var aO in g){aQ.push(g[aO])}for(var aO in I){var aP=I[aO];if(aP.tag!=2&&aP.label){aQ.push(aP.label)}}return aQ}function P(aO){h.getSecondPassword(function(){var aQ=$("#sweep-address-modal");aQ.modal("show");BlockchainAPI.get_balance(aO,function(aR){aQ.find(".balance").text("Amount: "+formatBTC(aR))},function(){aQ.find(".balance").text("Error Fetching Balance")});var aP=aQ.find('select[name="change"]');l(aP,true);aQ.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer",function(){BlockchainAPI.get_balance(aO,function(aR){var aS=initNewTx();aS.fee=aS.base_fee;aS.to_addresses.push({address:new Bitcoin.Address($.trim(aP.val())),value:BigInteger.valueOf(aR).subtract(aS.fee)});aS.from_addresses=aO;aS.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aQ.modal("hide")});aQ.find(".btn.btn-secondary").unbind().click(function(){aQ.modal("hide")})})}function ax(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aO){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){ab($("#home-intro"))});$("#my-transactions-btn").click(function(){ab($("#my-transactions"))});$("#send-coins-btn").click(function(){ab($("#send-coins"))});$("#import-export-btn").click(function(){ab($("#import-export"));R()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal",function(){verifyMessageModal()})});$("#generate-cold-storage").click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showColdStorageModal()},null,true)});$("#group-received").click(function(){loadScript("wallet/taint_grouping",function(){try{loadTaintData()}catch(aO){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){ab($("#my-account"));var aO=$("#account-settings-warning").show();var aP=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aO.hide();loadScript("wallet/account",function(){AccountSettings.init(aP,function(){aP.show()},function(){ab($("#home-intro"))})},function(aQ){h.makeNotice("error","misc-error",aQ);ab($("#home-intro"))})},function(){ab($("#home-intro"))})})});$("#enable_archived_checkbox").change(function(){var aO=$(this).is(":checked");$(".archived_checkbox").prop("checked",false);$(".archived_checkbox").prop("disabled",!aO);$("#archived-sweep").prop("disabled",!aO);$("#archived-delete").prop("disabled",!aO)});$("#shared-addresses").on("show",function(){var aO=$(this);loadScript("wallet/shared-addresses",function(){buildSharedTable(aO)})});$("#active-addresses").on("show",function(){var aU=$(this).find("table:first");aU.find("tbody:gt(0)").remove();var aR=aU.find("tbody").empty();for(var aT in I){var aV=I[aT];if(aV.tag==2||(aV.tag==1&&!al)){continue}var aS="";if(aV.tag==1){aS=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aV.priv==null){aS=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aO="";var aQ=aV.addr;if(aV.label!=null){aQ=aV.label;aO='<span class="hidden-phone"> - '+aV.addr+"</span>"}var aP=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aV.addr+'" target="new">'+aQ+"</a>"+aO+" "+aS+'<div></td><td><span style="color:green">'+formatMoney(aV.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            <li><a href="#" class="pop act-pubkey">Show Public Key</a></li>            </ul></div></td></tr>');(function(aW){aP.find(".act-archive").click(function(){h.archiveAddr(aW)});aP.find(".act-label").click(function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(aW)})});aP.find(".act-qr").click(function(){loadScript("wallet/address_modal",function(){showAddressModalQRCode(aW)})});aP.find(".act-pubkey").click(function(){h.getSecondPassword(function(){var aX=h.getPrivateKey(aW);if(aX==null){h.makeNotice("eror","misc-error","Public Key Unknown");return}var aY=new Bitcoin.ECKey(h.decodePK(aX));if(aY.getBitcoinAddressCompressed().toString()==aW){var aZ=aY.getPubCompressed()}else{var aZ=aY.getPub()}h.makeNotice("success","pub-key","Public Key of "+aW+" is "+Crypto.util.bytesToHex(aZ),20000)})});aP.find(".act-sign").click(function(){loadScript("wallet/address_modal",function(){showAddressModalSignMessage(aW)})});aP.find(".act-request").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aW+"</b>",src:root+"payment_request?address="+aW})})})})(aV.addr);if(aV.balance>0&&aV.priv){aU.prepend(aP)}else{aU.append(aP)}}ax()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").prop("checked",false);$("#archived-delete").prop("disabled",true);$("#archived-sweep").prop("disabled",true);$("#archived-addr tbody").empty();var aP=$(this).find("tbody");var aO=h.getArchivedAddresses();var aQ=function(){aP.empty();for(var aU in aO){var aW=I[aO[aU]];if(aW.tag!=2||(aW.tag==1&&!al)){continue}var aT="";if(aW.priv==null){aT=' <font color="red">(Watch Only)</font>'}var aR="";var aS=aW.addr;if(aW.label!=null){aS=aW.label;aR='<span class="hidden-phone"> - '+aW.addr+"</span>"}var aV=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aW.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aW.addr+'" target="new">'+aS+"</a>"+aR+" "+aT+'<div></td><td><span style="color:green">'+formatBTC(aW.balance)+'</span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aX){aV.find(".act-unarchive").click(function(){h.unArchiveAddr(aX)})})(aW.addr);if(aW.balance>0&&aW.priv){aP.prepend(aV)}else{aP.append(aV)}}};aQ();BlockchainAPI.get_balances(aO,function(aR){aQ()},function(aR){h.makeNotice("error","misc-error",aR)})});$("#archived-sweep").click(function(){var aO=[];$(".archived_checkbox:checked").each(function(){var aP=I[$(this).val()];if(aP.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aO.push(aP.addr)});if(aO.length==0){return}P(aO)});$("#archived-delete").click(function(){var aO=[];$(".archived_checkbox:checked").each(function(){aO.push($(this).val())});if(aO.length==0){return}ak(aO)});$("#shared-never-ask").click(function(){SetCookie("shared-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var aQ=$(this);var aP=h.getPreferredAddress();var aO=aQ.data("extra");if(aO==null){aO=""}loadScript("wallet/frame-modal",function(){showFrameModal({title:aQ.data("title"),description:"Deposit into address <b>"+aP+"</b>",top_right:'Have Questions? Read <a href="'+aQ.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aP+"&ptype="+aQ.data("type")+"&guid="+M+"&sharedKey="+d+aO})})});$(".withdraw-btn").click(function(){var aO=$(this);h.getSecondPassword(function(){var aP=h.getPreferredAddress();loadScript("wallet/frame-modal",function(){showFrameModal({title:aO.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(at)+"</b>",src:root+"withdraw?method="+aO.data("type")+"&address="+aP+"&balance="+at+"&guid="+M+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){J();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aQ=h.generateNewKey();if(!aQ){return}var aP=aQ.getBitcoinAddress().toString();h.backupWallet("update",function(){h.makeNotice("info","new-address","Generated new Bitcoin Address "+aP);loadScript("wallet/address_modal",function(){showLabelAddressModal(aP)})})})}catch(aO){h.makeNotice("error","misc-error",aO)}});$(".tx_filter a").click(function(){aq=0;am=$(this).data("value");h.get_history()});$(".tx_display a").click(function(){var aO=$(this).data("value");if(aO=="export"){v();return}s.tx_display=aO;c();ae()});$("#email-backup-btn").click(function(){G()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+M+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+M+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aQ,aP){var aO=$(this);r(aO,aP);aO.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aO,"quick",initNewTx())})})});$("#send-email").on("show",function(aQ,aP){var aO=$(this);r(aO,aP);aO.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aO,"email",initNewTx())})})});$("#send-shared").on("show",function(aQ,aP){var aO=$(this);r(aO,aP);aO.find(".mixer_fee").text(x);aO.find(".fees,.free,.bonus").show();if(x<0){aO.find(".fees,.free").hide()}else{if(x==0){aO.find(".fees,.bonus").hide()}else{aO.find(".free,.bonus").hide()}}aO.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aO,"shared",initNewTx())})});aO.find(".shared-fees").text("0.00");aO.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aS=parseFloat($(this).val());var aR=0;if(aS>0){if(x>0){aR=parseFloat(aS+((aS/100)*x))}else{aR=parseFloat(aS);aO.find(".bonus-value").text(formatPrecision((Math.min(aS,precisionFromBTC(200))/100)*x))}}if(precisionToBTC(aS)<0.1||precisionToBTC(aS)>250){aO.find(".shared-fees").text("0.00");aO.find(".send").prop("disabled",true)}else{aO.find(".shared-fees").text(formatBTC(aR*symbol_btc.conversion));aO.find(".send").prop("disabled",false)}aO.find('input[name="send-value"]').val(aR).trigger("keyup")})});$("#send-custom").on("show",function(aQ,aP){var aO=$(this);r(aO,aP);aO.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aO,"custom",initNewTx())})});aO.find('select[name="from"]').unbind().change(function(){var aT=0;var aR=$(this).val();for(var aS in aR){if(aR[aS]=="any"){$(this).val("any");aT=at;break}else{var aU=I[aR[aS]];if(aU&&aU.balance){aT+=aU.balance}}}aO.find(".amount-available").text(formatBTC(aT))}).trigger("change");aO.find(".reset").unbind().click(function(){r(aO,true);aO.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aQ,aP){var aO=this;loadScript("wallet/dicegames",function(){try{DICEGame.init($(aO))}catch(aR){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aR){h.makeNotice("error","misc-error",aR)})});$("#send-sms").on("show",function(aQ,aP){if(aP){return}var aO=$(this);r(aO);$.ajax({type:"GET",url:resource+"wallet/country_codes.html",success:function(aR){aO.find('select[name="sms-country-code"]').html(aR)},error:function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aO.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){var aR=initNewTx();startTxUI(aO,"sms",aR)})})});$("#address-book").on("show",function(){var aP=$("#address-book-tbl tbody");if(ay(g)>0){aP.empty();for(var aO in g){var aQ=$("<tr><td>"+g[aO]+'</td><td><div class="addr-book-entry">'+aO+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aR){aQ.find(".act-delete").click(function(){h.deleteAddressBook(aR)})})(aO);aP.append(aQ)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aO){$(aO.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){ab($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();ax()}function p(){$(".resend-code").click(function(){h.setGUID(M,true)});$(".download-backup-btn").toggle(af!=null).click(function(){$(this).attr("download","wallet.aes.json");if(!af){h.makeNotice("error","error","No Wallet Data to Download");return}var aP=("download" in document.createElement("a"));if(window.Blob&&window.URL&&aP){var aQ=new Blob([af]);var aR=window.URL.createObjectURL(aQ);$(this).attr("href",aR)}else{var aO=window.open(null,null,"width=700,height=800,toolbar=0");aO.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+af+"</div></body></html>")}aL()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aO){if(aO.keyCode==13){aO.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aP){aP.preventDefault();var aO=$.trim($("#restore-guid").val());if(aO.length==0){return}if(M!=aO){h.setGUID(aO,false)}else{a()}});$(".modal").on("show",function(){L();$(this).center()}).on("shown",function(){L();$(this).center()})}function ai(aP){var aQ=Crypto.SHA256(aP+"?");switch(aQ.slice(0,2)){case"00":var aR=Crypto.SHA256(aP,{asBytes:true});return aR;break;case"01":var aO=Crypto.util.hexToBytes(aQ.slice(2,4))[0];var aS=Math.round(Math.pow(2,(aO/4)));var aR=Crypto.PBKDF2(aP,"Satoshi Nakamoto",32,{iterations:aS,asBytes:true});return aR;break;default:console.log("invalid key");break}}function aB(){var aQ,aO="";if(window.getSelection){aQ=window.getSelection();if(aQ.rangeCount){var aR=aQ.getRangeAt(0).cloneContents();var aP=document.createElement("div");aP.appendChild(aR);aO=aP.innerText}}else{if(document.selection&&document.selection.type=="Text"){aO=document.selection.createRange().htmlText}}return aO}this.detectPrivateKeyFormat=function(aP){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aP)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aP)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aP)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aP)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aP)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aP)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aP)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aP)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aP)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aP)){var aO=Crypto.SHA256(aP+"?",{asBytes:true});if(aO[0]===0||aO[0]===1){return"mini"}}throw"Unknown Key Format "+aP};this.privateKeyStringToKey=function(aP,aR){var aO=null;if(aR=="base58"){aO=B58.decode(aP)}else{if(aR=="base64"){aO=Crypto.util.base64ToBytes(aP)}else{if(aR=="hex"){aO=Crypto.util.hexToBytes(aP)}else{if(aR=="mini"){aO=ai(aP)}else{if(aR=="sipa"){var aQ=B58.decode(aP);aQ.shift();aO=aQ.slice(0,aQ.length-4)}else{if(aR=="compsipa"){var aQ=B58.decode(aP);aQ.shift();aQ.pop();aO=aQ.slice(0,aQ.length-4)}else{throw"Unsupported Key Format"}}}}}}if(aO.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aO)};$(document).ready(function(){if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");var aP=$(document.body);M=aP.data("guid");d=aP.data("sharedkey");if(h.skip_init){return}try{af=localStorage.getItem("payload");if((!M||M.length==0)&&(isExtension||window.location.href.indexOf("/login")>0)){M=localStorage.getItem("guid")}}catch(aR){}if(M&&M.length==36){setTimeout(function(){h.setGUID(M,false)},10)}if(top.location!=self.location){top.location=self.location.href}aP.click(function(){if(S){clearTimeout(S);S=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(S){clearTimeout(S);S=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).mousemove(function(aV){if(aV){rng_seed_int(aV.clientX*aV.clientY)}});p();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var aQ=false;var aU=17,aT=86,aO=67,aS=67;$(document).keydown(function(aW){try{if(aW.keyCode==aU||aW.keyCode==aS){aQ=true}if(aQ&&aW.keyCode==aO){var aV=$.trim(aB());var aX=I[aV];if(aX!=null){if(aX.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aX.tag==1){O()}}}}}catch(aW){console.log(aW)}}).keyup(function(aV){if(aV.keyCode==aU||aV.keyCode==aS){aQ=false}}).ajaxStart(function(){ao("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){ao("loading_stop");$(".loading-indicator").hide()})});function aN(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}};