function precisionToSatoshiBN(a){return Bitcoin.Util.parseValue(a).divide(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)).toString()))}function precisionToBTC(a){return Bitcoin.Util.formatValue(precisionToSatoshiBN(a))}function precisionFromSatoshi(a){return Bitcoin.Util.formatValue(a.multiply(BigInteger.valueOf(Math.pow(10,sShift(symbol_btc)))))}function precisionFromBTC(a){return precisionFromSatoshi(Bitcoin.Util.parseValue(a))}function formatPrecision(a){return formatBTC(precisionToSatoshiBN(a).toString())}var MyWallet=new function(){var h=this;this.skip_init=false;var D="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var aj;var M;var j;var aI;var al;var w;var d;var ay=0;var S=0;var at=0;var K=0;var aT=0;var aG;var g={};var E=[];var F=false;var aw=0;var ar=0;var aB=1000;var I={};var az;var an;var x=0.5;var ag=10;var P=ag;var b={};var q;var aO=0;var U;var Z=[];var B;var N=60000;var A=false;var aa;var aq=false;var X="en";var ap=2;var Q=0;var aL=0;var Y=false;var aD;var s={pbkdf2_iterations:ag,fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false,transactions_per_page:30};this.setEncryptedWalletData=function(aV){if(!aV||aV.length==0){aj=null;az=null;return}aj=aV;az=ah();try{if(aO==0||s.always_keep_local_backup){MyStore.put("payload",aj)}}catch(aW){console.log(aW)}};this.setRealAuthType=function(aV){aO=aV};this.getLanguage=function(){return X};this.setLanguage=function(aV){MyStore.put("language",aV);X=aV};this.addEventListener=function(aV){Z.push(aV)};this.getLogoutTime=function(){return s.logout_time};this.getSecondPasswordPbkdf2Iterations=function(){return s.pbkdf2_iterations};this.getMainPasswordPbkdf2Iterations=function(){return P};this.getDefaultPbkdf2Iterations=function(){return ag};this.getSharedcoinEndpoint=function(){return aD};this.setLogoutTime=function(aV){s.logout_time=aV;clearInterval(U);U=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return F};this.getEncryptedWalletData=function(){return aj};this.getFeePolicy=function(){return s.fee_policy};this.setFeePolicy=function(aV){s.fee_policy=parseInt(aV)};this.setAlwaysKeepLocalBackup=function(aV){s.always_keep_local_backup=aV};this.getAlwaysKeepLocalBackup=function(){return s.always_keep_local_backup};this.setNTransactionsPerPage=function(aV){s.transactions_per_page=aV};this.getNTransactionsPerPage=function(){return s.transactions_per_page};this.getGuid=function(){return M};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aV){s.html5_notifications=aV};this.getTransactions=function(){return E};this.addressExists=function(aV){return I[aV]!=null};this.getAddressTag=function(aV){return I[aV].tag};this.setAddressTag=function(aW,aV){I[aW].tag=aV};this.getAddressBook=function(){return g};this.getAddressLabel=function(aV){return I[aV].label};this.setAddressLabel=function(aV,aW){I[aV].label=aW};this.setAddressBalance=function(aV,aW){I[aV].balance=aW};this.getAddressBookLabel=function(aV){return g[aV]};this.isWatchOnly=function(aV){return !I[aV]||I[aV].priv==null};this.getAddressBalance=function(aV){return I[aV].balance};this.getMixerFee=function(){return x};this.deleteAddress=function(aV){delete I[aV]};this.addAddressBookEntry=function(aW,aV){g[aW]=aV};this.getPrivateKey=function(aV){return I[aV].priv};this.setLabel=function(aV,aW){I[aV].label=aW;ai();c()};this.securePost=function(aV,aY,a5,a2){var a1=jQuery.extend({},aY);if(!aY.sharedKey){if(!d||d.length==0||d.length!=36){throw"Shared key is invalid"}var aW=new Date().getTime();var a0=parseInt((aW-aL)/10000);var aZ=Crypto.SHA256(d.toLowerCase()+a0);var aX=0;var a4=aZ.substring(aX,aX+=8)+"-"+aZ.substring(aX,aX+=4)+"-"+aZ.substring(aX,aX+=4)+"-"+aZ.substring(aX,aX+=4)+"-"+aZ.substring(aX,aX+=12);a1.sharedKey=a4;a1.sKTimestamp=a0;a1.sKDebugHexHash=aZ;a1.sKDebugTimeOffset=aL;a1.sKDebugOriginalClientTime=aW;a1.sKDebugOriginalSharedKey=d}if(!aY.guid){a1.guid=M}a1.format=aY.format?aY.format:"plain";var a3="text";if(aY.format=="json"){a3="json"}$.ajax({dataType:a3,type:"POST",url:root+aV,data:a1,success:a5,error:a2})};this.isCorrectMainPassword=function(aV){return aI==aV};function ae(aW,aY){var aV=Crypto.SHA256(aW,{asBytes:true});for(var aX=1;aX<aY;++aX){aV=Crypto.SHA256(aV,{asBytes:true})}return Crypto.util.bytesToHex(aV)}this.setPbkdf2Iterations=function(aV,aX){var aW=function(aY){console.log("Panic "+aY);window.location.reload()};h.getSecondPassword(function(){try{if(F){for(var aY in I){var a0=I[aY];if(a0.priv){a0.priv=h.encrypt(h.decryptPK(a0.priv),d+al,aV);if(!a0.priv){throw"addr.priv is null"}}}s.pbkdf2_iterations=aV;w=ae(d+al,aV)}Q=2;P=aV;h.backupWallet("update",function(){aX()},function(){aW(aZ)})}catch(aZ){aW(aZ)}},function(aY){aW(aY)})};this.setDoubleEncryption=function(aX,aV,aZ){var aW=function(a0){console.log("Panic "+a0);window.location.reload()};try{if(F==aX){return}if(aX){h.getSecondPassword(function(){try{F=true;al=aV;for(var a0 in I){var a2=I[a0];if(a2.priv){a2.priv=i(B58.decode(a2.priv));if(!a2.priv){throw"addr.priv is null"}}}w=ae(d+al,s.pbkdf2_iterations);al=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){aZ()},function(){aW(a3)})}catch(a3){aW(a3)}},function(a3){aW(a3)})}catch(a1){aW(a1)}},function(a0){aW(a0)})}else{h.getSecondPassword(function(){try{for(var a0 in I){var a2=I[a0];if(a2.priv){a2.priv=h.decryptPK(a2.priv);if(!a2.priv){throw"addr.priv is null"}}}F=false;al=null;h.checkAllKeys();h.backupWallet("update",function(){aZ()},function(){aW(a1)})}catch(a1){aW(a1)}},function(a0){aW(a0)})}}catch(aY){aW(aY)}};this.unArchiveAddr=function(aV){var aV=I[aV];if(aV.tag==2){aV.tag=null;c();ai("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aV){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aV=I[aV];if(aV.tag==null||aV.tag==0){aV.tag=2;c();ai("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};this.addWatchOnlyAddress=function(aV){return aR(aV)};this.addPrivateKey=function(aV,aX){if(ak()){return false}if(aV==null){throw"Cannot add null key."}if(aX==null){aX={}}var a0=aX.compressed?aV.getBitcoinAddressCompressed().toString():aV.getBitcoinAddress().toString();var aZ=i(aV.priv);if(aZ==null){throw"Error Encoding key"}var aW=new Bitcoin.ECKey(h.decodePK(aZ));if(a0!=aW.getBitcoinAddress().toString()&&a0!=aW.getBitcoinAddressCompressed().toString()){throw"Decoded Key address does not match generated address"}if(aR(a0,aZ)){I[a0].tag=1;I[a0].created_time=aX.created_time?aX.created_time:0;I[a0].created_device_name=aX.app_name?aX.app_name:APP_NAME;I[a0].created_device_version=aX.app_version?aX.app_version:APP_VERSION;if(I[a0].priv!=aZ){throw"Address priv does not match encoded"}try{ws.send('{"op":"addr_sub", "addr":"'+a0+'"}')}catch(aY){}}else{throw"Unable to add generated bitcoin address."}return a0};this._seed=function(aX){rng_seed_time();if(aI||aX){var aV=Crypto.util.bytesToWords(Crypto.SHA256(aI?aI:aX,{asBytes:true}));for(var aW in aV){rng_seed_int(aV[aW])}}if(!aa){aa=$("body").data("extra-seed")}if(aa){var aV=Crypto.util.bytesToWords(Crypto.util.hexToBytes(aa));for(var aW in aV){rng_seed_int(aV[aW])}}};this.generateNewKey=function(aW){h._seed(aW);var aV=new Bitcoin.ECKey(false);if(h.addPrivateKey(aV)){return aV}};this.setLoadingText=function(aV){$(".loading-text").text(aV)};function L(){try{$(".popover").remove()}catch(aV){}}$(window).resize(function(){$(".modal:visible").center();L()});function aQ(aW,aV){aW.click(function(){z(aV.txIndex,aV.result)});aW.find(".show-note").mouseover(function(){var aX=aV.note?aV.note:b[aV.hash];aK(this,aX,aV.hash)});aW.find(".add-note").mouseover(function(){m(this,aV.hash)});return aW}function t(aW,a2){var aV=0;for(var aY=0;aY<aW.inputs.length;++aY){var aX=aW.inputs[aY].prev_out;if(!aX||!aX.addr){continue}var a1=I[aX.addr];if(a1){var a0=parseInt(aX.value);aV-=a0;if(a2){S+=a0;a1.balance-=a0}}}for(var aZ=0;aZ<aW.out.length;++aZ){var aX=aW.out[aZ];if(!aX||!aX.addr){continue}var a1=I[aX.addr];if(a1){var a0=parseInt(aX.value);aV+=a0;if(a2){at+=a0;a1.balance+=a0}}}return aV}function ah(){return Crypto.util.bytesToHex(Crypto.SHA256(aj,{asBytes:true}))}function y(aV){var aW=null;aV.onmessage=function(a3){try{var a0=$.parseJSON(a3.data);if(a0.op=="on_change"){var a4=ah();var a2=a0.checksum;console.log("On change old "+a4+" ==  new "+a2);if(aW!=a2&&a4!=a2){aW=a2;J()}}else{if(a0.op=="utx"){var a1=TransactionFromJSON(a0.x);for(var a6 in E){if(E[a6].txIndex==a1.txIndex){return}}var a8=t(a1,true);if(h.getHTML5Notifications()){h.showNotification({title:a8>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(a8),iconUrl:resource+"cube48.png"})}a1.result=a8;ay+=a8;K++;a1.setConfirmations(0);playSound("beep");if(ar==0&&aw==0){E.unshift(a1);var a5=false;if(E.length>h.getNTransactionsPerPage()){E.pop();a5=true}}var aY=V();if("my-transactions"==aY){if(ar==0&&aw==0){$("#no-transactions").hide();if(s.tx_display==0){var aX=$("#transactions-compact").show();aQ($(C(a1,I,g)),a1).prependTo(aX.find("tbody")).find("div").hide().slideDown("slow");if(a5){aX.find("tbody tr:last-child").remove()}}else{var aX=$("#transactions-detailed").show();aX.prepend(a1.getHTML(I,g));if(a5){aX.find("div:last-child").remove()}setupSymbolToggle()}}}else{c()}}else{if(a0.op=="block"){for(var aZ=0;aZ<a0.x.txIndexes.length;++aZ){for(var a7=0;a7<E.length;++a7){if(E[a7].txIndex==a0.x.txIndexes[aZ]){if(E[a7].blockHeight==null||E[a7].blockHeight==0){E[a7].blockHeight=a0.x.height;break}}}}ax(BlockFromJSON(a0.x));W()}}}}catch(a3){console.log(a3);console.log(a3.data)}};aV.onopen=function(){au("ok");var a0='{"op":"blocks_sub"}';if(M!=null){a0+='{"op":"wallet_sub","guid":"'+M+'"}'}try{var aY=h.getActiveAddresses();for(var aX in aY){a0+='{"op":"addr_sub", "addr":"'+aY[aX]+'"}'}}catch(aZ){alert(aZ)}aV.send(a0)};aV.onclose=function(){au("error")}}var aP="ok";function au(aW){var aV=$("#logout");if(aW=="loading_start"){aV.attr("src",resource+"logout-orange.png");return}else{if(aW!="loading_stop"){aP=aW}}if(aP=="ok"){aV.attr("src",resource+"logout.png")}else{if(aP=="error"){aV.attr("src",resource+"logout-red.png")}}}this.showNotification=function(aV,aW){console.log("Here");try{var aY;if(window.webkitNotifications&&webkitNotifications.checkPermission()==0){aY=webkitNotifications.createNotification(aV.iconUrl,aV.title,aV.body);aY.show()}else{if(window.Notification&&window.Notification.permissionLevel()=="granted"){aY=new window.Notification(aV.title,aV).show()}}setTimeout(function(){aY.cancel()},aW?aW:5000)}catch(aX){}};this.makeNotice=function(aW,aZ,aY,aX){if(aY==null||aY.length==0){return}console.log(aY);var aV=$('<div class="alert alert-block alert-'+aW+'"></div>');aV.text(""+aY);if($("#"+aZ).length>0){aV.attr("id",aZ);return}$("#notices").append(aV).hide().fadeIn(200);(function(){var a0=aV;setTimeout(function(){a0.fadeOut(250,function(){$(this).remove()})},aX?aX:5000)})()};this.pkBytesToSipa=function(aV,aZ){var aW=new Bitcoin.ECKey(aV);while(aV.length<32){aV.unshift(0)}aV.unshift(128);if(aW.getBitcoinAddress().toString()==aZ){}else{if(aW.getBitcoinAddressCompressed().toString()==aZ){aV.push(1)}else{throw"Private Key does not match bitcoin address"+aZ}}var aX=Crypto.SHA256(Crypto.SHA256(aV,{asBytes:true}),{asBytes:true});aV=aV.concat(aX.slice(0,4));var aY=B58.encode(aV);return aY};function aF(aV){return aV}function av(aV){return h.decryptPK(aV)}function ac(aV){var aW=h.decodePK(aV);return Crypto.util.bytesToBase64(aW)}function k(aV){var aW=h.decodePK(aV);return Crypto.util.bytesToHex(aW)}this.base58ToSipa=function(aV,aW){return h.pkBytesToSipa(h.decodePK(aV),aW)};this.makeWalletJSON=function(aV){return h.makeCustomWalletJSON(aV,M,d)};this.makeCustomWalletJSON=function(a0,aW,a2){var aZ=aF;if(a0=="base64"){aZ=ac}else{if(a0=="hex"){aZ=k}else{if(a0=="sipa"){aZ=h.base58ToSipa}else{if(a0=="base58"){aZ=av}}}}var aV='{\n	"guid" : "'+aW+'",\n	"sharedKey" : "'+a2+'",\n';if(F&&w!=null&&aZ==aF){aV+='	"double_encryption" : '+F+',\n	"dpasswordhash" : "'+w+'",\n'}if(s){aV+='	"options" : '+JSON.stringify(s)+",\n"}aV+='	"keys" : [\n';for(var aY in I){var a1=$.extend({},I[aY]);if(a1.tag==1){delete a1.tag}if(a1.priv!=null){a1.priv=aZ(a1.priv,a1.addr)}for(var aX in a1){if(a1[aX]===null||a1[aX]===undefined){delete a1[aX]}}delete a1.balance;aV+=JSON.stringify(a1)+",\n";atLeastOne=true}if(atLeastOne){aV=aV.substring(0,aV.length-2)}aV+="\n	]";if(aE(g)>0){aV+=',\n	"address_book" : [\n';for(var aY in g){aV+='	{"addr" : "'+aY+'",\n';aV+='	 "label" : "'+g[aY]+'"},\n'}aV=aV.substring(0,aV.length-2);aV+="\n	]"}if(aE(b)>0){aV+=',\n	"tx_notes" : '+JSON.stringify(b)}aV+="\n}";return aV};this.get_history=function(aW,aV){BlockchainAPI.get_history(function(aX){H(aX,false);if(E.length==0&&aw>0){h.setPage(0)}else{c()}if(aW){aW()}},function(){if(aV){aV()}},ar,aw*h.getNTransactionsPerPage(),h.getNTransactionsPerPage())};this.deleteAddressBook=function(aV){delete g[aV];ai();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aV){$("#send-coins").find(".tab-pane.active").trigger("show",aV);if(aV){BlockchainAPI.get_ticker();$(".send").prop("disabled",false)}}function l(aV,aW,a0){var aZ=aV.val();aV.empty();for(var aY in I){var a1=I[aY];if(!a1||a1.tag==2){continue}var aX=a1.label;if(!aX){aX=a1.addr.substring(0,15)+"..."}if(aW||a1.balance>0){aV.prepend('<option value="'+a1.addr+'">'+aX+" - "+formatBTC(a1.balance)+"</option>")}}aV.prepend('<option value="any" selected>Any Address</option>');if(!a0&&aZ){aV.val(aZ)}}function r(aX,aY){l(aX.find('select[name="from"]'),false,aY);l(aX.find('select[name="change"]'),true,aY);aX.find('select[name="change"]').prepend('<option value="new">New Address</option>');aX.find(".local-symbol").text(symbol_local.symbol);aX.find(".btc-symbol").text(symbol_btc.symbol);if(aY){aX.find("input").val("");aX.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aX.find(".amount-needed").text(0)}var aW=aX.find(".recipient-container");if(aY){var a0=aW.find(".recipient:first-child").clone();aW.empty().append(a0)}function aV(){var a1=BigInteger.ZERO;aX.find('input[name="send-value"]').each(function(){a1=a1.add(precisionToSatoshiBN($(this).val()))});return a1}function aZ(a1){a1.find('input[name="send-to-address"]').typeahead({source:aA()}).next().unbind().click(function(){var a2=$(this).prev();h.scanQRCode(function(a3){console.log(a3);try{new Bitcoin.Address(a3);a2.val(a3)}catch(a4){h.handleURI(a3,a1)}},function(a3){h.makeNotice("error","misc-error",a3)})});a1.find('input[name="send-value"],input[name="fees"]').unbind().bind("keyup change",function(a2){if(a2.keyCode=="9"){return}aX.find(".amount-needed").text(formatBTC(aV().toString()));a1.find(".send-value-usd").val(convert($(this).val()*symbol_btc.conversion,symbol_local.conversion)).text(formatSymbol($(this).val()*symbol_btc.conversion,symbol_local))});a1.find(".send-value-usd").text(formatSymbol(0,symbol_local)).unbind().bind("keyup change",function(a2){if(a2.keyCode=="9"){return}a1.find('input[name="send-value"]').val(formatSatoshi(parseFloat($(this).val())*symbol_local.conversion,sShift(symbol_btc),true))})}aW.find(".recipient").each(function(){aZ($(this))});aX.find(".remove-recipient").unbind().click(function(){var a1=aW.find(".recipient").length;if(a1>1){if(a1==2){$(this).hide(200)}aW.find(".recipient:last-child").remove()}});aX.find(".add-recipient").unbind().click(function(){var a1=aW.find(".recipient:first-child").clone();a1.appendTo(aW);aZ(a1);aX.find(".remove-recipient").show(200)});aX.find('select[name="from"]').unbind().change(function(){var a3=0;var a1=$(this).val();for(var a2 in a1){if(a1[a2]=="any"){$(this).val("any");a3=ay;break}else{var a4=I[a1[a2]];if(a4&&a4.balance){a3+=a4.balance}}}aX.find(".amount-available").text(formatBTC(a3))}).trigger("change")}this.getAllAddresses=function(){var aW=[];for(var aV in I){aW.push(aV)}return aW};this.getPreferredAddress=function(){var aW=null;for(var aV in I){var aX=I[aV];if(aW==null){aW=aX}if(aX.priv!=null){if(aW==null){aW=aX}if(aX.tag==null||aX.tag==0){aW=aX;break}}}return aW.addr};function aS(){var aV=$("#restore-backup-modal");aV.modal({keyboard:true,backdrop:"static",show:true});aV.find(".btn.btn-secondary").unbind().click(function(){aV.modal("hide")})}this.scanQRCode=function(aX,aV){var aW=$("#qr-code-reader-modal");aW.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader",function(){QRCodeReader.init(aW,function(aY){aW.modal("hide");aX(aY)},function(aY){aW.modal("hide");aV(aY)})},aV);aW.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();aW.modal("hide");aV()})};this.getActiveAddresses=function(){var aX=[];for(var aV in I){var aW=I[aV];if(aW.tag!=2){aX.push(aW.addr)}}return aX};this.getArchivedAddresses=function(){var aX=[];for(var aV in I){var aW=I[aV];if(aW.tag==2){aX.push(aW.addr)}}return aX};function ax(aY){if(aY!=null){aG=aY;for(var aW in E){var aV=E[aW];if(aV.blockHeight!=null&&aV.blockHeight>0){var aX=aG.height-aV.blockHeight+1;if(aX<=100){aV.setConfirmations(aG.height-aV.blockHeight+1)}else{aV.setConfirmations(null)}}else{aV.setConfirmations(0)}}}}function z(aW,aV){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aW+"?result="+aV+"&guid="+M})})}this.deleteNote=function(aV){delete b[aV];c();ai()};function m(aV,aW){(function(aY,a0){aY=$(aY);if(!aY.data("popover")){aY.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aY.data("popover").tip().is(":visible")){return}}aY.popover("show");aY.mouseleave(function(){if(!aY.__timeout){aY.__timeout=setTimeout(function(){aY.popover("hide")},250)}});function aX(){if(aY.__timeout){clearTimeout(aY.__timeout);aY.__timeout=null}}var aZ=aY.data("popover").tip().mouseenter(aX);aZ.find("textarea").focus(aX);aZ.mouseleave(function(){aY.__timeout=setTimeout(function(){aY.popover("hide")},250)});aZ.find("i").unbind().click(function(){aY.popover("hide")});aZ.find("button").click(function(){var a1=stripHTML(aZ.find("textarea").val()).replace(/'/g,"").replace(/"/g,"");if(a1.length>0){b[a0]=a1;ai()}c()})})(aV,aW)}function aK(aV,aW,aX){(function(aY,aZ,a1){aY=$(aY);if(!aY.data("popover")){var a2="Note";if(b[a1]){a2+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aY).popover({title:a2,trigger:"manual",content:$("<div/>").html(aZ).text()})}else{if(aY.data("popover").tip().is(":visible")){return}}aY.popover("show");aY.mouseleave(function(){if(!aY.__timeout){aY.__timeout=setTimeout(function(){aY.popover("hide")},250)}});var a0=aY.data("popover").tip().mouseenter(function(){if(aY.__timeout){clearTimeout(aY.__timeout);aY.__timeout=null}});a0.find("img").unbind().click(function(){h.deleteNote(a1)});a0.mouseleave(function(){aY.__timeout=setTimeout(function(){aY.popover("hide")},250)})})(aV,aW,aX)}function C(aY,a3,a0){var a4=aY.result;var aZ='<tr class="pointer" id="tx-'+aY.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aW=true;if(a4>=0){for(var aX=0;aX<aY.inputs.length;++aX){var aV=aY.inputs[aX].prev_out;if(!aV||!aV.addr){aW=false;aZ+='<span class="label">Newly Generated Coins</span>'}else{var a1=a3[aV.addr];if(a1){continue}aW=false;aZ+=formatOutput(aV,a3,a0)}}}else{if(a4<0){for(var aX=0;aX<aY.out.length;++aX){var aV=aY.out[aX];var a1=a3[aV.addr];if(a1&&aV.type==0){continue}aW=false;aZ+=formatOutput(aV,a3,a0)}}}if(aW){aZ+='<span class="label">Moved Between Wallet</info>'}aZ+="</ul></div></td><td><div>";var a2=aY.note?aY.note:b[aY.hash];if(a2){aZ+='<img src="'+resource+'note.png" class="show-note"> '}else{aZ+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(aY.time>0){aZ+=dateToString(new Date(aY.time*1000))}if(aY.confirmations==0){aZ+=' <span class="label label-important hidden-phone">Unconfirmed Transaction!</span> '}else{if(aY.confirmations>0){aZ+=' <span class="label label-info hidden-phone">'+aY.confirmations+" Confirmations</span> "}}aZ+="</div></td>";if(a4>0){aZ+='<td style="color:green"><div>'+formatMoney(a4,true)+"</div></td>"}else{if(a4<0){aZ+='<td style="color:red"><div>'+formatMoney(a4,true)+"</div></td>"}else{aZ+="<td><div>"+formatMoney(a4,true)+"</div></td>"}}if(aY.balance==null){aZ+="<td></td></tr>"}else{aZ+='<td class="hidden-phone"><div>'+formatMoney(aY.balance)+"</div></td></tr>"}return aZ}function V(){L();if(ay==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(ay,symbol,true));$("#balance2").html(formatSymbol(ay,(symbol===symbol_local)?symbol_btc:symbol_local),true)}return j.attr("id")}function c(aV){var aW=V();if("send-coins"==aW){u(aV)}else{if("home-intro"==aW){f(aV)}else{if("receive-coins"==aW){aU(aV)}else{if("my-transactions"==aW){W(aV)}}}}}function f(aV){$("#summary-n-tx").html(K);$("#summary-received").html(formatMoney(at,true));$("#summary-sent").html(formatMoney(S,true));$("#summary-balance").html(formatMoney(ay,symbol));var aX=h.getPreferredAddress();$(".paper-wallet-btn").unbind().click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showModal()})});if(h.isWatchOnly(aX)){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aW=$("#my-primary-address");if(aW.text()!=aX){aW.text(aX);loadScript("wallet/jquery.qrcode",function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:aX})})}}}function T(){var aV=$("#export-warning").show();var aW=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aV.hide();loadScript("wallet/import-export",function(){ImportExport.init(aW,function(){aW.show()},function(){af($("#home-intro"))})},function(aX){h.makeNotice("error","misc-error",aX);af($("#home-intro"))})},function(){af($("#home-intro"))})})}function W(){var aW=null;var aY=0;if(aW!=null){clearInterval(aW);aW=null}var aV;if(s.tx_display==0){$("#transactions-detailed").hide();aV=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aV=$("#transactions-detailed").empty().show()}if(E.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aX=function(){for(var a2=aY;a2<E.length&&a2<(aY+h.getNTransactionsPerPage());++a2){var a1=E[a2];if(s.tx_display==0){aV.append(aQ($(C(a1,I,g)),a1))}else{aV.append(a1.getHTML(I,g))}}aY+=h.getNTransactionsPerPage();if(aY<E.length){aW=setTimeout(aX,15)}else{setupSymbolToggle();L();var a0=$(".pagination ul").empty();if(aw==0&&E.length<h.getNTransactionsPerPage()){a0.hide();return}else{a0.show()}var aZ=Math.ceil(aT/h.getNTransactionsPerPage());var a4=" disabled";if(aw>0){a4=""}var a5=10;var a3=Math.max(0,Math.min(aw-(a5/2),aZ-a5));a0.append($('<li class="prev'+a4+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(aw-1)}));if(a3>0){a0.append($("<li><a>≤</a></li>").click(function(){h.setPage(0)}))}for(var a2=a3;a2<aZ&&a2<a3+a5;++a2){(function(a6){var a7="";if(aw==a6){a7=' class="active"'}a0.append($("<li"+a7+'><a class="hidden-phone">'+(a6+1)+"</a></li>").click(function(){h.setPage(a6)}))})(a2)}if(a3+a5<aZ){a0.append($("<li><a>≥</a></li>").click(function(){h.setPage(aZ-1)}))}var a4=" disabled";if(aw<aZ-1){a4=""}a0.append($('<li class="next'+a4+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(aw+1)}))}};aX()}this.setPage=function(aV){aw=aV;scroll(0,0);h.get_history()};function v(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})}function H(aY,aX){if(!aX&&aY.mixer_fee){x=aY.mixer_fee}if(aY.disable_mixer){$("#shared-addresses,#send-shared").hide()}aD=aY.sharedcoin_endpoint;E.length=0;if(aY.wallet==null){at=0;S=0;ay=0;K=0;aT=0;return}at=aY.wallet.total_received;S=aY.wallet.total_sent;ay=aY.wallet.final_balance;K=aY.wallet.n_tx;aT=aY.wallet.n_tx_filtered;for(var aW=0;aW<aY.addresses.length;++aW){if(I[aY.addresses[aW].address]){I[aY.addresses[aW].address].balance=aY.addresses[aW].final_balance}}for(var aW=0;aW<aY.txs.length;++aW){var aV=TransactionFromJSON(aY.txs[aW]);aV.result=t(aV,false);E.push(aV)}if(aY.info){$("#nodes-connected").html(aY.info.nconnected);if(aY.info.latest_block){ax(aY.info.latest_block)}if(aY.info.symbol_local){setLocalSymbol(aY.info.symbol_local)}if(aY.info.symbol_btc){setBTCSymbol(aY.info.symbol_btc)}}}this.handleURI=function(aW,aV){loadScript("wallet/jsuri-1.1.1",function(){try{var aY=new Uri(aW);var aX=new Bitcoin.Address(aY.host());aV.find('input[name="send-to-address"]').val(aX.toString());var aZ=parseFloat(aY.getQueryParamValue("amount"));if(aZ>0&&!isNaN(aZ)){aV.find('input[name="send-value"]').val(aZ)}}catch(a0){console.log(a0);h.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){h.makeNotice("error","error","Invalid Bitcoin Address or URI")})};function aM(){J();U=setTimeout(h.logout,h.getLogoutTime());for(var aX in Z){Z[aX]("did_decrypt")}MyStore.get("multiaddr",function(aZ){if(aZ!=null){H($.parseJSON(aZ),true);c()}});h.get_history();$("#initial_error,#initial_success").remove();var aY=decodeURIComponent(window.location.hash.replace("#",""));if(aY.indexOf("bitcoin:")==0){var aV=$("#send-coins");af(aV);var aW=aV.find(".tab-pane.active").find(".recipient").first();h.handleURI(aY,aW)}else{af($("#home-intro"))}window.location.hash=""}function J(aY,aV){for(var aW in I){var aZ=I[aW];if(aZ.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have un-saved keys");return}}console.log("Get wallet with checksum "+az);var aX={method:"wallet.aes.json",format:"json"};if(az&&az.length>0){aX.checksum=az}h.securePost("wallet",aX,function(a0){if(!a0.payload||a0.payload=="Not modified"){if(aY){aY()}return}console.log("Wallet data modified");h.setEncryptedWalletData(a0.payload);ab(function(){h.get_history();c();if(aY){aY()}},function(){if(aV){aV()}})},function(a0){if(aV){aV()}})}function ab(aW,aV){if(aj==null||aj.length==0){aV("No Wallet Data To Decrypt");return}h.decryptWallet(aj,aI,function(a1,aZ){try{d=a1.sharedKey;if(!d||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(aZ){Q=aZ.version;P=aZ.pbkdf2_iterations}if(a1.double_encryption&&a1.dpasswordhash){F=a1.double_encryption;w=a1.dpasswordhash}if(a1.options){$.extend(s,a1.options)}I={};for(var aY=0;aY<a1.keys.length;++aY){var aX=a1.keys[aY];if(aX.addr==null||aX.addr.length==0||aX.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}if(aX.tag==1){aX.tag=null}I[aX.addr]=aX}g={};if(a1.address_book){for(var aY=0;aY<a1.address_book.length;++aY){h.addAddressBookEntry(a1.address_book[aY].addr,a1.address_book[aY].label)}}if(a1.tx_notes){b=a1.tx_notes}if(az==null||az.length==0){az=ah()}e();aW()}catch(a0){aV(a0)}},aV)}this.getPassword=function(a0,a1,aY){if(!a0.is(":visible")){a0.trigger("hidden");a0.unbind()}a0.modal({keyboard:false,backdrop:"static",show:true});a0.center();var aZ=a0.find('input[name="password"]');var a3=aZ,aV=false,a2=false;a0.find(".vkeyboard li").unbind().click(function(){var a6=$(this),a5=a6.html();if(a6.hasClass("left-shift")||a6.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aV=(aV===true)?false:true;a2=false;return false}if(a6.hasClass("capslock")){$(".letter").toggleClass("uppercase");a2=true;return false}if(a6.hasClass("delete")){var a4=a3.val();a3.val(a4.substr(0,a4.length-1));return false}if(a6.hasClass("symbol")){a5=$("span:visible",a6).html()}if(a6.hasClass("space")){a5=" "}if(a6.hasClass("tab")){a5="\t"}if(a6.hasClass("return")){a5="\n"}if(a6.hasClass("uppercase")){a5=a5.toUpperCase()}if(aV===true){$(".symbol span").toggle();if(a2===false){$(".letter").toggleClass("uppercase")}aV=false}a3.val(a3.val()+a5)});aZ.keypress(function(a4){if(a4.keyCode==13){a4.preventDefault();a0.find(".btn.btn-primary").click()}});aZ.val("");var aW=a0.find(".btn.btn-primary");aW.click(function(){if(a1){aY=null;var a4=a1;a1=null;setTimeout(function(){a0.modal("hide");a4(aZ.val())},10)}else{a0.modal("hide")}});var aX=a0.find(".btn.btn-secondary");aX.click(function(){if(aY){var a4=aY;aY=null;a1=null;setTimeout(function(){a0.modal("hide");try{a4()}catch(a5){h.makeNotice("error","misc-error",a5)}},10)}else{a0.modal("hide")}});a0.on("hidden",function(){aZ.unbind();aX.unbind();aW.unbind();a0.unbind();if(aY){var a4=aY;aY=null;a1=null;setTimeout(function(){try{a4()}catch(a5){h.makeNotice("error","misc-error",a5)}},10)}})};this.makePairingQRCode=function(aW,aV){h.getMainPassword(function(){loadScript("wallet/jquery.qrcode",function(){try{if(aV==1){h.securePost("wallet",{method:"pairing-encryption-password"},function(aY){aW($("<div></div>").qrcode({width:300,height:300,text:"1|"+M+"|"+h.encrypt(d+"|"+Crypto.util.bytesToHex(UTF8.stringToBytes(aI)),aY,h.getDefaultPbkdf2Iterations())}))},function(aY){h.makeNotice("error","misc-error",aY)})}else{if(aV==0){aW($("<div></div>").qrcode({width:300,height:300,text:M+"|"+d+"|"+aI}))}}}catch(aX){h.makeNotice("error","misc-error",aX)}})},function(){h.logout()})};this.getMainPassword=function(aW,aV){if(B>new Date().getTime()-N){return aW(aI)}h.getPassword($("#main-password-modal"),function(aX){if(aI==aX){B=new Date().getTime();if(aW){try{aW(aI)}catch(aY){h.makeNotice("error","misc-error",aY)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aV){try{aV()}catch(aY){h.makeNotice("error","misc-error",aY)}}}},aV)};this.getSecondPassword=function(aX,aV){if(!F||al!=null){if(aX){try{aX(al)}catch(aW){h.makeNotice("error","misc-error",aW)}}return}h.getPassword($("#second-password-modal"),function(aY){try{if(aJ(aY)){if(aX){try{aX(aY)}catch(aZ){console.log(aZ);h.makeNotice("error","misc-error",aZ)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aV){try{aV()}catch(aZ){h.makeNotice("error","misc-error",aZ)}}}}catch(aZ){if(aV){try{aV()}catch(aZ){h.makeNotice("error","misc-error",aZ)}}}},aV)};function a(){if(A){return}var aV=$("#restore-password");aI=aV.val();aV.val("");B=new Date().getTime();if(aj==null||aj.length==0){h.setLoadingText("Validating Authentication key");var aW=$.trim($(".auth-"+q).find(".code").val());if(aW.length==0||aW.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.ajax({type:"POST",url:root+"wallet",data:{guid:M,payload:aW,length:aW.length,method:"get-wallet",format:"plain"},success:function(aX){try{if(aX==null||aX.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}if(aX!="Not modified"){h.setEncryptedWalletData(aX)}$(".auth-"+q).hide();$(".auth-0").show();ab(function(){n();aM()},function(aZ){h.makeNotice("error","misc-error",aZ)})}catch(aY){h.makeNotice("error","misc-error",aY)}},error:function(aX){h.makeNotice("error","misc-error",aX.responseText)}})}else{ab(function(){n();aM()},function(aX){h.makeNotice("error","misc-error",aX)})}}function O(){$("#not-synced-warning-modal").modal("show").find(".btn.btn-danger").unbind().click(function(){$(this).modal("hide");aq=true;c()})}function e(){au("error");webSocketConnect(y);A=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.quickSendNoUI=function(aX,aW,aV){loadScript("wallet/signer",function(){h.getSecondPassword(function(){try{var aZ=initNewTx();aZ.from_addresses=h.getActiveAddresses();aZ.to_addresses.push({address:new Bitcoin.Address(aX),value:Bitcoin.Util.parseValue(aW)});aZ.addListener(aV);aZ.start()}catch(aY){aV.on_error(aY)}},function(aY){aV.on_error(aY)})})};function G(){h.setLoadingText("Sending email backup");h.securePost("wallet",{method:"email-backup"},function(aV){h.makeNotice("success","backup-success",aV)},function(aV){h.makeNotice("error","misc-error",aV.responseText)})}function ai(aY,aX,aW,aV){if(an){clearInterval(an);an=null}an=setTimeout(function(){h.backupWallet(aY,aX,aW,aV)},3000)}this.backupWallet=function(a1,a0,aW){if(an){clearInterval(an);an=null}var aV=function(a2){h.makeNotice("error","misc-error","Error Saving Wallet: "+a2,10000);c();if(aW!=null){aW(a2)}else{throw a2}};try{if(a1==null){a1="update"}if(aE(I)==0){return}var aX=h.makeWalletJSON();var aZ=h.encryptWallet(aX,aI);if(aZ.length==0){throw"Error encrypting the JSON output"}h.decryptWallet(aZ,aI,function(a4){try{var a2=az;h.setLoadingText("Saving wallet");h.setEncryptedWalletData(aZ);h.securePost("wallet",{length:aZ.length,payload:aZ,checksum:az,old_checksum:a2,method:a1,format:"plain"},function(a6){for(var a5 in I){var a7=I[a5];if(a7.tag==1){delete a7.tag}}h.makeNotice("success","misc-success",a6);c();if(a0!=null){a0()}},function(a6){for(var a5 in I){var a7=I[a5];if(a7.tag==1){O();break}}aV(a6.responseText)})}catch(a3){aV(a3)}})}catch(aY){aV(aY)}};function aN(aV){if(F){if(al==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aV,d+al,h.getSecondPasswordPbkdf2Iterations())}else{return aV}return null}this.isBase58=function(aX,aW){for(var aV=0;aV<aX.length;++aV){if(aX[aV]<0||aX[aV]>58){return false}}return true};this.encrypt=function(aX,aW,aV){return Crypto.AES.encrypt(aX,aW,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aV})};this.encryptWallet=function(aW,aV){if(Q==2){return JSON.stringify({pbkdf2_iterations:h.getMainPasswordPbkdf2Iterations(),version:Q,payload:h.encrypt(aW,aV,h.getMainPasswordPbkdf2Iterations())})}else{if(Q==0){return h.encrypt(aW,aV,h.getDefaultPbkdf2Iterations())}else{throw"Unknown encryption version "+Q}}};this.decryptWallet=function(aW,a2,a3,aZ){try{var aV=null;try{var aV=$.parseJSON(aW)}catch(aX){console.log(aX)}var aY=function(){try{var a5=Crypto.AES.decrypt(aV.payload,a2,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aV.pbkdf2_iterations});var a4=$.parseJSON(a5);a3(a4,aV)}catch(a6){aZ("Error Decrypting Wallet. Please check your password is correct.")}};if(aV&&aV.payload&&aV.pbkdf2_iterations){if(aV.version!=ap){throw"Wallet version "+aV.version+" not supported"}if(aV.pbkdf2_iterations>100){var a1=$("#decrypting-progress-modal");var a0=setTimeout(function(){a1.modal({keyboard:false,backdrop:"static",show:true});a1.center()},500);h.decryptWebWorker(aV.payload,a2,aV.pbkdf2_iterations,function(a5){clearTimeout(a0);a1.modal("hide");try{var a4=$.parseJSON(a5);a3(a4,aV)}catch(a6){aY()}},function(){clearTimeout(a0);a1.modal("hide");aY()})}else{aY()}}else{h.decrypt(aW,a2,h.getDefaultPbkdf2Iterations(),function(a5){try{var a4=$.parseJSON(a5);try{a3(a4)}catch(a6){console.log(a6)}return true}catch(a6){return false}},function(){aZ("Error Decrypting Wallet. Please check your password is correct.")})}}catch(aX){if(aZ){aZ(aX)}}};this.decryptWebWorker=function(aY,a2,aX,a3,a1){var aV=false;var a0=function(a4){if(!aV){a1(a4);aV=true}};try{var aW=new Worker(resource+"wallet/signer"+(min?".min.js":".js"));aW.addEventListener("message",function(a5){var a4=a5.data;try{switch(a4.cmd){case"on_decrypt":a3(a4.data);aW.terminate();break;case"on_error":throw a4.e}}catch(a5){aW.terminate();a0(a5)}},false);aW.addEventListener("error",function(a4){a0(a4)});aW.postMessage({cmd:"load_resource",path:resource+"wallet/bitcoinjs"+(min?".min.js":".js")});aW.postMessage({cmd:"decrypt",data:aY,password:a2,pbkdf2_iterations:aX})}catch(aZ){a0(aZ)}};this.decrypt=function(aZ,aY,aW,a1,aX){try{var aV=Crypto.AES.decrypt(aZ,aY,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:aW});if(aV!=null&&aV.length>0){if(a1(aV)){return aV}}}catch(a0){console.log(a0)}if(aW!=10){try{var aV=Crypto.AES.decrypt(aZ,aY,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:10});if(aV!=null&&aV.length>0){if(a1(aV)){return aV}}}catch(a0){console.log(a0)}}try{var aV=Crypto.AES.decrypt(aZ,aY);if(aV!=null&&aV.length>0){if(a1(aV)){return aV}}}catch(a0){console.log(a0)}try{var aV=Crypto.AES.decrypt(aZ,aY,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aV!=null&&aV.length>0){if(a1(aV)){return aV}}}catch(a0){console.log(a0)}try{var aV=Crypto.AES.decrypt(aZ,aY,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aV!=null&&aV.length>0){if(a1(aV)){return aV}}}catch(a0){console.log(a0)}if(aX){aX()}return null};this.handleNTPResponse=function(aZ,a0){var aX=(new Date()).getTime();if(aZ.clientTimeDiff&&aZ.serverTime){var aV=aX-aZ.serverTime;var aW=(aZ.clientTimeDiff-aX+a0-aV)/2;var aY=(aV-aW)/2;if(Y){aL=(aL+aY)/2}else{aL=aY;Y=true;MyStore.put("server_time_offset",""+aL)}console.log("Server Time offset "+aL+"ms - This offset "+aY)}};this.setGUID=function(aX,aV){console.log("Set GUID "+aX);if(A){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();var aW=$("#restore-wallet-continue");aW.prop("disabled",true);var aZ=(new Date()).getTime();var aY={format:"json",resend_code:aV,ct:aZ};if(az){aY.checksum=az}$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+aX,data:aY,timeout:10000,success:function(a0){h.handleNTPResponse(a0,aZ);aW.prop("disabled",false);if(!a0.guid){h.makeNotice("error","misc-error","Server returned null guid.");return}$(".auth-"+q).hide();aa=a0.extra_seed;M=a0.guid;q=a0.auth_type;aO=a0.real_auth_type;if(a0.payload&&a0.payload.length>0&&a0.payload!="Not modified"){h.setEncryptedWalletData(a0.payload)}war_checksum=a0.war_checksum;setLocalSymbol(a0.symbol_local);$("#restore-guid").val(M);$(".auth-"+q).show();if(a0.initial_error){h.makeNotice("error","misc-error",a0.initial_error)}if(a0.initial_success){h.makeNotice("success","misc-success",a0.initial_success)}MyStore.get("guid",function(a1){if(a1!=M){MyStore.remove("guid");MyStore.remove("payload");MyStore.remove("multiaddr");if(M!=D){MyStore.put("guid",M)}}});if(a0.language&&X!=a0.language){h.setLanguage(a0.language)}},error:function(a0){console.log("Set GUID Success");aW.prop("disabled",false);MyStore.get("guid",function(a1){if(a1==aX&&aj){h.makeNotice("error","misc-error","Error Contacting Server. Using Local Wallet Cache.");M=a1;az=ah();q=0;$("#restore-guid").val(M);$(".auth-"+q).show();return}try{var a3=$.parseJSON(a0.responseText);if(a3.initial_error){h.makeNotice("error","misc-error",a3.initial_error);return}}catch(a2){}if(a0.responseText){h.makeNotice("error","misc-error",a0.responseText)}else{h.makeNotice("error","misc-error","Error changing wallet identifier")}})}})};function i(aV){var aW=B58.encode(aV);return aN(aW)}this.decryptPK=function(aV){if(F){if(al==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aV,d+al,h.getSecondPasswordPbkdf2Iterations(),h.isBase58)}else{return aV}return null};this.decodePK=function(aW){if(!aW){throw"null PK passed to decodePK"}var aV=h.decryptPK(aW);if(aV!=null){return B58.decode(aV)}return null};this.signmessage=function(aV,aX){var aZ=I[aV];if(!aZ.priv){throw"Cannot sign a watch only address"}var aY=h.decodePK(aZ.priv);var aW=new Bitcoin.ECKey(aY);return Bitcoin.Message.signMessage(aW,aX,aZ.addr)};function aJ(aW){var aV=Crypto.SHA256(d+aW,{asBytes:true});var aZ=ae(aV,h.getSecondPasswordPbkdf2Iterations()-1);if(aZ==w){al=aW;return true}if(h.getSecondPasswordPbkdf2Iterations()!=10){var aX=ae(aV,10-1);if(aX==w){al=aW;w=aZ;return true}}if(Crypto.util.bytesToHex(aV)==w){al=aW;w=aZ;return true}var aY=Crypto.SHA256(aW);if(aY==w){al=aW;w=aZ;return true}return false}this.runCompressedCheck=function(){var aV=[];var aX={};for(var aY in I){var a2=I[aY];if(a2.priv!=null){var a1=h.decodePK(a2.priv);var aZ=new Bitcoin.ECKey(a1);var aW=aZ.getBitcoinAddress().toString();var a0=aZ.getBitcoinAddressCompressed().toString();if(a2.addr!=aW){aX[aW]=a2.priv;aV.push(aW)}if(a2.addr!=a0){aX[a0]=a2.priv;aV.push(a0)}}}if(aV.length==0){alert("to_check length == 0")}BlockchainAPI.get_balances(aV,function(a4){var a5=0;for(var a3 in a4){var a6=a4[a3].final_balance;if(a6>0){alert(formatBTC(a6)+" claimable in address "+a3+" (Import PK : "+h.base58ToSipa(aX[a3],a3)+")")}a5+=a6}alert(formatBTC(a6)+" found in compressed addresses")})};this.checkAllKeys=function(aV){for(var aW in I){var a0=I[aW];if(a0.addr==null){throw"Null Address Found in wallet "+aW}if(a0.addr.toString()==null){throw"Error decoding wallet address "+a0.addr}if(a0.priv!=null){var aZ=h.decodePK(a0.priv);var aY=new Bitcoin.ECKey(aZ);var aX=aY.getBitcoinAddress().toString();if(aX!=a0.addr&&aY.getBitcoinAddressCompressed().toString()!=a0.addr){throw"Private key does not match bitcoin address "+a0.addr+" != "+aX}if(aV){a0.priv=i(aZ)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aV){h.getMainPassword(function(){aI=aV;h.backupWallet("update",function(){h.logout()},function(){h.logout()})})};function af(aV){if(aV===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aV;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function aE(aX){var aW=0,aV;for(aV in aX){aW++}return aW}function ad(aV){I[aV].priv=null}function ak(){if(aE(I)>=aB){h.makeNotice("error","misc-error","We currently support a maximum of "+aB+" private keys, please remove some unused ones.");return true}return false}function aR(aX,aV){var aW=I[aX];if(!aW||aW.length==0){I[aX]={addr:aX,priv:aV,balance:0};return true}else{if(!aW.priv&&aV){aW.priv=aV;return true}}return false}function o(){var aX=$("#add-address-book-entry-modal");aX.modal({keyboard:true,backdrop:"static",show:true});var aV=aX.find('input[name="label"]');var aW=aX.find('input[name="address"]');aV.val("");aW.val("");aX.find(".btn.btn-primary").unbind().click(function(){aX.modal("hide");var aZ=stripHTML(aV.val());var aY=stripHTML(aW.val());if(aZ.length==0||aY.length==0){h.makeNotice("error","misc-error","You must enter an address and label for the address book entry");return false}var a1;try{a1=new Bitcoin.Address(aY);if(a1==null){throw"Null address"}}catch(a0){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aY]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aY,aZ);ai();$("#send-coins").find(".tab-pane").trigger("show",true)});aX.find(".btn.btn-secondary").unbind().click(function(){aX.modal("hide")})}this.logout=function(){if(U){clearTimeout(U)}if(M==D){window.location=root+"wallet/logout"}else{$.ajax({type:"GET",url:root+"wallet/logout",data:{format:"plain"},success:function(aV){window.location.reload()},error:function(){window.location.reload()}})}};function ao(a1){var a3=$("#delete-address-modal");a3.modal({keyboard:true,backdrop:"static",show:true});a3.find(".btn.btn-primary").hide();a3.find(".btn.btn-danger").hide();$("#change-mind").hide();a3.find("#to-delete-address").html(a1.join(" "));a3.find("#delete-balance").empty();var aX=a3.find("#delete-balance");var aV=[];for(var a0 in a1){var a2=a1[a0];if(I[a2]&&I[a2].priv){aV.push(a1[a0])}}BlockchainAPI.get_balance(aV,function(a4){a3.find(".btn.btn-primary").show(200);a3.find(".btn.btn-danger").show(200);aX.html("Balance "+formatBTC(a4));if(a4>0){aX.css("color","red")}else{aX.css("color","black")}},function(){a3.find(".btn.btn-primary").show(200);a3.find(".btn.btn-danger").show(200);aX.text("Error Fetching Balance")});var aY=false;var a0=0;var aW=null;var aZ=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aZ-a0)};a3.find(".btn.btn-primary").unbind().click(function(){changeMind();a3.find(".btn.btn-primary").hide();a3.find(".btn.btn-danger").hide();aW=setInterval(function(){if(aY){return}++a0;changeMind();if(a0==aZ){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var a4 in a1){ad(a1[a4])}c();h.backupWallet();clearInterval(aW)}},1000)});a3.find(".btn.btn-danger").unbind().click(function(){changeMind();a3.find(".btn.btn-primary").hide();a3.find(".btn.btn-danger").hide();aW=setInterval(function(){if(aY){return}++a0;changeMind();if(a0==aZ){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var a4 in a1){h.deleteAddress(a1[a4])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aW)}}},1000)});a3.unbind().on("hidden",function(){if(aW){aY=true;clearInterval(aW);aW=null}});a3.find(".btn.btn-secondary").unbind().click(function(){a3.modal("hide")})}function aA(){var aX=[];for(var aV in g){aX.push(g[aV])}for(var aV in I){var aW=I[aV];if(aW.tag!=2&&aW.label){aX.push(aW.label)}}return aX}function R(aV){h.getSecondPassword(function(){var aX=$("#sweep-address-modal");aX.modal("show");BlockchainAPI.get_balance(aV,function(aY){aX.find(".balance").text("Amount: "+formatBTC(aY))},function(){aX.find(".balance").text("Error Fetching Balance")});var aW=aX.find('select[name="change"]');l(aW,true);aX.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer",function(){BlockchainAPI.get_balance(aV,function(aY){var aZ=initNewTx();aZ.fee=aZ.base_fee;aZ.to_addresses.push({address:new Bitcoin.Address($.trim(aW.val())),value:BigInteger.valueOf(aY).subtract(aZ.fee)});aZ.from_addresses=aV;aZ.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aX.modal("hide")});aX.find(".btn.btn-secondary").unbind().click(function(){aX.modal("hide")})})}this.openWindow=function(aW){function aV(aY){var aX=false;try{if(typeof aY=="undefined"||!aY){aX=true}else{if(aY&&aY.closed){aX=false}else{if(aY&&aY.test){aX=false}}}}catch(aZ){}return aX}window.open(aW,null,"scroll=1,status=1,location=1,toolbar=1");if(aV(window)){h.makeNotice("error","misc-error","Popup Blocked. Try and click again.");return false}else{return true}};function aC(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aV){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){af($("#home-intro"))});$("#my-transactions-btn").click(function(){af($("#my-transactions"))});$("#send-coins-btn").click(function(){af($("#send-coins"))});$("#import-export-btn").click(function(){af($("#import-export"));T()});$("#chord-diagram").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Address Relationships",description:"",src:root+"taint/"+h.getActiveAddresses().join("|")})})});$("#verify-message").click(function(){loadScript("wallet/address_modal",function(){verifyMessageModal()})});$("#generate-cold-storage").click(function(){loadScript("wallet/paper-wallet",function(){PaperWallet.showColdStorageModal()},null,true)});$("#group-received").click(function(){loadScript("wallet/taint_grouping",function(){try{loadTaintData()}catch(aV){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){af($("#my-account"));var aV=$("#account-settings-warning").show();var aW=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aV.hide();loadScript("wallet/account",function(){AccountSettings.init(aW,function(){aW.show()},function(){af($("#home-intro"))})},function(aX){h.makeNotice("error","misc-error",aX);af($("#home-intro"))})},function(){af($("#home-intro"))})})});$("#enable_archived_checkbox").change(function(){var aV=$(this).is(":checked");$(".archived_checkbox").prop("checked",false);$(".archived_checkbox").prop("disabled",!aV);$("#archived-sweep").prop("disabled",!aV);$("#archived-delete").prop("disabled",!aV)});$("#shared-addresses").on("show",function(){var aV=$(this);loadScript("wallet/shared-addresses",function(){buildSharedTable(aV)})});$("#active-addresses").on("show",function(){var a1=$(this).find("table:first");a1.find("tbody:gt(0)").remove();var aY=a1.find("tbody").empty();for(var a0 in I){var a2=I[a0];if(a2.tag==2||(a2.tag==1&&!aq)){continue}var aZ="";if(a2.tag==1){aZ=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(a2.priv==null){aZ=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aV="";var aX=a2.addr;if(a2.label!=null){aX=a2.label;aV='<span class="hidden-phone"> - '+a2.addr+"</span>"}var aW=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+a2.addr+'" target="new">'+aX+"</a>"+aV+" "+aZ+'<div></td><td><span style="color:green">'+formatMoney(a2.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            <li><a href="#" class="pop act-pubkey">Show Public Key</a></li>            </ul></div></td></tr>');(function(a3){aW.find(".act-archive").click(function(){h.archiveAddr(a3)});aW.find(".act-label").click(function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(a3)})});aW.find(".act-qr").click(function(){loadScript("wallet/address_modal",function(){showAddressModalQRCode(a3)})});aW.find(".act-pubkey").click(function(){h.getSecondPassword(function(){var a4=h.getPrivateKey(a3);if(a4==null){h.makeNotice("eror","misc-error","Public Key Unknown");return}var a5=new Bitcoin.ECKey(h.decodePK(a4));if(a5.getBitcoinAddressCompressed().toString()==a3){var a6=a5.getPubCompressed()}else{var a6=a5.getPub()}h.makeNotice("success","pub-key","Public Key of "+a3+" is "+Crypto.util.bytesToHex(a6),20000)})});aW.find(".act-sign").click(function(){loadScript("wallet/address_modal",function(){showAddressModalSignMessage(a3)})});aW.find(".act-request").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+a3+"</b>",src:root+"payment_request?address="+a3})})})})(a2.addr);if(a2.balance>0&&a2.priv){a1.prepend(aW)}else{a1.append(aW)}}aC()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").prop("checked",false);$("#archived-delete").prop("disabled",true);$("#archived-sweep").prop("disabled",true);$("#archived-addr tbody").empty();var aW=$(this).find("tbody");var aV=h.getArchivedAddresses();var aX=function(){aW.empty();for(var a1 in aV){var a3=I[aV[a1]];if(a3.tag!=2||(a3.tag==1&&!aq)){continue}var a0="";if(a3.priv==null){a0=' <font color="red">(Watch Only)</font>'}var aY="";var aZ=a3.addr;if(a3.label!=null){aZ=a3.label;aY='<span class="hidden-phone"> - '+a3.addr+"</span>"}var a2=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+a3.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+a3.addr+'" target="new">'+aZ+"</a>"+aY+" "+a0+'<div></td><td><span style="color:green">'+formatBTC(a3.balance)+'</span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(a4){a2.find(".act-unarchive").click(function(){h.unArchiveAddr(a4)})})(a3.addr);if(a3.balance>0&&a3.priv){aW.prepend(a2)}else{aW.append(a2)}}};aX();BlockchainAPI.get_balances(aV,function(aY){aX()},function(aY){h.makeNotice("error","misc-error",aY)})});$("#archived-sweep").click(function(){var aV=[];$(".archived_checkbox:checked").each(function(){var aW=I[$(this).val()];if(aW.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aV.push(aW.addr)});if(aV.length==0){return}R(aV)});$("#archived-delete").click(function(){var aV=[];$(".archived_checkbox:checked").each(function(){aV.push($(this).val())});if(aV.length==0){return}ao(aV)});$("#shared-never-ask").click(function(){SetCookie("shared-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var aX=$(this);var aW=h.getPreferredAddress();var aV=aX.data("extra");if(aV==null){aV=""}loadScript("wallet/frame-modal",function(){showFrameModal({title:aX.data("title"),description:"Deposit into address <b>"+aW+"</b>",top_right:'Have Questions? Read <a href="'+aX.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aW+"&ptype="+aX.data("type")+"&guid="+M+aV})})});$(".withdraw-btn").click(function(){var aV=$(this);h.getSecondPassword(function(){var aW=h.getPreferredAddress();loadScript("wallet/frame-modal",function(){showFrameModal({title:aV.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(ay)+"</b>",src:root+"withdraw?method="+aV.data("type")+"&address="+aW+"&balance="+ay+"&guid="+M})})})});$("#logout").click(h.logout);$("#refresh").click(function(){J();h.get_history()});$("#summary-n-tx-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Number of transactions",description:"",src:root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|")})})});$("#summary-received-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"BTC Received Per Day",description:"",src:root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|")})})});$("#summary-balance-chart").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Wallet Balance",description:"",src:root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|")})})});$("#new-addr").click(function(){try{J(function(){h.getSecondPassword(function(){var aX=h.generateNewKey();if(!aX){return}var aW=aX.getBitcoinAddress().toString();h.backupWallet("update",function(){h.makeNotice("info","new-address","Generated new Bitcoin Address "+aW);loadScript("wallet/address_modal",function(){showLabelAddressModal(aW)})})})})}catch(aV){h.makeNotice("error","misc-error",aV)}});$(".tx_filter a").click(function(){aw=0;ar=$(this).data("value");h.get_history()});$(".tx_display a").click(function(){var aV=$(this).data("value");if(aV=="export"){v();return}s.tx_display=aV;c();ai()});$("#email-backup-btn").click(function(){G()});$("#dropbox-backup-btn").click(function(){h.openWindow(root+"wallet/dropbox-login?guid="+M)});$("#gdrive-backup-btn").click(function(){h.openWindow(root+"wallet/gdrive-login?guid="+M)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aX,aW){var aV=$(this);r(aV,aW);aV.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aV,"quick",initNewTx())})})});$("#send-email").on("show",function(aX,aW){var aV=$(this);r(aV,aW);aV.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aV,"email",initNewTx())})})});$("#send-shared").on("show",function(aX,aW){var aV=$(this);r(aV,aW);aV.find(".mixer_fee").text(x);aV.find(".fees,.free,.bonus").show();if(x<0){aV.find(".fees,.free").hide()}else{if(x==0){aV.find(".fees,.bonus").hide()}else{aV.find(".free,.bonus").hide()}}aV.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aV,"shared",initNewTx())})});aV.find(".shared-fees").text("0.00");aV.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aZ=parseFloat($(this).val());var aY=0;if(aZ>0){if(x>0){aY=parseFloat(aZ+((aZ/100)*x))}else{aY=parseFloat(aZ);aV.find(".bonus-value").text(formatPrecision((Math.min(aZ,precisionFromBTC(200))/100)*x))}}if(precisionToBTC(aZ)<0.1||precisionToBTC(aZ)>250){aV.find(".shared-fees").text("0.00");aV.find(".send").prop("disabled",true)}else{aV.find(".shared-fees").text(formatBTC(aY*symbol_btc.conversion));aV.find(".send").prop("disabled",false)}aV.find('input[name="send-value"]').val(aY).trigger("keyup")})});$("#send-custom").on("show",function(aX,aW){var aV=$(this);r(aV,aW);aV.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aV,"custom",initNewTx())})});aV.find(".reset").unbind().click(function(){r(aV,true);aV.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice").on("show",function(aX,aW){var aV=this;loadScript("wallet/dicegames",function(){try{DICEGame.init($(aV))}catch(aY){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aY){h.makeNotice("error","misc-error",aY)})});$("#shared-coin").on("show",function(aX,aW){var aV=$(this);loadScript("wallet/sharedcoin",function(){try{r(aV);SharedCoin.init(aV)}catch(aY){console.log(aY);h.makeNotice("error","misc-error",aY)}},function(aY){h.makeNotice("error","misc-error",aY)})});$("#send-sms").on("show",function(aX,aW){if(aW){return}var aV=$(this);r(aV);$.ajax({type:"GET",url:resource+"wallet/country_codes.html",success:function(aY){aV.find('select[name="sms-country-code"]').html(aY)},error:function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aV.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){var aY=initNewTx();startTxUI(aV,"sms",aY)})})});$("#address-book").on("show",function(){var aW=$("#address-book-tbl tbody");if(aE(g)>0){aW.empty();for(var aV in g){var aX=$("<tr><td>"+g[aV]+'</td><td><div class="addr-book-entry">'+aV+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aY){aX.find(".act-delete").click(function(){h.deleteAddressBook(aY)})})(aV);aW.append(aX)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aV){$(aV.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){af($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();aC()}function p(){$(".resend-code").click(function(){h.setGUID(M,true)});$("#reset-two-factor-btn").click(function(){h.openWindow(root+"wallet/reset-two-factor"+(M?"?guid="+M:""))});$(".recover-wallet-btn").click(function(){h.openWindow(root+"wallet/forgot-password"+(M?"?guid="+M:""))});$(".download-backup-btn").toggle(aj!=null).click(function(){if(!aj){h.makeNotice("error","error","No Wallet Data to Download");return}try{var aW=!!new Blob()}catch(aX){}if(aW){loadScript("wallet/filesaver",function(){var aY=new Blob([aj],{type:"text/plain;charset=utf-8"});saveAs(aY,"wallet.aes.json")})}else{var aV=window.open(null,null,"width=700,height=800,toolbar=0");aV.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+aj+"</div></body></html>")}aS()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aV){if(aV.keyCode==13){aV.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aW){aW.preventDefault();var aV=$.trim($("#restore-guid").val());if(aV.length==0){return}if(M!=aV){h.setGUID(aV,false)}else{a()}});$(".modal").on("show",function(){L();$(this).center()}).on("shown",function(){L();$(this).center()})}function am(aW){var aX=Crypto.SHA256(aW+"?");switch(aX.slice(0,2)){case"00":var aY=Crypto.SHA256(aW,{asBytes:true});return aY;break;case"01":var aV=Crypto.util.hexToBytes(aX.slice(2,4))[0];var aZ=Math.round(Math.pow(2,(aV/4)));var aY=Crypto.PBKDF2(aW,"Satoshi Nakamoto",32,{iterations:aZ,asBytes:true});return aY;break;default:console.log("invalid key");break}}function aH(){var aX,aV="";if(window.getSelection){aX=window.getSelection();if(aX.rangeCount){var aY=aX.getRangeAt(0).cloneContents();var aW=document.createElement("div");aW.appendChild(aY);aV=aW.innerText}}else{if(document.selection&&document.selection.type=="Text"){aV=document.selection.createRange().htmlText}}return aV}this.detectPrivateKeyFormat=function(aW){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aW)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aW)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aW)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aW)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aW)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aW)){return"base64"}if(/^6P[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{56}$/.test(aW)){return"bip38"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aW)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aW)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aW)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aW)){var aV=Crypto.SHA256(aW+"?",{asBytes:true});if(aV[0]===0||aV[0]===1){return"mini"}}throw"Unknown Key Format "+aW};this.privateKeyStringToKey=function(aW,aY){var aV=null;if(aY=="base58"){aV=B58.decode(aW)}else{if(aY=="base64"){aV=Crypto.util.base64ToBytes(aW)}else{if(aY=="hex"){aV=Crypto.util.hexToBytes(aW)}else{if(aY=="mini"){aV=am(aW)}else{if(aY=="sipa"){var aX=B58.decode(aW);aX.shift();aV=aX.slice(0,aX.length-4)}else{if(aY=="compsipa"){var aX=B58.decode(aW);aX.shift();aX.pop();aV=aX.slice(0,aX.length-4)}else{throw"Unsupported Key Format"}}}}}}if(aV.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aV)};$(document).ready(function(){if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");var aZ=$(document.body);function a0(){if(M&&M.length==36){setTimeout(function(){h.setGUID(M,false)},10)}else{$("#signup-btn").show()}}M=aZ.data("guid");d=aZ.data("sharedkey");X=aZ.data("language");if(h.skip_init){return}var a1=1;function aY(){--a1;if(a1==-1){p()}}MyStore.get("payload",function(a4){if(!aj&&a4){aj=a4;az=ah()}aY()});MyStore.get("server_time_offset",function(a4){aL=parseInt(a4);if(isNaN(aL)){aL=0}});if((!M||M.length==0)&&(isExtension||window.location.href.indexOf("/login")>0)){++a1;MyStore.get("guid",function(a4){M=a4;a0();aY()})}else{a0()}if(top.location!=self.location){top.location=self.location.href}aZ.click(function(){if(U){clearTimeout(U);U=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(U){clearTimeout(U);U=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).mousemove(function(a4){if(a4){rng_seed_int(a4.clientX*a4.clientY)}});aY();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var a3=false;var aW=17,aX=86,aV=67,a2=67;$(document).keydown(function(a5){try{if(a5.keyCode==aW||a5.keyCode==a2){a3=true}if(a3&&a5.keyCode==aV){var a4=$.trim(aH());var a6=I[a4];if(a6!=null){if(a6.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(a6.tag==1){O()}}}}}catch(a5){console.log(a5)}}).keyup(function(a4){if(a4.keyCode==aW||a4.keyCode==a2){a3=false}}).ajaxStart(function(){au("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){au("loading_stop");$(".loading-indicator").hide()})});function aU(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}};