var MyWallet=new function(){var h=this;this.skip_init=false;var D="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var ab;var M;var j;var ay;var ae;var w;var d;var ao=0;var P=0;var aj=0;var K=0;var aI=0;var aw;var g={};var E=[];var F=false;var am=0;var ai=0;var ar=1000;var I={};var ap;var ag;var x=0.5;var S=10;var b={};var aC=0;var q;var R;var V=[];var B;var N=60000;var A=false;var s={fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false};this.setEncryptedWalletData=function(aK){if(!aK||aK.length==0){ab=null;ap=null;return}ab=aK;ap=aa();try{if(aC==0||s.always_keep_local_backup){localStorage.setItem("payload",ab)}}catch(aL){console.log(aL)}};this.setRealAuthType=function(aK){this.real_auth_type=aK};this.addEventListener=function(aK){V.push(aK)};this.getLogoutTime=function(){return s.logout_time};this.setLogoutTime=function(aK){s.logout_time=aK;clearInterval(R);R=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return F};this.getEncryptedWalletData=function(){return ab};this.getFeePolicy=function(){return s.fee_policy};this.setFeePolicy=function(aK){s.fee_policy=aK};this.setAlwaysKeepLocalBackup=function(aK){s.always_keep_local_backup=aK};this.getAlwaysKeepLocalBackup=function(){return s.always_keep_local_backup};this.getGuid=function(){return M};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aK){s.html5_notifications=aK};this.getTransactions=function(){return E};this.addressExists=function(aK){return I[aK]!=null};this.getAddressTag=function(aK){return I[aK].tag};this.setAddressTag=function(aL,aK){I[aL].tag=aK};this.getAddressBook=function(){return g};this.getAddressLabel=function(aK){return I[aK].label};this.setAddressLabel=function(aK,aL){I[aK].label=aL};this.setAddressBalance=function(aK,aL){I[aK].balance=aL};this.getAddressBookLabel=function(aK){return g[aK]};this.isWatchOnly=function(aK){return I[aK].priv==null};this.getAddressBalance=function(aK){return I[aK].balance};this.getMixerFee=function(){return x};this.deleteAddress=function(aK){delete I[aK]};this.addAddressBookEntry=function(aL,aK){g[aL]=aK};this.getPrivateKey=function(aK){return I[aK].priv};this.setLabel=function(aK,aL){I[aK].label=aL;ac();c()};this.securePost=function(aL,aM,aN,aK){var aO=jQuery.extend({},aM);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aO.sharedKey=d;aO.guid=M;aO.format=aM.format?aM.format:"plain";$.ajax({dataType:aM.format?aM.format:"text",type:"POST",url:root+aL,data:aO,success:function(aP){aN(aP)},error:function(aP){aK(aP)}})};this.isCorrectMainPassword=function(aK){return ay==aK};this.setDoubleEncryption=function(aM,aK,aO){var aL=function(aP){console.log("Panic "+aP);window.location.reload()};try{if(F==aM){return}if(aM){h.getSecondPassword(function(){try{F=true;ae=aK;for(var aR in I){var aT=I[aR];if(aT.priv!=null){aT.priv=i(B58.decode(aT.priv))}}var aP=Crypto.SHA256(d+ae,{asBytes:true});for(var aQ=1;aQ<S;++aQ){aP=Crypto.SHA256(aP,{asBytes:true})}w=Crypto.util.bytesToHex(aP);ae=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){aO()},function(){aL(aU)})}catch(aU){aL(aU)}},function(){aL()})}catch(aS){aL(aS)}},function(){aL()})}else{h.getSecondPassword(function(){try{for(var aP in I){var aR=I[aP];if(aR.priv!=null){aR.priv=h.decryptPK(aR.priv)}}F=false;ae=null;h.checkAllKeys();h.backupWallet("update",function(){aO()},function(){aL(aQ)})}catch(aQ){aL(aQ)}},function(aP){aL(aP)})}}catch(aN){aL(aN)}};this.unArchiveAddr=function(aK){var aK=I[aK];if(aK.tag==2){aK.tag=null;c();ac("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aK){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aK=I[aK];if(aK.tag==null||aK.tag==0){aK.tag=2;c();ac("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};this.addWatchOnlyAddress=function(aK){return aG(aK)};this.addPrivateKey=function(aL,aK){if(ad()){return false}if(aL==null){throw"Unable to generate a new bitcoin address."}var aP=aK?aL.getBitcoinAddressCompressed().toString():aL.getBitcoinAddress().toString();var aO=i(aL.priv);var aM=new Bitcoin.ECKey(h.decodePK(i(aL.priv)));if(aP!=aM.getBitcoinAddress().toString()&&aP!=aM.getBitcoinAddressCompressed().toString()){throw"Decoded Key address does not match generated address"}if(aG(aP,aO)){I[aP].tag=1;try{ws.send('{"op":"addr_sub", "addr":"'+aP+'"}')}catch(aN){}}else{throw"Unable to add generated bitcoin address."}return aP};this.generateNewKey=function(){var aK=new Bitcoin.ECKey(false);if(h.addPrivateKey(aK)){return aK}};this.setLoadingText=function(aK){$(".loading-text").text(aK)};function L(){try{$(".popover").remove()}catch(aK){}}$(window).resize(function(){$(".modal:visible").center();L()});function aF(aL,aK){aL.click(function(){z(aK.txIndex,aK.result)});aL.find(".show-note").mouseover(function(){var aM=aK.note?aK.note:b[aK.hash];aA(this,aM,aK.hash)});aL.find(".add-note").mouseover(function(){m(this,aK.hash)});return aL}function t(aL,aR){var aK=0;for(var aN=0;aN<aL.inputs.length;++aN){var aM=aL.inputs[aN].prev_out;if(!aM||!aM.addr){continue}var aQ=I[aM.addr];if(aQ){var aP=parseInt(aM.value);aK-=aP;if(aR){P+=aP;aQ.balance-=aP}}}for(var aO=0;aO<aL.out.length;++aO){var aM=aL.out[aO];if(!aM||!aM.addr){continue}var aQ=I[aM.addr];if(aQ){var aP=parseInt(aM.value);aK+=aP;if(aR){aj+=aP;aQ.balance+=aP}}}return aK}function aa(){return Crypto.util.bytesToHex(Crypto.SHA256(ab,{asBytes:true}))}function y(aK){aK.onmessage=function(aS){try{var aP=$.parseJSON(aS.data);if(aP.op=="on_change"){var aT=aa();var aR=aP.checksum;console.log("On change old "+aT+" ==  new "+aR);if(aT!=aR){setTimeout(J,250)}}else{if(aP.op=="utx"){var aQ=TransactionFromJSON(aP.x);for(var aV in E){if(E[aV].txIndex==aQ.txIndex){return}}var aX=t(aQ,true);if(h.getHTML5Notifications()){var aO=function(aY){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(aY.iconUrl,aY.title,aY.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()==="granted"){new Notification(aY.title,aY).show()}}}}catch(aZ){}};try{aO({title:aX>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(aX)+" BTC",iconUrl:resource+"cube48.png"})}catch(aS){console.log(aS)}}aQ.result=aX;ao+=aX;K++;aQ.setConfirmations(0);playSound("beep");if(ai==0&&am==0){E.unshift(aQ);var aU=false;if(E.length>50){E.pop();aU=true}}var aM=T();if("my-transactions"==aM){if(ai==0&&am==0){$("#no-transactions").hide();if(s.tx_display==0){var aL=$("#transactions-compact").show();aF($(C(aQ,I,g)),aQ).prependTo(aL.find("tbody")).find("div").hide().slideDown("slow");if(aU){aL.find("tbody tr:last-child").remove()}}else{var aL=$("#transactions-detailed").show();aL.prepend(aQ.getHTML(I,g));if(aU){aL.find("div:last-child").remove()}setupSymbolToggle()}}}else{c()}}else{if(aP.op=="block"){for(var aN=0;aN<aP.x.txIndexes.length;++aN){for(var aW=0;aW<E.length;++aW){if(E[aW].txIndex==aP.x.txIndexes[aN]){if(E[aW].blockHeight==null||E[aW].blockHeight==0){E[aW].blockHeight=aP.x.height;break}}}}an(BlockFromJSON(aP.x));U()}}}}catch(aS){console.log(aS);console.log(aS.data)}};aK.onopen=function(){ak("ok");var aO='{"op":"blocks_sub"}';if(M!=null){aO+='{"op":"wallet_sub","guid":"'+M+'"}'}try{var aM=h.getActiveAddresses();for(var aL in aM){aO+='{"op":"addr_sub", "addr":"'+aM[aL]+'"}'}}catch(aN){alert(aN)}aK.send(aO)};aK.onclose=function(){ak("error")}}var aE="ok";function ak(aL){var aK=$("#logout");if(aL=="loading_start"){aK.attr("src",resource+"logout-orange.png");return}else{if(aL!="loading_stop"){aE=aL}}if(aE=="ok"){aK.attr("src",resource+"logout.png")}else{if(aE=="error"){aK.attr("src",resource+"logout-red.png")}}}this.makeNotice=function(aL,aO,aN,aM){if(aN==null||aN.length==0){return}console.log(aN);if(aM==null){aM=5000}var aK=$('<div class="alert alert-block alert-'+aL+'"></div>');aK.text(""+aN);if($("#"+aO).length>0){aK.attr("id",aO);return}$("#notices").append(aK).hide().fadeIn(200);if(aM>0){(function(){var aP=aK;setTimeout(function(){aP.fadeOut(250,function(){$(this).remove()})},aM)})()}};function av(aK){return aK}function al(aK){return h.decryptPK(aK)}function X(aK){var aL=h.decodePK(aK);return Crypto.util.bytesToBase64(aL)}function k(aK){var aL=h.decodePK(aK);return Crypto.util.bytesToHex(aL)}this.base58ToSipa=function(aK,aP){var aL=h.decodePK(aK);var aM=new Bitcoin.ECKey(aL);while(aL.length<32){aL.unshift(0)}aL.unshift(128);if(aM.getBitcoinAddress().toString()==aP){}else{if(aM.getBitcoinAddressCompressed().toString()==aP){aL.push(1)}else{throw"Private Key does not match bitcoin address"+aP}}var aN=Crypto.SHA256(Crypto.SHA256(aL,{asBytes:true}),{asBytes:true});aL=aL.concat(aN.slice(0,4));var aO=B58.encode(aL);return aO};this.makeWalletJSON=function(aK){return h.makeCustomWalletJSON(aK,M,d)};this.makeCustomWalletJSON=function(aO,aL,aQ){var aN=av;if(aO=="base64"){aN=X}else{if(aO=="hex"){aN=k}else{if(aO=="sipa"){aN=h.base58ToSipa}else{if(aO=="base58"){aN=al}}}}var aK='{\n	"guid" : "'+aL+'",\n	"sharedKey" : "'+aQ+'",\n';if(F&&w!=null&&aN==av){aK+='	"double_encryption" : '+F+',\n	"dpasswordhash" : "'+w+'",\n'}if(s){aK+='	"options" : '+JSON.stringify(s)+",\n"}aK+='	"keys" : [\n';for(var aM in I){var aP=I[aM];aK+='	{"addr" : "'+aP.addr+'"';if(aP.priv!=null){aK+=',\n	 "priv" : "'+aN(aP.priv,aP.addr)+'"'}if(aP.tag==2){aK+=',\n	 "tag" : '+aP.tag}if(aP.label!=null){aK+=',\n	 "label" : "'+aP.label+'"'}aK+="},\n";atLeastOne=true}if(atLeastOne){aK=aK.substring(0,aK.length-2)}aK+="\n	]";if(au(g)>0){aK+=',\n	"address_book" : [\n';for(var aM in g){aK+='	{"addr" : "'+aM+'",\n';aK+='	 "label" : "'+g[aM]+'"},\n'}aK=aK.substring(0,aK.length-2);aK+="\n	]"}if(au(b)>0){aK+=',\n	"tx_notes" : '+JSON.stringify(b)}aK+="\n}";return aK};this.get_history=function(aL,aK){BlockchainAPI.get_history(function(aM){H(aM,false);c();if(aL){aL()}},function(){if(aK){aK()}},ai,am)};this.deleteAddressBook=function(aK){delete g[aK];ac();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aK){$("#send-coins").find(".tab-pane.active").trigger("show",aK);if(aK){BlockchainAPI.get_ticker();$(".send").attr("disabled",false)}}function l(aK,aL,aP){var aO=aK.val();aK.empty();for(var aN in I){var aQ=I[aN];if(!aQ||aQ.tag==2){continue}var aM=aQ.label;if(!aM){aM=aQ.addr.substring(0,15)+"..."}if(aL||aQ.balance>0){aK.prepend('<option value="'+aQ.addr+'">'+aM+" - "+formatBTC(aQ.balance)+" BTC</option>")}}aK.prepend('<option value="any" selected>Any Address</option>');if(!aP&&aO){aK.val(aO)}}function r(aM,aN){l(aM.find('select[name="from"]'),false,aN);l(aM.find('select[name="change"]'),true,aN);aM.find('select[name="change"]').prepend('<option value="new">New Address</option>');if(aN){aM.find("input").val("");aM.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aM.find(".amount-needed").text(0)}var aL=aM.find(".recipient-container");if(aN){var aP=aL.find(".recipient:first-child").clone();aL.empty().append(aP)}function aK(){var aQ=0;aM.find('input[name="send-value"]').each(function(){var aR=parseFloat($(this).val());if(!isNaN(aR)){aQ+=aR}});return aQ}function aO(aQ){aQ.find('input[name="send-to-address"]').val("").typeahead({source:aq()}).next().click(function(){var aR=$(this).prev();h.scanQRCode(function(aS){console.log(aS);try{new Bitcoin.Address(aS);aR.val(aS)}catch(aT){loadScript("wallet/jsuri-1.1.1",function(){try{var aU=new Uri(aS);aR.val(aU.host());aQ.find('input[name="send-value"]').val(aU.getQueryParamValue("amount"))}catch(aV){h.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){h.makeNotice("error","error","Invalid Bitcoin Address or URI")})}},function(aS){h.makeNotice("error","misc-error",aS)})});aQ.find(".local-symbol").text(symbol_local.symbol);aQ.find('input[name="send-value"]').val("").bind("keyup change",function(aR){if(aR.keyCode=="9"){return}aM.find(".amount-needed").text(formatBTC(Bitcoin.Util.parseValue(aK().toFixed(8)).toString()));aQ.find(".send-value-usd").val(convert($(this).val()*100000000,symbol_local.conversion)).text(formatSymbol($(this).val()*100000000,symbol_local))});aQ.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aR){if(aR.keyCode=="9"){return}aQ.find('input[name="send-value"]').val(formatBTC(parseFloat($(this).val())*symbol_local.conversion))})}aL.find(".recipient").each(function(){aO($(this))});aM.find(".remove-recipient").unbind().click(function(){var aQ=aL.find(".recipient").length;if(aQ>1){if(aQ==2){$(this).hide(200)}aL.find(".recipient:last-child").remove()}});aM.find(".add-recipient").unbind().click(function(){var aQ=aL.find(".recipient:first-child").clone();aQ.appendTo(aL);aO(aQ);aM.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aL=[];for(var aK in I){aL.push(aK)}return aL};this.getPreferredAddress=function(){var aL=null;for(var aK in I){var aM=I[aK];if(aL==null){aL=aM}if(aM.priv!=null){if(aL==null){aL=aM}if(aM.tag==null||aM.tag==0){aL=aM;break}}}return aL.addr};function aH(){console.log("backupInstructionsModal");var aK=$("#restore-backup-modal");aK.modal({keyboard:true,backdrop:"static",show:true});aK.find(".btn.btn-secondary").unbind().click(function(){aK.modal("hide")})}this.scanQRCode=function(aM,aK){var aL=$("#qr-code-reader-modal");aL.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader",function(){QRCodeReader.init(aL,function(aN){aL.modal("hide");aM(aN)},function(aN){aL.modal("hide");aK(aN)})},aK);aL.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();aL.modal("hide");aK()})};this.getActiveAddresses=function(){var aM=[];for(var aK in I){var aL=I[aK];if(aL.tag!=2){aM.push(aL.addr)}}return aM};this.getArchivedAddresses=function(){var aM=[];for(var aK in I){var aL=I[aK];if(aL.tag==2){aM.push(aL.addr)}}return aM};function an(aN){if(aN!=null){aw=aN;for(var aL in E){var aK=E[aL];if(aK.blockHeight!=null&&aK.blockHeight>0){var aM=aw.height-aK.blockHeight+1;if(aM<=100){aK.setConfirmations(aw.height-aK.blockHeight+1)}else{aK.setConfirmations(null)}}else{aK.setConfirmations(0)}}}}function z(aL,aK){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aL+"?result="+aK+"&guid="+M})})}this.deleteNote=function(aK){delete b[aK];c();ac()};function m(aK,aL){(function(aN,aP){aN=$(aN);if(!aN.data("popover")){aN.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aN.data("popover").tip().is(":visible")){return}}aN.popover("show");aN.mouseleave(function(){if(!aN.__timeout){aN.__timeout=setTimeout(function(){aN.popover("hide")},250)}});function aM(){if(aN.__timeout){clearTimeout(aN.__timeout);aN.__timeout=null}}var aO=aN.data("popover").tip().mouseenter(aM);aO.find("textarea").focus(aM);aO.mouseleave(function(){aN.__timeout=setTimeout(function(){aN.popover("hide")},250)});aO.find("i").unbind().click(function(){aN.popover("hide")});aO.find("button").click(function(){var aQ=$.trim($("<div>"+aO.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aQ.length>0){b[aP]=aQ;ac()}c()})})(aK,aL)}function aA(aK,aL,aM){(function(aN,aO,aQ){aN=$(aN);if(!aN.data("popover")){var aR="Note";if(b[aQ]){aR+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aN).popover({title:aR,trigger:"manual",content:aO})}else{if(aN.data("popover").tip().is(":visible")){return}}aN.popover("show");aN.mouseleave(function(){if(!aN.__timeout){aN.__timeout=setTimeout(function(){aN.popover("hide")},250)}});var aP=aN.data("popover").tip().mouseenter(function(){if(aN.__timeout){clearTimeout(aN.__timeout);aN.__timeout=null}});aP.find("img").unbind().click(function(){h.deleteNote(aQ)});aP.mouseleave(function(){aN.__timeout=setTimeout(function(){aN.popover("hide")},250)})})(aK,aL,aM)}function C(aN,aS,aP){var aT=aN.result;var aO='<tr class="pointer" id="tx-'+aN.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aL=true;if(aT>=0){for(var aM=0;aM<aN.inputs.length;++aM){var aK=aN.inputs[aM].prev_out;if(!aK||!aK.addr){aL=false;aO+='<span class="label">Newly Generated Coins</span>'}else{var aQ=aS[aK.addr];if(aQ){continue}aL=false;aO+=formatOutput(aK,aS,aP)}}}else{if(aT<0){for(var aM=0;aM<aN.out.length;++aM){var aK=aN.out[aM];var aQ=aS[aK.addr];if(aQ&&aK.type==0){continue}aL=false;aO+=formatOutput(aK,aS,aP)}}}if(aL){aO+='<span class="label">Moved Between Wallet</info>'}aO+="</ul></div></td><td><div>";var aR=aN.note?aN.note:b[aN.hash];if(aR){aO+='<img src="'+resource+'note.png" class="show-note"> '}else{aO+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(aN.time>0){aO+=dateToString(new Date(aN.time*1000))}if(aN.confirmations==0){aO+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aN.confirmations>0){aO+=' <span class="label label-info pull-right hidden-phone">'+aN.confirmations+" Confirmations</span> "}}aO+="</div></td>";if(aT>0){aO+='<td style="color:green"><div>'+formatMoney(aT,true)+"</div></td>"}else{if(aT<0){aO+='<td style="color:red"><div>'+formatMoney(aT,true)+"</div></td>"}else{aO+="<td><div>"+formatMoney(aT,true)+"</div></td>"}}if(aN.balance==null){aO+="<td></td></tr>"}else{aO+='<td class="hidden-phone"><div>'+formatMoney(aN.balance)+"</div></td></tr>"}return aO}function T(){L();if(ao==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(ao,symbol));$("#balance2").html(formatSymbol(ao,(symbol==symbol_local)?symbol_btc:symbol_local))}return j.attr("id")}function c(aK){var aL=T();if("send-coins"==aL){u(aK)}else{if("home-intro"==aL){f(aK)}else{if("receive-coins"==aL){aJ(aK)}else{if("my-transactions"==aL){U(aK)}}}}}function f(aK){$("#summary-n-tx").html(K);$("#summary-received").html(formatMoney(aj,true));$("#summary-sent").html(formatMoney(P,true));$("#summary-balance").html(formatMoney(ao,symbol));var aM=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aM+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});if(h.isWatchOnly(aM)){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aL=$("#my-primary-address");if(aL.text()!=aM){aL.text(aM);loadScript("wallet/jquery.qrcode",function(){$("#my-primary-addres-qr-code").empty().qrcode({width:125,height:125,text:aM})})}}}function Q(){var aK=$("#export-warning").show();var aL=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aK.hide();loadScript("wallet/import-export",function(){ImportExport.init(aL,function(){aL.show()},function(){Z($("#home-intro"))})},function(aM){h.makeNotice("error","misc-error",aM);Z($("#home-intro"))})},function(){Z($("#home-intro"))})})}function U(){var aL=null;var aN=0;if(aL!=null){clearInterval(aL);aL=null}var aK;if(s.tx_display==0){$("#transactions-detailed").hide();aK=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aK=$("#transactions-detailed").empty().show()}if(E.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aM=function(){for(var aR=aN;aR<E.length&&aR<(aN+10);++aR){var aQ=E[aR];if(s.tx_display==0){aK.append(aF($(C(aQ,I,g)),aQ))}else{aK.append(aQ.getHTML(I,g))}}aN+=10;if(aN<E.length){aL=setTimeout(aM,15)}else{setupSymbolToggle();L();var aP=$(".pagination ul").empty();if(am==0&&E.length<50){aP.hide();return}else{aP.show()}var aO=Math.ceil(aI/50);var aS=" disabled";if(am>0){aS=""}aP.append($('<li class="prev'+aS+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(am-1)}));for(var aR=0;aR<aO&&aR<=10;++aR){(function(aT){var aU="";if(am==aT){aU=' class="active"'}aP.append($("<li"+aU+'><a class="hidden-phone">'+aT+"</a></li>").click(function(){h.setPage(aT)}))})(aR)}var aS=" disabled";if(am<aO){aS=""}aP.append($('<li class="next'+aS+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(am+1)}))}};aM()}this.setPage=function(aK){am=aK;scroll(0,0);h.get_history()};function v(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})}function H(aN,aM){if(!aM&&aN.mixer_fee){x=aN.mixer_fee}if(aN.disable_mixer){$("#shared-addresses,#send-shared").hide()}E.length=0;if(aN.wallet==null){aj=0;P=0;ao=0;K=0;aI=0;return}aj=aN.wallet.total_received;P=aN.wallet.total_sent;ao=aN.wallet.final_balance;K=aN.wallet.n_tx;aI=aN.wallet.n_tx_filtered;for(var aL=0;aL<aN.addresses.length;++aL){if(I[aN.addresses[aL].address]){I[aN.addresses[aL].address].balance=aN.addresses[aL].final_balance}}for(var aL=0;aL<aN.txs.length;++aL){var aK=TransactionFromJSON(aN.txs[aL]);aK.result=t(aK,false);E.push(aK)}if(aN.info){$("#nodes-connected").html(aN.info.nconnected);if(aN.info.latest_block!=null){an(aN.info.latest_block)}setLocalSymbol(aN.info.symbol_local)}}function aB(){R=setTimeout(h.logout,h.getLogoutTime());for(var aL in V){V[aL]("did_decrypt")}window.location.hash="";try{var aK=localStorage.getItem("multiaddr");if(aK!=null){H($.parseJSON(aK),true);c()}}catch(aM){}h.get_history();Z($("#home-intro"));$("#initial_error,#initial_success").remove()}function J(){for(var aK in I){var aM=I[aK];if(aM.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have un-saved keys");return}}console.log("Get wallet with checksum "+ap);var aL={guid:M,sharedKey:d,format:"plain"};if(ap&&ap.length>0){aL.checksum=ap}$.ajax({type:"GET",url:root+"wallet/wallet.aes.json",data:aL,success:function(aN){if(aN==null||aN.length==0||aN=="Not modified"){return}console.log("Wallet data modified");h.setEncryptedWalletData(aN);if(W()){h.get_history();c()}else{window.location.reload()}}})}function W(){try{if(ab==null||ab.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aN=null;h.decrypt(ab,ay,function(aO){try{aN=$.parseJSON(aO);return(aN!=null)}catch(aP){return false}});if(aN==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aN.double_encryption&&aN.dpasswordhash){F=aN.double_encryption;w=aN.dpasswordhash}if(aN.options){$.extend(s,aN.options)}else{if(aN.fee_policy){h.setFeePolicy(aN.fee_policy)}if(aN.html5_notifications){h.setHTML5Notifications(aN.html5_notifications)}}I={};for(var aL=0;aL<aN.keys.length;++aL){var aK=aN.keys[aL];if(aK.addr==null||aK.addr.length==0||aK.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}if(aK.tag==1){aK.tag=null}I[aK.addr]=aK}g={};if(aN.address_book){for(var aL=0;aL<aN.address_book.length;++aL){h.addAddressBookEntry(aN.address_book[aL].addr,aN.address_book[aL].label)}}if(aN.tx_notes){b=aN.tx_notes}d=aN.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(ap==null||ap.length==0){ap=aa()}J();e();return true}catch(aM){h.makeNotice("error","misc-error",aM)}return false}this.getPassword=function(aP,aQ,aN){aP.modal({keyboard:false,backdrop:"static",show:true});aP.center();var aM=aP.find('input[name="password"]');var aL=aM,aK=false,aO=false;aP.find(".vkeyboard li").click(function(){var aT=$(this),aS=aT.html();if(aT.hasClass("left-shift")||aT.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aK=(aK===true)?false:true;aO=false;return false}if(aT.hasClass("capslock")){$(".letter").toggleClass("uppercase");aO=true;return false}if(aT.hasClass("delete")){var aR=aL.val();aL.val(aR.substr(0,aR.length-1));return false}if(aT.hasClass("symbol")){aS=$("span:visible",aT).html()}if(aT.hasClass("space")){aS=" "}if(aT.hasClass("tab")){aS="\t"}if(aT.hasClass("return")){aS="\n"}if(aT.hasClass("uppercase")){aS=aS.toUpperCase()}if(aK===true){$(".symbol span").toggle();if(aO===false){$(".letter").toggleClass("uppercase")}aK=false}aL.val(aL.val()+aS)});aM.unbind().keypress(function(aR){if(aR.keyCode==13){aR.preventDefault();aP.find(".btn.btn-primary").click()}});aM.val("");aP.find(".btn.btn-primary").unbind().click(function(){if(aQ){aN=null;var aR=aQ;aQ=null;aP.modal("hide");setTimeout(function(){aR(aM.val())},100)}});aP.find(".btn.btn-secondary").unbind().click(function(){if(aN){var aR=aN;aN=null;setTimeout(function(){try{aR()}catch(aS){h.makeNotice("error","misc-error",aS)}},100)}aP.modal("hide")});aP.unbind().on("hidden",function(){if(aN){var aR=aN;aN=null;setTimeout(function(){try{aR()}catch(aS){h.makeNotice("error","misc-error",aS)}},100)}})};this.makePairingQRCode=function(aK){h.getMainPassword(function(){loadScript("wallet/jquery.qrcode",function(){try{aK($("<div></div>").qrcode({width:300,height:300,text:M+"|"+d+"|"+ay}))}catch(aL){h.makeNotice("error","misc-error",aL)}})},function(){h.logout()})};this.getMainPassword=function(aL,aK){if(B>new Date().getTime()-N){return aL(ay)}h.getPassword($("#main-password-modal"),function(aM){if(ay==aM){B=new Date().getTime();if(aL){try{aL(ay)}catch(aN){h.makeNotice("error","misc-error",aN)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aK){try{aK()}catch(aN){h.makeNotice("error","misc-error",aN)}}}},aK)};this.getSecondPassword=function(aM,aK){if(!F||ae!=null){if(aM){try{aM(ae)}catch(aL){h.makeNotice("error","misc-error",aL)}}return}h.getPassword($("#second-password-modal"),function(aN){if(az(aN)){if(aM){try{aM(aN)}catch(aO){h.makeNotice("error","misc-error",aO)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aK){try{aK()}catch(aO){h.makeNotice("error","misc-error",aO)}}}},aK)};function a(){if(A){console.log("Already initd");return}var aK=$("#restore-password");ay=aK.val();aK.val("");B=new Date().getTime();if(ab==null||ab.length==0){h.setLoadingText("Validating Authentication key");var aL=$.trim($(".auth-"+q).find(".code").val());if(aL.length==0||aL.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.ajax({type:"POST",url:root+"wallet",data:{guid:M,payload:aL,length:aL.length,method:"get-wallet",format:"plain"},success:function(aM){try{if(aM==null||aM.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}h.setEncryptedWalletData(aM);$(".auth-"+q).hide();$(".auth-0").show();if(W()){n();aB()}}catch(aN){h.makeNotice("error","misc-error",aN)}},error:function(aM){h.makeNotice("error","misc-error",aM.responseText)}})}else{if(W()){n();aB()}}return true}function e(){ak("error");webSocketConnect(y);A=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.quickSendNoUI=function(aM,aL,aK){loadScript("wallet/signer",function(){h.getSecondPassword(function(){try{var aO=initNewTx();aO.from_addresses=h.getActiveAddresses();aO.to_addresses.push({address:new Bitcoin.Address(aM),value:Bitcoin.Util.parseValue(aL)});aO.addListener(aK);aO.start()}catch(aN){aK.on_error(aN)}},function(aN){aK.on_error(aN)})})};function G(){h.setLoadingText("Sending email backup");$.ajax({type:"POST",url:root+"wallet",data:{guid:M,sharedKey:d,method:"email-backup",format:"plain"},success:function(aK){h.makeNotice("success","backup-success",aK)},error:function(aK){h.makeNotice("error","misc-error",aK.responseText)}})}function ac(aN,aM,aL,aK){if(ag!=null){clearInterval(ag);ag=null}ag=setTimeout(function(){h.backupWallet(aN,aM,aL,aK)},3000)}this.backupWallet=function(aR,aQ,aK){try{if(aR==null){aR="update"}if(au(I)==0){return}var aM=h.makeWalletJSON();var aP=h.encrypt(aM,ay);if(aP.length==0){throw"Error encrypting the JSON output"}var aO=null;h.decrypt(aP,ay,function(aS){try{aO=$.parseJSON(aS);return(aO!=null)}catch(aT){return false}});if(aO==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aL=ap;h.setLoadingText("Saving wallet");h.setEncryptedWalletData(aP);$.ajax({type:"POST",url:root+"wallet",data:{guid:M,length:aP.length,payload:aP,sharedKey:d,checksum:ap,old_checksum:aL,method:aR},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aT){var aV=false;for(var aS in I){var aU=I[aS];if(aU.tag==1){aU.tag=null;aV=true}}h.makeNotice("success","misc-success",aT);c();if(aQ!=null){aQ()}},error:function(aT){for(var aS in I){var aU=I[aS];if(aU.tag==1){$("#not-synced-warning-modal").modal("show");break}}if(aT.responseText==null){h.makeNotice("error","misc-error","Error Saving Wallet",10000)}else{h.makeNotice("error","misc-error",aT.responseText,10000)}c();if(aK!=null){aK()}}})}catch(aN){h.makeNotice("error","misc-error","Error Saving Wallet: "+aN,10000);c();if(aK!=null){aK(aN)}else{throw aN}}};function aD(aK){if(F){if(ae==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aK,d+ae)}else{return aK}return null}this.isBase58=function(aM,aL){for(var aK=0;aK<aM.length;++aK){if(aM[aK]<0||aM[aK]>58){return false}}return true};this.encrypt=function(aL,aK){return Crypto.AES.encrypt(aL,aK,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:S})};this.decrypt=function(aN,aM,aP,aL){try{var aK=Crypto.AES.decrypt(aN,aM,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:S});if(aK!=null&&aK.length>0){if(aP(aK)){return aK}}}catch(aO){console.log(aO)}try{var aK=Crypto.AES.decrypt(aN,aM);if(aK!=null&&aK.length>0){if(aP(aK)){return aK}}}catch(aO){console.log(aO)}try{var aK=Crypto.AES.decrypt(aN,aM,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aK!=null&&aK.length>0){if(aP(aK)){return aK}}}catch(aO){console.log(aO)}try{var aK=Crypto.AES.decrypt(aN,aM,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aK!=null&&aK.length>0){if(aP(aK)){return aK}}}catch(aO){console.log(aO)}if(aL!=null){aL()}return null};this.setGUID=function(aN,aL){console.log("Set GUID "+aN);if(A){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();try{var aK=localStorage.getItem("guid")}catch(aO){}var aM=$("#restore-wallet-continue");aM.attr("disabled",true);console.log("Set GUID ajax");$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+aN,data:{format:"json",resend_code:aL},success:function(aQ){console.log("Set GUID Error");aM.attr("disabled",false);$(".auth-"+q).hide();M=aQ.guid;q=aQ.auth_type;aC=aQ.real_auth_type;h.setEncryptedWalletData(aQ.payload);war_checksum=aQ.war_checksum;setLocalSymbol(aQ.symbol_local);$("#restore-guid").val(M);$(".auth-"+q).show();$("#forgot-password-btn").attr("disabled",false).click(function(){window.location=root+"wallet/forgot-password?guid="+M});$("#reset-two-factor-btn").attr("disabled",false).show().click(function(){window.location=root+"wallet/reset-two-factor?guid="+M});if(aQ.initial_error){h.makeNotice("error","misc-error",aQ.initial_error)}if(aQ.initial_success){h.makeNotice("success","misc-success",aQ.initial_success)}try{if(aK!=M){localStorage.clear();if(M!=D){localStorage.setItem("guid",M)}}}catch(aP){}},error:function(aQ){console.log("Set GUID Success");aM.attr("disabled",false);if(aK==aN&&ab){h.makeNotice("error","misc-error","Error Contacting Server. Using Local Wallet Cache.");M=aK;ap=aa();q=0;$("#restore-guid").val(M);$(".auth-"+q).show();return}try{var aP=$.parseJSON(aQ.responseText);if(aP.initial_error){h.makeNotice("error","misc-error",aP.initial_error);return}}catch(aQ){}if(aQ.responseText){h.makeNotice("error","misc-error",aQ.responseText)}else{h.makeNotice("error","misc-error","Error changing wallet identifier")}}})};function i(aK){var aL=B58.encode(aK);return aD(aL)}this.decryptPK=function(aK){if(F){if(ae==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aK,d+ae,h.isBase58)}else{return aK}return null};this.decodePK=function(aL){var aK=h.decryptPK(aL);if(aK!=null){return B58.decode(aK)}return null};this.signmessage=function(aK,aM){var aO=I[aK];var aN=h.decodePK(aO.priv);var aL=new Bitcoin.ECKey(aN);return Bitcoin.Message.signMessage(aL,aM,aO.addr)};function az(aL){var aK=Crypto.SHA256(d+aL,{asBytes:true});var aN=aK;for(var aM=1;aM<S;++aM){aN=Crypto.SHA256(aN,{asBytes:true})}var aP=Crypto.util.bytesToHex(aN);if(aP==w){ae=aL;return true}if(Crypto.util.bytesToHex(aK)==w){ae=aL;w=aP;return true}var aO=Crypto.SHA256(aL);if(aO==w){ae=aL;w=aP;return true}return false}this.checkAllKeys=function(aK){for(var aL in I){var aP=I[aL];if(aP.addr==null){throw"Null Address Found in wallet "+aL}if(aP.addr.toString()==null){throw"Error decoding wallet address "+aP.addr}if(aP.priv!=null){var aO=h.decodePK(aP.priv);var aN=new Bitcoin.ECKey(aO);var aM=aN.getBitcoinAddress().toString();if(aM!=aP.addr&&aN.getBitcoinAddressCompressed().toString()!=aP.addr){throw"Private key does not match bitcoin address "+aP.addr+" != "+aM}if(aK){aP.priv=i(aO)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aK){h.getMainPassword(function(){ay=aK;h.backupWallet("update",function(){h.logout()},function(){h.logout()})})};function Z(aK){if(aK===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aK;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function au(aM){var aL=0,aK;for(aK in aM){aL++}return aL}function Y(aK){I[aK].priv=null}function ad(){if(au(I)>=ar){h.makeNotice("error","misc-error","We currently support a maximum of "+ar+" private keys, please remove some unused ones.");return true}return false}function aG(aM,aK){var aL=I[aM];if(!aL||aL.length==0){I[aM]={addr:aM,priv:aK,balance:0};return true}else{if(!aL.priv&&aK){aL.priv=aK;return true}}return false}function o(){var aM=$("#add-address-book-entry-modal");aM.modal({keyboard:true,backdrop:"static",show:true});var aK=aM.find('input[name="label"]');var aL=aM.find('input[name="address"]');aK.val("");aL.val("");aM.find(".btn.btn-primary").unbind().click(function(){aM.modal("hide");var aO=$.trim($("<div>"+aK.val()+"</div>").text());var aN=$.trim(aL.val());if(aO.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aO.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aN.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aQ;try{aQ=new Bitcoin.Address(aN);if(aQ==null){throw"Null address"}}catch(aP){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aN]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aN,aO);ac();$("#send-coins").find(".tab-pane").trigger("show",true)});aM.find(".btn.btn-secondary").unbind().click(function(){aM.modal("hide")})}this.logout=function(){if(M==D){window.location=root+"wallet/logout"}else{$.ajax({type:"GET",url:root+"wallet/logout",data:{format:"plain"},success:function(aK){window.location.reload()},error:function(){window.location.reload()}})}};function ah(aQ){var aS=$("#delete-address-modal");aS.modal({keyboard:true,backdrop:"static",show:true});aS.find(".btn.btn-primary").hide();aS.find(".btn.btn-danger").hide();$("#change-mind").hide();aS.find("#to-delete-address").html(aQ.join(" "));aS.find("#delete-balance").empty();var aM=aS.find("#delete-balance");var aK=[];for(var aP in aQ){var aR=aQ[aP];if(I[aR]&&I[aR].priv){aK.push(aQ[aP])}}BlockchainAPI.get_balance(aK,function(aT){aS.find(".btn.btn-primary").show(200);aS.find(".btn.btn-danger").show(200);aM.html("Balance "+formatBTC(aT)+" BTC");if(aT>0){aM.css("color","red")}else{aM.css("color","black")}},function(){aS.find(".btn.btn-primary").show(200);aS.find(".btn.btn-danger").show(200);aM.text("Error Fetching Balance")});var aN=false;var aP=0;var aL=null;var aO=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aO-aP)};aS.find(".btn.btn-primary").unbind().click(function(){changeMind();aS.find(".btn.btn-primary").hide();aS.find(".btn.btn-danger").hide();aL=setInterval(function(){if(aN){return}++aP;changeMind();if(aP==aO){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aT in aQ){Y(aQ[aT])}c();h.backupWallet();clearInterval(aL)}},1000)});aS.find(".btn.btn-danger").unbind().click(function(){changeMind();aS.find(".btn.btn-primary").hide();aS.find(".btn.btn-danger").hide();aL=setInterval(function(){if(aN){return}++aP;changeMind();if(aP==aO){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aT in aQ){h.deleteAddress(aQ[aT])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aL)}}},1000)});aS.unbind().on("hidden",function(){if(aL){aN=true;clearInterval(aL);aL=null}});aS.find(".btn.btn-secondary").unbind().click(function(){aS.modal("hide")})}function aq(){var aM=[];for(var aK in g){aM.push(g[aK])}for(var aK in I){var aL=I[aK];if(aL.tag!=2&&aL.label){aM.push(aL.label)}}return aM}function O(aK){h.getSecondPassword(function(){var aM=$("#sweep-address-modal");aM.modal("show");BlockchainAPI.get_balance(aK,function(aN){aM.find(".balance").text("Amount: "+formatBTC(aN)+" BTC")},function(){aM.find(".balance").text("Error Fetching Balance")});var aL=aM.find('select[name="change"]');l(aL,true);aM.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer",function(){BlockchainAPI.get_balance(aK,function(aN){var aO=initNewTx();aO.fee=aO.base_fee;aO.to_addresses.push({address:new Bitcoin.Address($.trim(aL.val())),value:BigInteger.valueOf(aN).subtract(aO.fee)});aO.from_addresses=aK;aO.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aM.modal("hide")});aM.find(".btn.btn-secondary").unbind().click(function(){aM.modal("hide")})})}function at(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aK){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){Z($("#home-intro"))});$("#my-transactions-btn").click(function(){Z($("#my-transactions"))});$("#send-coins-btn").click(function(){Z($("#send-coins"))});$("#import-export-btn").click(function(){Z($("#import-export"));Q()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal",function(){verifyMessageModal()})});$("#group-received").click(function(){loadScript("wallet/taint_grouping",function(){try{loadTaintData()}catch(aK){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){Z($("#my-account"));var aK=$("#account-settings-warning").show();var aL=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aK.hide();loadScript("wallet/account",function(){AccountSettings.init(aL,function(){aL.show()},function(){Z($("#home-intro"))})},function(aM){h.makeNotice("error","misc-error",aM);Z($("#home-intro"))})},function(){Z($("#home-intro"))})})});$("#enable_archived_checkbox").change(function(){var aK=$(this).is(":checked");$(".archived_checkbox").attr("checked",false);$(".archived_checkbox").attr("disabled",!aK);$("#archived-sweep").attr("disabled",!aK);$("#archived-delete").attr("disabled",!aK)});$("#shared-addresses").on("show",function(){var aK=$(this);loadScript("wallet/shared-addresses",function(){buildSharedTable(aK)})});$("#active-addresses").on("show",function(){var aQ=$(this).find("table:first");aQ.find("tbody:gt(0)").remove();var aN=aQ.find("tbody").empty();for(var aP in I){var aR=I[aP];if(aR.tag==2){continue}var aO="";if(aR.tag==1){aO=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aR.priv==null){aO=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aK="";var aM=aR.addr;if(aR.label!=null){aM=aR.label;aK='<span class="hidden-phone"> - '+aR.addr+"</span>"}var aL=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aR.addr+'" target="new">'+aM+"</a>"+aK+" "+aO+'<div></td><td><span style="color:green">'+formatMoney(aR.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            </ul></div></td></tr>');(function(aS){aL.find(".act-archive").click(function(){h.archiveAddr(aS)});aL.find(".act-label").click(function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(aS)})});aL.find(".act-qr").click(function(){loadScript("wallet/address_modal",function(){showAddressModalQRCode(aS)})});aL.find(".act-sign").click(function(){loadScript("wallet/address_modal",function(){showAddressModalSignMessage(aS)})});aL.find(".act-request").click(function(){loadScript("wallet/frame-modal",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aS+"</b>",src:root+"payment_request?address="+aS})})})})(aR.addr);if(aR.balance>0&&aR.priv){aQ.prepend(aL)}else{aQ.append(aL)}}at()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").attr("checked",false);$("#archived-delete").attr("disabled",true);$("#archived-sweep").attr("disabled",true);$("#archived-addr tbody").empty();var aL=$(this).find("tbody");var aK=h.getArchivedAddresses();var aM=function(){aL.empty();for(var aQ in aK){var aS=I[aK[aQ]];if(aS.tag!=2){continue}var aP="";if(aS.priv==null){aP=' <font color="red">(Watch Only)</font>'}var aN="";var aO=aS.addr;if(aS.label!=null){aO=aS.label;aN='<span class="hidden-phone"> - '+aS.addr+"</span>"}var aR=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aS.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aS.addr+'" target="new">'+aO+"</a>"+aN+" "+aP+'<div></td><td><span style="color:green">'+formatBTC(aS.balance)+'<span class="hidden-phone"> BTC</span></span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aT){aR.find(".act-unarchive").click(function(){h.unArchiveAddr(aT)})})(aS.addr);if(aS.balance>0&&aS.priv){aL.prepend(aR)}else{aL.append(aR)}}};aM();BlockchainAPI.get_balances(aK,function(aN){aM()},function(aN){h.makeNotice("error","misc-error",aN)})});$("#archived-sweep").click(function(){var aK=[];$(".archived_checkbox:checked").each(function(){var aL=I[$(this).val()];if(aL.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aK.push(aL.addr)});if(aK.length==0){return}O(aK)});$("#archived-delete").click(function(){var aK=[];$(".archived_checkbox:checked").each(function(){aK.push($(this).val())});if(aK.length==0){return}ah(aK)});$("#shared-never-ask").click(function(){SetCookie("shared-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var aM=$(this);var aL=h.getPreferredAddress();var aK=aM.data("extra");if(aK==null){aK=""}loadScript("wallet/frame-modal",function(){showFrameModal({title:aM.data("title"),description:"Deposit into address <b>"+aL+"</b>",top_right:'Have Questions? Read <a href="'+aM.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aL+"&ptype="+aM.data("type")+"&guid="+M+"&sharedKey="+d+aK})})});$(".withdraw-btn").click(function(){var aK=$(this);h.getSecondPassword(function(){var aL=h.getPreferredAddress();loadScript("wallet/frame-modal",function(){showFrameModal({title:aK.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(ao)+" BTC</b>",src:root+"withdraw?method="+aK.data("type")+"&address="+aL+"&balance="+ao+"&guid="+M+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){J();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aL=h.generateNewKey().getBitcoinAddress().toString();h.makeNotice("info","new-address","Generated new Bitcoin Address "+aL);h.backupWallet("update",function(){loadScript("wallet/address_modal",function(){showLabelAddressModal(aL)})})})}catch(aK){h.makeNotice("error","misc-error",aK)}});$(".tx_filter a").click(function(){am=0;ai=$(this).data("value");h.get_history()});$(".tx_display a").click(function(){var aK=$(this).data("value");if(aK=="export"){v();return}s.tx_display=aK;c();ac()});$("#email-backup-btn").click(function(){G()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+M+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+M+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aM,aL){var aK=$(this);r(aK,aL);aK.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aK,"quick",initNewTx())})})});$("#send-email").on("show",function(aM,aL){var aK=$(this);r(aK,aL);aK.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aK,"email",initNewTx())})})});$("#send-shared").on("show",function(aM,aL){var aK=$(this);r(aK,aL);aK.find(".mixer_fee").text(x);aK.find(".fees,.free,.bonus").show();if(x<0){aK.find(".fees,.free").hide()}else{if(x==0){aK.find(".fees,.bonus").hide()}else{aK.find(".free,.bonus").hide()}}aK.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aK,"shared",initNewTx())})});aK.find(".shared-fees").text("0.00");aK.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aO=parseFloat($.trim($(this).val()));var aN=0;if(aO>0){if(x>0){aN=parseFloat(aO+((aO/100)*x))}else{aN=parseFloat(aO);aK.find(".bonus-value").text(-(Math.min($(this).val(),200)/100)*x)}}if(aO<0.2||aO>250){aK.find(".shared-fees").text("0.00");aK.find(".send").attr("disabled",true)}else{aK.find(".shared-fees").text(aN.toFixed(4));aK.find(".send").attr("disabled",false)}aK.find('input[name="send-value"]').val(aN).trigger("keyup")})});$("#send-custom").on("show",function(aM,aL){var aK=$(this);r(aK,aL);aK.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){startTxUI(aK,"custom",initNewTx())})});aK.find('select[name="from"]').unbind().change(function(){var aP=0;var aN=$(this).val();for(var aO in aN){if(aN[aO]=="any"){$(this).val("any");aP=ao;break}else{var aQ=I[aN[aO]];if(aQ&&aQ.balance){aP+=aQ.balance}}}aK.find(".amount-available").text(formatBTC(aP))}).trigger("change");aK.find(".reset").unbind().click(function(){r(aK,true);aK.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aM,aL){var aK=this;loadScript("wallet/dicegames",function(){try{DICEGame.init($(aK))}catch(aN){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aN){h.makeNotice("error","misc-error",aN)})});$("#send-sms").on("show",function(aM,aL){if(aL){return}var aK=$(this);r(aK);$.ajax({type:"GET",url:resource+"wallet/country_codes.html",success:function(aN){aK.find('select[name="sms-country-code"]').html(aN)},error:function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aK.find(".send").unbind().click(function(){loadScript("wallet/signer",function(){var aN=initNewTx();startTxUI(aK,"sms",aN)})})});$("#address-book").on("show",function(){var aL=$("#address-book-tbl tbody");if(au(g)>0){aL.empty();for(var aK in g){var aM=$("<tr><td>"+g[aK]+'</td><td><div class="addr-book-entry">'+aK+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aN){aM.find(".act-delete").click(function(){h.deleteAddressBook(aN)})})(aK);aL.append(aM)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aK){$(aK.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){Z($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();at()}function p(){$(".resend-code").click(function(){h.setGUID(M,true)});$(".download-backup-btn").toggle(ab!=null).click(function(){$(this).attr("download","wallet.aes.json");if(!ab){h.makeNotice("error","error","No Wallet Data to Download");return}var aL=("download" in document.createElement("a"));if(window.Blob&&window.URL&&aL){var aM=new Blob([ab]);var aN=window.URL.createObjectURL(aM);$(this).attr("href",aN)}else{var aK=window.open(null,null,"width=700,height=800,toolbar=0");aK.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+ab+"</div></body></html>")}aH()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aK){if(aK.keyCode==13){aK.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aL){aL.preventDefault();var aK=$.trim($("#restore-guid").val());if(aK.length==0){return}if(M!=aK){h.setGUID(aK,false)}else{a()}});$(".modal").on("show",function(){L();$(this).center()}).on("shown",function(){L();$(this).center()})}function af(aL){var aM=Crypto.SHA256(aL+"?");switch(aM.slice(0,2)){case"00":var aN=Crypto.SHA256(aL,{asBytes:true});return aN;break;case"01":var aK=Crypto.util.hexToBytes(aM.slice(2,4))[0];var aO=Math.round(Math.pow(2,(aK/4)));var aN=Crypto.PBKDF2(aL,"Satoshi Nakamoto",32,{iterations:aO,asBytes:true});return aN;break;default:console.log("invalid key");break}}function ax(){var aM,aK="";if(window.getSelection){aM=window.getSelection();if(aM.rangeCount){var aN=aM.getRangeAt(0).cloneContents();var aL=document.createElement("div");aL.appendChild(aN);aK=aL.innerText}}else{if(document.selection&&document.selection.type=="Text"){aK=document.selection.createRange().htmlText}}return aK}this.detectPrivateKeyFormat=function(aL){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aL)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aL)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aL)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aL)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aL)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aL)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aL)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aL)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aL)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aL)){var aK=Crypto.SHA256(aL+"?",{asBytes:true});if(aK[0]===0||aK[0]===1){return"mini"}}throw"Unknown Key Format "+aL};this.privateKeyStringToKey=function(aL,aN){var aK=null;if(aN=="base58"){aK=B58.decode(aL)}else{if(aN=="base64"){aK=Crypto.util.base64ToBytes(aL)}else{if(aN=="hex"){aK=Crypto.util.hexToBytes(aL)}else{if(aN=="mini"){aK=af(aL)}else{if(aN=="sipa"){var aM=B58.decode(aL);aM.shift();aK=aM.slice(0,aM.length-4)}else{if(aN=="sipa"){var aM=B58.decode(aL);aM.shift();aK=aM.slice(0,aM.length-4)}else{if(aN=="compsipa"){var aM=B58.decode(aL);aM.shift();aM.pop();aK=aM.slice(0,aM.length-4)}else{throw"Unsupported Key Format"}}}}}}}if(aK.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aK)};$(document).ready(function(){if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");var aL=$(document.body);M=aL.data("guid");d=aL.data("sharedkey");if(h.skip_init){return}try{ab=localStorage.getItem("payload");if(!M||M.length==0){M=localStorage.getItem("guid")}}catch(aN){}if(M&&M.length==36){setTimeout(function(){h.setGUID(M,false)},10)}if(top.location!=self.location){top.location=self.location.href}aL.ajaxStart(function(){ak("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){ak("loading_stop");$(".loading-indicator").hide()}).click(function(){if(R){clearTimeout(R);R=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(R){clearTimeout(R);R=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()});p();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var aM=false;var aQ=17,aP=86,aK=67,aO=67;$(document).keydown(function(aS){try{if(aS.keyCode==aQ||aS.keyCode==aO){aM=true}if(aM&&aS.keyCode==aK){var aR=$.trim(ax());var aT=I[aR];if(aT!=null){if(aT.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aT.tag==1){$("#not-synced-warning-modal").modal("show")}}}}}catch(aS){console.log(aS)}}).keyup(function(aR){if(aR.keyCode==aQ||aR.keyCode==aO){aM=false}})});function aJ(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}};