var MyWallet=new function(){var h=this;this.skip_init=false;var B="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var Z;var K;var j;var aw;var ac;var v;var d;var am=0;var N=0;var ah=0;var I=0;var aF=0;var au;var g={};var C=[];var D=false;var ak=0;var ag=0;var ap=1000;var G=[];var an;var ae;var w=1.5;var ax=0;var Q=10;var ai=false;var b={};var P;var t=600000;var U=[];var z;var L=60000;var q;this.setHTML5Notifications=function(aH){ai=true};this.addEventListener=function(aH){U.push(aH)};this.getDoubleEncryption=function(){return D};this.getEncryptedWalletData=function(){return Z};this.getFeePolicy=function(){return ax};this.getGuid=function(){return K};this.setFeePolicy=function(aH){ax=aH};this.getHTML5Notifications=function(){return ai};this.setHTML5Notifications=function(aH){ai=aH};this.getTransactions=function(){return C};this.addressExists=function(aH){return G[aH]!=null};this.getAddressTag=function(aH){return G[aH].tag};this.setAddressTag=function(aI,aH){G[aI].tag=aH};this.getAddressBook=function(){return g};this.getAddressLabel=function(aH){return G[aH].label};this.setAddressLabel=function(aH,aI){G[aH].label=aI};this.setAddressBalance=function(aH,aI){G[aH].balance=aI};this.getAddressBookLabel=function(aH){return g[aH]};this.isWatchOnly=function(aH){return G[aH].priv==null};this.getAddressBalance=function(aH){return G[aH].balance};this.getMixerFee=function(){return w};this.deleteAddress=function(aH){delete G[aH]};this.addAddressBookEntry=function(aI,aH){g[aI]=aH};this.getPrivateKey=function(aH){return G[aH].priv};this.setLabel=function(aH,aI){G[aH].label=aI;aa();c()};this.securePost=function(aH,aI){var aJ=jQuery.extend({},aI);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aJ.sharedKey=d;aJ.guid=K;aJ.format="plain";return $.post(root+aH,aJ)};this.setDoubleEncryption=function(aK){var aJ=function(aM){console.log("Panic "+aM);window.location.reload()};try{if(D==aK){return}if(aK){var aH=$("#double-password").val();var aI=$("#double-password2").val();if(aH==null||aH.length==0||aH.length<4||aH.length>255){h.makeNotice("error","misc-error","Password must be 4 characters or more in length");return}if(aH!=aI){h.makeNotice("error","misc-error","Passwords do not match.");return}if(aH==aw){h.makeNotice("error","misc-error","Second password should not be the same as your main password.");return}h.getSecondPassword(function(){try{D=true;ac=aH;for(var aO in G){var aQ=G[aO];if(aQ.priv!=null){aQ.priv=i(B58.decode(aQ.priv))}}var aM=Crypto.SHA256(d+ac,{asBytes:true});for(var aN=1;aN<Q;++aN){aM=Crypto.SHA256(aM,{asBytes:true})}v=Crypto.util.bytesToHex(aM);ac=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){setDoubleEncryptionButton()},function(){aJ(aR)})}catch(aR){aJ(aR)}},function(){aJ()})}catch(aP){aJ(aP)}},function(){aJ()})}else{h.getSecondPassword(function(){try{for(var aM in G){var aO=G[aM];if(aO.priv!=null){aO.priv=h.decryptPK(aO.priv)}}D=false;ac=null;h.checkAllKeys();h.backupWallet("update",function(){setDoubleEncryptionButton()},function(){aJ(aN)})}catch(aN){aJ(aN)}},function(aM){aJ(aM)})}}catch(aL){aJ(aL)}};function J(){try{$(".pop").popover("hide")}catch(aH){}}$(window).resize(function(){$(".modal:visible").center();J()});this.setLoadingText=function(aH){$(".loading-text").text(aH)};function aD(aI,aH){aI.click(function(){y(aH.txIndex,aH.result)});aI.find(".show-note").mouseover(function(){var aJ=aH.note?aH.note:b[aH.hash];az(this,aJ,aH.hash)});aI.find(".add-note").mouseover(function(){m(this,aH.hash)});return aI}function s(aI,aO){var aH=0;for(var aK=0;aK<aI.inputs.length;++aK){var aJ=aI.inputs[aK].prev_out;if(!aJ||!aJ.addr){continue}var aN=G[aJ.addr];if(aN){var aM=parseInt(aJ.value);aH-=aM;if(aO){N+=aM;aN.balance-=aM}}}for(var aL=0;aL<aI.out.length;++aL){var aJ=aI.out[aL];if(!aJ||!aJ.addr){continue}var aN=G[aJ.addr];if(aN){var aM=parseInt(aJ.value);aH+=aM;if(aO){ah+=aM;aN.balance+=aM}}}return aH}function x(aH){aH.onmessage=function(aP){try{var aM=$.parseJSON(aP.data);if(aM.op=="status"){$("#status").html(aM.msg)}else{if(aM.op=="on_change"){var aQ=Crypto.util.bytesToHex(Crypto.SHA256(Z,{asBytes:true}));var aO=aM.checksum;console.log("On change old "+aQ+" ==  new "+aO);if(aQ!=aO){h.updateCacheManifest();setTimeout(H,250)}}else{if(aM.op=="utx"){var aN=TransactionFromJSON(aM.x);for(var aS in C){if(C[aS].txIndex==aN.txIndex){return}}var aU=s(aN,true);if(ai){var aL=function(aV){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(aV.iconUrl,aV.title,aV.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()==="granted"){new Notification(aV.title,aV).show()}}}}catch(aW){}};try{aL({title:aU>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(aU)+" BTC",iconUrl:resource+"cube48.png"})}catch(aP){console.log(aP)}}aN.result=aU;am+=aU;I++;aN.setConfirmations(0);playSound("beep");if(ag==0&&ak==0){C.unshift(aN);var aR=false;if(C.length>50){C.pop();aR=true}}var aJ=R();if("my-transactions"==aJ){if(ag==0&&ak==0){$("#no-transactions").hide();if($("#tx_display").val()==0){var aI=$("#transactions-compact").show();aD($(A(aN,G,g)),aN).prependTo(aI.find("tbody")).find("div").hide().slideDown("slow");if(aR){aI.find("tbody tr:last-child").remove()}}else{var aI=$("#transactions-detailed").show();aI.prepend(aN.getHTML(G,g));if(aR){aI.find("div:last-child").remove()}}}}else{c()}}else{if(aM.op=="block"){for(var aK=0;aK<aM.x.txIndexes.length;++aK){for(var aT=0;aT<C.length;++aT){if(C[aT].txIndex==aM.x.txIndexes[aK]){if(C[aT].blockHeight==null||C[aT].blockHeight==0){C[aT].blockHeight=aM.x.height;break}}}}al(BlockFromJSON(aM.x));T()}}}}}catch(aP){console.log(aP);console.log(aP.data)}};aH.onopen=function(){$("#status").html("CONNECTED.");var aL='{"op":"blocks_sub"}';if(K!=null){aL+='{"op":"wallet_sub","guid":"'+K+'"}'}try{var aJ=h.getActiveAddresses();for(var aI in aJ){aL+='{"op":"addr_sub", "addr":"'+aJ[aI]+'"}'}}catch(aK){alert(aK)}aH.send(aL)};aH.onclose=function(){$("#status").html("DISCONNECTED.")}}this.makeNotice=function(aI,aL,aK,aJ){if(aK==null||aK.length==0){return}console.log(aK);if(aJ==null){aJ=5000}var aH=$('<div class="alert alert-block alert-'+aI+'"></div>');aH.text(""+aK);if($("#"+aL).length>0){aH.attr("id",aL);return}$("#notices").append(aH).hide().fadeIn(200);if(aJ>0){(function(){var aM=aH;setTimeout(function(){aM.fadeOut(250,function(){$(this).remove()})},aJ)})()}};function at(aH){return aH}function aj(aH){return h.decryptPK(aH)}function W(aH){var aI=h.decodePK(aH);return Crypto.util.bytesToBase64(aI)}function k(aH){var aI=h.decodePK(aH);return Crypto.util.bytesToHex(aI)}this.base58ToSipa=function(aH,aM){var aI=h.decodePK(aH);var aJ=new Bitcoin.ECKey(aI);while(aI.length<32){aI.unshift(0)}aI.unshift(128);if(aJ.getBitcoinAddress().toString()==aM){}else{if(aJ.getBitcoinAddressCompressed().toString()==aM){aI.push(1)}else{throw"Private Key does not match bitcoin address"+aM}}var aK=Crypto.SHA256(Crypto.SHA256(aI,{asBytes:true}),{asBytes:true});aI=aI.concat(aK.slice(0,4));var aL=B58.encode(aI);return aL};this.makeWalletJSON=function(aH){return aC(aH,K,d)};function aC(aL,aI,aO){var aK=at;if(aL=="base64"){aK=W}else{if(aL=="hex"){aK=k}else{if(aL=="sipa"){aK=h.base58ToSipa}else{if(aL=="base58"){aK=aj}}}}var aH='{\n	"guid" : "'+aI+'",\n	"sharedKey" : "'+aO+'",\n';if(D&&v!=null&&aK==at){aH+='	"double_encryption" : '+D+',\n	"dpasswordhash" : "'+v+'",\n'}if(ax!=0){aH+='	"fee_policy" : '+ax+",\n"}if(ai){aH+='	"html5_notifications" : '+ai+",\n"}aH+='	"keys" : [\n';var aM=false;for(var aJ in G){var aN=G[aJ];aH+='	{"addr" : "'+aN.addr+'"';if(aN.priv!=null){aH+=',\n	 "priv" : "'+aK(aN.priv,aN.addr)+'"'}if(aN.tag==2){aH+=',\n	 "tag" : '+aN.tag}if(aN.label!=null){aH+=',\n	 "label" : "'+aN.label+'"'}aH+="},\n";aM=true}if(aM){aH=aH.substring(0,aH.length-2)}aH+="\n	]";if(ar(g)>0){aH+=',\n	"address_book" : [\n';for(var aJ in g){aH+='	{"addr" : "'+aJ+'",\n';aH+='	 "label" : "'+g[aJ]+'"},\n'}aH=aH.substring(0,aH.length-2);aH+="\n	]"}if(ar(b)>0){aH+=',\n	"tx_notes" : '+JSON.stringify(b)}aH+="\n}";return aH}this.get_history=function(aI,aH){BlockchainAPI.get_history(function(aJ){F(aJ,false);c();if(aI){aI()}},function(){if(aH){aH()}},ag,ak)};this.deleteAddressBook=function(aH){delete g[aH];aa();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aH){$("#send-coins").find(".tab-pane.active").trigger("show",aH);if(aH){BlockchainAPI.get_ticker();$(".send").attr("disabled",false)}}function l(aH,aI,aM){var aL=aH.val();aH.empty();for(var aK in G){var aN=G[aK];if(!aN||aN.tag==2){continue}var aJ=aN.label;if(!aJ){aJ=aN.addr.substring(0,15)+"..."}if(aI||aN.balance>0){aH.prepend('<option value="'+aN.addr+'">'+aJ+" - "+formatBTC(aN.balance)+" BTC</option>")}}aH.prepend('<option value="any" selected>Any Address</option>');if(!aM&&aL){aH.val(aL)}}function r(aJ,aK){l(aJ.find('select[name="from"]'),false,aK);l(aJ.find('select[name="change"]'),true,aK);aJ.find('select[name="change"]').prepend('<option value="new">New Address</option>');if(aK){aJ.find("input").val("");aJ.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aJ.find(".amount-needed").text(0)}var aI=aJ.find(".recipient-container");if(aK){var aM=aI.find(".recipient:first-child").clone();aI.empty().append(aM)}function aH(){var aN=0;aJ.find('input[name="send-value"]').each(function(){var aO=parseFloat($(this).val());if(!isNaN(aO)){aN+=aO}});return aN}function aL(aN){aN.find('input[name="send-to-address"]').val("").typeahead({source:ao()});aN.find(".local-symbol").text(symbol_local.symbol);aN.find('input[name="send-value"]').val("").bind("keyup change",function(aO){if(aO.keyCode=="9"){return}aJ.find(".amount-needed").text(formatBTC(Bitcoin.Util.parseValue(aH().toFixed(8)).toString()));aN.find(".send-value-usd").val(convert($(this).val()*100000000,symbol_local.conversion)).text(formatSymbol($(this).val()*100000000,symbol_local))});aN.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aO){if(aO.keyCode=="9"){return}aN.find(".send-value").val(formatBTC(parseFloat($(this).val())*symbol_local.conversion))})}aI.find(".recipient").each(function(){aL($(this))});aJ.find(".remove-recipient").unbind().click(function(){var aN=aI.find(".recipient").length;if(aN>1){if(aN==2){$(this).hide(200)}aI.find(".recipient:last-child").remove()}});aJ.find(".add-recipient").unbind().click(function(){var aN=aI.find(".recipient:first-child").clone();aN.appendTo(aI);aL(aN);aJ.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aI=[];for(var aH in G){aI.push(aH)}return aI};this.getPreferredAddress=function(){var aI=null;for(var aH in G){var aJ=G[aH];if(aI==null){aI=aJ}if(aJ.priv!=null){if(aI==null){aI=aJ}if(aJ.tag==null||aJ.tag==0){aI=aJ;break}}}return aI.addr};function S(aH){var aK=[];for(var aI in G){var aJ=G[aI];if(aJ.tag==aH){aK.push(aJ.addr)}}return aK}this.getActiveAddresses=function(){return S()};this.getArchivedAddresses=function(){return S(2)};function al(aK){if(aK!=null){au=aK;for(var aI in C){var aH=C[aI];if(aH.blockHeight!=null&&aH.blockHeight>0){var aJ=au.height-aH.blockHeight+1;if(aJ<=100){aH.setConfirmations(au.height-aH.blockHeight+1)}else{aH.setConfirmations(null)}}else{aH.setConfirmations(0)}}}}function y(aI,aH){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aI+"?result="+aH+"&guid="+K})})}this.deleteNote=function(aH){delete b[aH];c();aa()};function m(aH,aI){(function(aK,aM){aK=$(aK);if(!aK.data("popover")){aK.popover({title:"Add Note",trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aK.data("popover").tip().is(":visible")){return}}aK.popover("show");aK.mouseleave(function(){if(!aK.__timeout){aK.__timeout=setTimeout(function(){aK.popover("hide")},250)}});function aJ(){if(aK.__timeout){clearTimeout(aK.__timeout);aK.__timeout=null}}var aL=aK.data("popover").tip().mouseenter(aJ);aL.find("textarea").focus(aJ);aL.mouseleave(function(){aK.__timeout=setTimeout(function(){aK.popover("hide")},250)});aL.find("button").click(function(){var aN=$.trim($("<div>"+aL.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aN.length>0){b[aM]=aN;aa()}c()})})(aH,aI)}function az(aH,aI,aJ){(function(aK,aL,aN){aK=$(aK);if(!aK.data("popover")){var aO="Note";if(b[aN]){aO+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aK).popover({title:aO,trigger:"manual",content:aL})}else{if(aK.data("popover").tip().is(":visible")){return}}aK.popover("show");aK.mouseleave(function(){if(!aK.__timeout){aK.__timeout=setTimeout(function(){aK.popover("hide")},250)}});var aM=aK.data("popover").tip().mouseenter(function(){if(aK.__timeout){clearTimeout(aK.__timeout);aK.__timeout=null}});aM.find("img").unbind().click(function(){h.deleteNote(aN)});aM.mouseleave(function(){aK.__timeout=setTimeout(function(){aK.popover("hide")},250)})})(aH,aI,aJ)}function A(aK,aP,aM){var aQ=aK.result;var aL='<tr class="pointer" id="tx-'+aK.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aI=true;if(aQ>=0){for(var aJ=0;aJ<aK.inputs.length;++aJ){var aH=aK.inputs[aJ].prev_out;if(!aH||!aH.addr){aI=false;aL+='<span class="label">Newly Generated Coins</span>'}else{var aN=aP[aH.addr];if(aN){continue}aI=false;aL+=formatOutput(aH,aP,aM)}}}else{if(aQ<0){for(var aJ=0;aJ<aK.out.length;++aJ){var aH=aK.out[aJ];var aN=aP[aH.addr];if(aN&&aH.type==0){continue}aI=false;aL+=formatOutput(aH,aP,aM)}}}if(aI){aL+='<span class="label">Moved Between Wallet</info>'}aL+="</ul></div></td><td><div>";var aO=aK.note?aK.note:b[aK.hash];if(aO){aL+='<img src="'+resource+'note.png" class="pop show-note"> '}else{aL+='<img src="'+resource+'note_grey.png" class="pop add-note"> '}if(aK.time>0){aL+=dateToString(new Date(aK.time*1000))}if(aK.confirmations==0){aL+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aK.confirmations>0){aL+=' <span class="label label-info pull-right hidden-phone">'+aK.confirmations+" Confirmations</span> "}}aL+="</div></td>";if(aQ>0){aL+='<td style="color:green"><div>'+formatMoney(aQ,true)+"</div></td>"}else{if(aQ<0){aL+='<td style="color:red"><div>'+formatMoney(aQ,true)+"</div></td>"}else{aL+="<td><div>"+formatMoney(aQ,true)+"</div></td>"}}if(aK.balance==null){aL+="<td></td></tr>"}else{aL+='<td class="hidden-phone"><div>'+formatMoney(aK.balance)+"</div></td></tr>"}return aL}function R(){J();if(am==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(am,symbol));$("#balance2").html(formatSymbol(am,(symbol==symbol_local)?symbol_btc:symbol_local))}return j.attr("id")}function c(aH){var aI=R();if("send-coins"==aI){u(aH)}else{if("home-intro"==aI){f(aH)}else{if("receive-coins"==aI){aG(aH)}else{if("my-transactions"==aI){T(aH)}}}}}function f(aH){$("#summary-n-tx").html(I);$("#summary-received").html(formatMoney(ah,true));$("#summary-sent").html(formatMoney(N,true));$("#summary-balance").html(formatMoney(am,symbol));var aJ=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aJ+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});if(h.isWatchOnly(aJ)==null){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aI=$("#my-primary-address");if(aI.text()!=aJ){aI.text(aJ);$("#my-primary-addres-qr-code").html('<img style="padding-right:10px;padding-bottom:10px" src="'+root+"qr?data="+aJ+'&size=125">')}}}function O(){var aH=$("#export-warning").show();var aI=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aH.hide();loadScript("wallet/import-export.min.js",function(){ImportExport.init(aI,function(){aI.show()},function(){Y($("#home-intro"))})},function(aJ){h.makeNotice("error","misc-error",aJ);Y($("#home-intro"))})},function(){Y($("#home-intro"))})})}function T(){var aK=$("#tx_display").val();var aI=null;var aL=0;if(aI!=null){clearInterval(aI);aI=null}var aH;if(aK==0){$("#transactions-detailed").hide();aH=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aH=$("#transactions-detailed").empty().show()}if(C.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aJ=function(){for(var aP=aL;aP<C.length&&aP<(aL+10);++aP){var aO=C[aP];if(aK==0){aH.append(aD($(A(aO,G,g)),aO))}else{aH.append(aO.getHTML(G,g))}}aL+=10;if(aL<C.length){aI=setTimeout(aJ,15)}else{var aN=$(".pagination ul").empty();if(ak==0&&C.length<50){aN.hide();return}else{aN.show()}var aM=Math.ceil(aF/50);var aQ=" disabled";if(ak>0){aQ=""}aN.append($('<li class="prev'+aQ+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(ak-1)}));for(var aP=0;aP<aM&&aP<=10;++aP){(function(aR){var aS="";if(ak==aR){aS=' class="active"'}aN.append($("<li"+aS+'><a class="hidden-phone">'+aR+"</a></li>").click(function(){h.setPage(aR)}))})(aP)}var aQ=" disabled";if(ak<aM){aQ=""}aN.append($('<li class="next'+aQ+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(ak+1)}))}};aJ()}this.setPage=function(aH){ak=aH;scroll(0,0);h.get_history()};function F(aJ,aK){var aM=$.parseJSON(aJ);if(!aK&&aM.mixer_fee){w=aM.mixer_fee}C.length=0;if(aM.wallet==null){ah=0;N=0;am=0;I=0;aF=0;return}ah=aM.wallet.total_received;N=aM.wallet.total_sent;am=aM.wallet.final_balance;I=aM.wallet.n_tx;aF=aM.wallet.n_tx_filtered;for(var aI=0;aI<aM.addresses.length;++aI){if(G[aM.addresses[aI].address]){G[aM.addresses[aI].address].balance=aM.addresses[aI].final_balance}}for(var aI=0;aI<aM.txs.length;++aI){var aH=TransactionFromJSON(aM.txs[aI]);aH.result=s(aH,false);C.push(aH)}if(aM.info){$("#nodes-connected").html(aM.info.nconnected);if(aM.info.latest_block!=null){al(aM.info.latest_block)}var aL=aM.info.symbol_local;if(symbol==symbol_local){symbol_local=aL;symbol=aL;calcMoney()}else{if(!aK){symbol_local=aL}}}}function aA(){P=setTimeout(h.logout,t);for(var aJ in U){U[aJ]("did_decrypt")}window.location.hash="";try{var aH=localStorage.getItem("guid");if(aH!=K){localStorage.clear();if(K!=B){localStorage.setItem("guid",K)}}else{var aI=localStorage.getItem("multiaddr");if(aI!=null){F(aI,true);c()}}}catch(aK){}h.get_history();Y($("#home-intro"));$("#initial_error,#initial_success").remove()}function H(){for(var aH in G){var aI=G[aH];if(aI.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have uns-saved keys");return}}console.log("Get wallet with checksum "+an);$.get(root+"wallet/wallet.aes.json?guid="+K+"&sharedKey="+d+"&checksum="+an+"&format=plain").success(function(aJ){if(aJ==null||aJ.length==0){return}if(aJ=="Not modified"){console.log("Not modified");return}else{console.log("Wallet data modified");Z=aJ;an=Crypto.util.bytesToHex(Crypto.SHA256(Z,{asBytes:true}));V();h.get_history();c()}})}function V(){try{if(Z==null||Z.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aK=null;h.decrypt(Z,aw,function(aL){try{aK=$.parseJSON(aL);return(aK!=null)}catch(aM){return false}});if(aK==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aK.double_encryption&&aK.dpasswordhash){D=aK.double_encryption;v=aK.dpasswordhash}if(aK.fee_policy){ax=aK.fee_policy}if(aK.html5_notifications){ai=aK.html5_notifications}G.length=0;for(var aI=0;aI<aK.keys.length;++aI){var aH=aK.keys[aI];if(aH.addr==null||aH.addr.length==0||aH.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}G[aH.addr]=aH}g={};if(aK.address_book!=null){for(var aI=0;aI<aK.address_book.length;++aI){h.addAddressBookEntry(aK.address_book[aI].addr,aK.address_book[aI].label)}}if(aK.tx_notes){b=aK.tx_notes}d=aK.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(an==null||an.length==0){an=Crypto.util.bytesToHex(Crypto.SHA256(Z,{asBytes:true}))}else{H()}e();return true}catch(aJ){h.makeNotice("error","misc-error",aJ)}return false}this.getPassword=function(aM,aN,aK){aM.modal({keyboard:true,backdrop:"static",show:true});aM.center();var aJ=aM.find('input[name="password"]');var aI=aJ,aH=false,aL=false;aM.find(".vkeyboard li").click(function(){var aQ=$(this),aP=aQ.html();if(aQ.hasClass("left-shift")||aQ.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aH=(aH===true)?false:true;aL=false;return false}if(aQ.hasClass("capslock")){$(".letter").toggleClass("uppercase");aL=true;return false}if(aQ.hasClass("delete")){var aO=aI.val();aI.val(aO.substr(0,aO.length-1));return false}if(aQ.hasClass("symbol")){aP=$("span:visible",aQ).html()}if(aQ.hasClass("space")){aP=" "}if(aQ.hasClass("tab")){aP="\t"}if(aQ.hasClass("return")){aP="\n"}if(aQ.hasClass("uppercase")){aP=aP.toUpperCase()}if(aH===true){$(".symbol span").toggle();if(aL===false){$(".letter").toggleClass("uppercase")}aH=false}aI.val(aI.val()+aP)});aJ.unbind().keypress(function(aO){if(aO.keyCode==13){aO.preventDefault();aM.find(".btn.btn-primary").click()}});aJ.val("");aM.find(".btn.btn-primary").unbind().click(function(){if(aN){aK=null;var aO=aN;aN=null;aM.modal("hide");setTimeout(function(){aO(aJ.val())},100)}});aM.find(".btn.btn-secondary").unbind().click(function(){if(aK){var aO=aK;aK=null;setTimeout(function(){try{aO()}catch(aP){h.makeNotice("error","misc-error",aP)}},100)}aM.modal("hide")});aM.unbind().on("hidden",function(){if(aK){var aO=aK;aK=null;setTimeout(function(){try{aO()}catch(aP){h.makeNotice("error","misc-error",aP)}},100)}})};this.makePairingQRCode=function(aH){h.getMainPassword(function(){loadScript("wallet/qr.code.creator.js",function(){try{var aI=makeQRCode(300,300,1,K+"|"+d+"|"+aw);aH(aI)}catch(aJ){h.makeNotice("error","misc-error",aJ)}})},function(){h.logout()})};this.getMainPassword=function(aI,aH){if(z>new Date().getTime()-L){return aI(aw)}h.getPassword($("#main-password-modal"),function(aJ){if(aw==aJ){z=new Date().getTime();if(aI){try{aI(aw)}catch(aK){h.makeNotice("error","misc-error",aK)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aH){try{aH()}catch(aK){h.makeNotice("error","misc-error",aK)}}}},aH)};this.getSecondPassword=function(aJ,aH){if(!D||ac!=null){if(aJ){try{aJ(ac)}catch(aI){h.makeNotice("error","misc-error",aI)}}return}h.getPassword($("#second-password-modal"),function(aK){if(ay(aK)){if(aJ){try{aJ(aK)}catch(aL){h.makeNotice("error","misc-error",aL)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aH){try{aH()}catch(aL){h.makeNotice("error","misc-error",aL)}}}},aH)};function a(){var aH=$("#restore-password");aw=$.trim(aH.val());aH.val("");z=new Date().getTime();if(Z==null||Z.length==0){h.setLoadingText("Validating Authentication key");var aI=$.trim($(".restore-auth-"+q).find(".code").val());if(aI.length==0||aI.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.post(root+"wallet",{guid:K,payload:aI,length:aI.length,method:"get-wallet",format:"plain"},function(aJ){try{if(aJ==null||aJ.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}Z=aJ;$(".restore-auth-"+q).hide();$(".restore-auth-0").show();if(V()){n();aA()}}catch(aK){h.makeNotice("error","misc-error",aK)}}).error(function(aJ){h.makeNotice("error","misc-error",aJ.responseText)})}else{if(V()){n();aA()}}return true}function e(){webSocketConnect(x);$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show();$("#status-container").show()}this.quickSendNoUI=function(aJ,aI,aH){loadScript("wallet/signer.min.js",function(){h.getSecondPassword(function(){try{var aL=initNewTx();aL.from_addresses=h.getActiveAddresses();aL.to_addresses.push({address:new Bitcoin.Address(aJ),value:Bitcoin.Util.parseValue(aI)});aL.addListener(aH);aL.start()}catch(aK){aH.on_error(aK)}},function(aK){aH.on_error(aK)})})};function E(){h.setLoadingText("Sending email backup");$.post(root+"wallet",{guid:K,sharedKey:d,method:"email-backup",format:"plain"},function(aH){h.makeNotice("success","backup-success",aH)}).error(function(aH){h.makeNotice("error","misc-error",aH.responseText)})}this.updateCacheManifest=function(aH){try{var aI=window.applicationCache;console.log("Clear Cache Manifest");aI.addEventListener("updateready",function(aK){aI.swapCache();if(aH){aH()}},false);aI.addEventListener("noupdate",function(aK){if(aH){aH()}},false);aI.addEventListener("error",function(aK){if(aH){aH()}},false);aI.update()}catch(aJ){console.log(aJ);if(aH){aH()}}};function aa(aK,aJ,aI,aH){if(ae!=null){clearInterval(ae);ae=null}ae=setTimeout(function(){h.backupWallet(aK,aJ,aI,aH)},3000)}this.insertWallet=function(aO,aQ,aR,aH,aJ,aP){try{var aK=aC(null,aO,aQ);var aN=h.encrypt(aK,aR);if(aN.length==0){throw"Error encrypting the JSON output"}var aI=null;h.decrypt(aN,aR,function(aS){try{aI=$.parseJSON(aS);return(aI!=null)}catch(aT){return false}});if(aI==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aL=Crypto.util.bytesToHex(Crypto.SHA256(aN,{asBytes:true}));h.setLoadingText("Saving wallet");if(aH==null){aH=""}Z=aN;$.ajax({type:"POST",url:root+"wallet"+aH,data:{guid:aO,length:aN.length,payload:aN,sharedKey:aQ,checksum:aL,method:"insert"},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aT){var aV=false;for(var aS in G){var aU=G[aS];if(aU.tag==1){aU.tag=null;aV=true}}an=aL;h.makeNotice("success","misc-success",aT);c();if(aJ!=null){aJ()}h.updateCacheManifest()},error:function(aS){h.makeNotice("error","misc-error",aS.responseText,10000);c();if(aP!=null){aP()}}})}catch(aM){h.makeNotice("error","misc-error","Error Saving Wallet: "+aM,10000);c();if(aP!=null){aP(aM)}else{throw aM}}};this.backupWallet=function(aO,aN,aH){try{if(aO==null){aO="update"}if(ar(G)==0){return}var aJ=h.makeWalletJSON();var aM=h.encrypt(aJ,aw);if(aM.length==0){throw"Error encrypting the JSON output"}var aL=null;h.decrypt(aM,aw,function(aP){try{aL=$.parseJSON(aP);return(aL!=null)}catch(aQ){return false}});if(aL==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aI=Crypto.util.bytesToHex(Crypto.SHA256(aM,{asBytes:true}));h.setLoadingText("Saving wallet");Z=aM;$.ajax({type:"POST",url:root+"wallet",data:{guid:K,length:aM.length,payload:aM,sharedKey:d,checksum:aI,old_checksum:an,method:aO},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aQ){var aS=false;for(var aP in G){var aR=G[aP];if(aR.tag==1){aR.tag=null;aS=true}}an=aI;h.makeNotice("success","misc-success",aQ);c();if(aN!=null){aN()}h.updateCacheManifest()},error:function(aP){h.makeNotice("error","misc-error",aP.responseText,10000);c();if(errorcallback!=null){errorcallback()}}})}catch(aK){h.makeNotice("error","misc-error","Error Saving Wallet: "+aK,10000);c();if(errorcallback!=null){errorcallback(aK)}else{throw aK}}};function aB(aH){if(D){if(ac==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aH,d+ac)}else{return aH}return null}this.isBase58=function(aJ,aI){for(var aH=0;aH<aJ.length;++aH){if(aJ[aH]<0||aJ[aH]>58){return false}}return true};this.encrypt=function(aI,aH){return Crypto.AES.encrypt(aI,aH,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:Q})};this.decrypt=function(aK,aJ,aM,aI){try{var aH=Crypto.AES.decrypt(aK,aJ,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:Q});if(aH!=null&&aH.length>0){if(aM(aH)){return aH}}}catch(aL){console.log(aL)}try{var aH=Crypto.AES.decrypt(aK,aJ,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aH!=null&&aH.length>0){if(aM(aH)){return aH}}}catch(aL){console.log(aL)}try{var aH=Crypto.AES.decrypt(aK,aJ,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aH!=null&&aH.length>0){if(aM(aH)){return aH}}}catch(aL){console.log(aL)}if(aI!=null){aI()}return null};this.setGUID=function(aI,aH){h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();$.get(root+"wallet/"+aI,{format:"json",resend_code:aH}).success(function(aK){$(".restore-auth-"+q).hide();K=aK.guid;q=aK.auth_type;an=aK.payload_checksum;Z=aK.payload;war_checksum=aK.war_checksum;symbol_local=aK.symbol_local;$("#restore-guid").val(K);$(".restore-auth-"+q).show();if(aK.initial_error){h.makeNotice("error","misc-error",aK.initial_error)}if(aK.initial_success){h.makeNotice("success","misc-success",aK.initial_success)}try{localStorage.clear();if(K!=B){localStorage.setItem("guid",K)}}catch(aJ){}}).error(function(aK){console.log(aK);try{var aJ=$.parseJSON(aK.responseText);if(aJ.initial_error){h.makeNotice("error","misc-error",aJ.initial_error);return}}catch(aK){}h.makeNotice("error","misc-error","Error changing wallet identifier")})};function i(aH){var aI=B58.encode(aH);return aB(aI)}this.decryptPK=function(aH){if(D){if(ac==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aH,d+ac,h.isBase58)}else{return aH}return null};this.decodePK=function(aI){var aH=h.decryptPK(aI);if(aH!=null){return B58.decode(aH)}return null};this.signmessage=function(aH,aJ){var aL=G[aH];var aK=h.decodePK(aL.priv);var aI=new Bitcoin.ECKey(aK);return Bitcoin.Message.signMessage(aI,aJ,aL.addr)};function ay(aI){var aH=Crypto.SHA256(d+aI,{asBytes:true});var aK=aH;for(var aJ=1;aJ<Q;++aJ){aK=Crypto.SHA256(aK,{asBytes:true})}var aM=Crypto.util.bytesToHex(aK);if(aM==v){ac=aI;return true}if(Crypto.util.bytesToHex(aH)==v){ac=aI;v=aM;return true}var aL=Crypto.SHA256(aI);if(aL==v){ac=aI;v=aM;return true}return false}this.checkAllKeys=function(aH){for(var aI in G){var aM=G[aI];if(aM.addr==null){throw"Null Address Found in wallet "+aI}if(aM.addr.toString()==null){throw"Error decoding wallet address "+aM.addr}if(aM.priv!=null){var aL=h.decodePK(aM.priv);var aK=new Bitcoin.ECKey(aL);var aJ=aK.getBitcoinAddress().toString();if(aJ!=aM.addr&&aK.getBitcoinAddressCompressed().toString()!=aM.addr){throw"Private key does not match bitcoin address "+aM.addr+" != "+aJ}if(aH){aM.priv=i(aL)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aH){h.getMainPassword(function(){aw=aH;h.backupWallet("update",function(){h.updateCacheManifest(function(){h.logout()})},function(){h.logout()})})};function Y(aH){if(aH===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aH;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function ar(aJ){var aI=0,aH;for(aH in aJ){aI++}return aI}function X(aH){G[aH].priv=null}function ab(){if(ar(G)>=ap){h.makeNotice("error","misc-error","We currently support a maximum of "+ap+" private keys, please remove some unused ones.");return true}return false}function aE(aJ,aH){var aI=G[aJ];if(!aI||aI.length==0){G[aJ]={addr:aJ,priv:aH,balance:0};return true}else{if(!aI.priv&&aH){aI.priv=aH;return true}}return false}function o(){var aJ=$("#add-address-book-entry-modal");aJ.modal({keyboard:true,backdrop:"static",show:true});var aH=aJ.find('input[name="label"]');var aI=aJ.find('input[name="address"]');aH.val("");aI.val("");aJ.find(".btn.btn-primary").unbind().click(function(){aJ.modal("hide");var aL=$.trim($("<div>"+aH.val()+"</div>").text());var aK=$.trim(aI.val());if(aL.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aL.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aK.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aN;try{aN=new Bitcoin.Address(aK);if(aN==null){throw"Null address"}}catch(aM){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aK]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aK,aL);aa();$("#send-coins").find(".tab-pane").trigger("show",true)});aJ.find(".btn.btn-secondary").unbind().click(function(){aJ.modal("hide")})}this.logout=function(){$.get(root+"wallet/logout?format=plain").success(function(){window.location.reload()}).error(function(){window.location.reload()})};function af(aN){var aP=$("#delete-address-modal");aP.modal({keyboard:true,backdrop:"static",show:true});aP.find(".btn.btn-primary").hide();aP.find(".btn.btn-danger").hide();$("#change-mind").hide();aP.find("#to-delete-address").html(aN.join(" "));aP.find("#delete-balance").empty();var aJ=aP.find("#delete-balance");var aH=[];for(var aM in aN){var aO=aN[aM];if(G[aO]&&G[aO].priv){aH.push(aN[aM])}}BlockchainAPI.get_balance(aH,function(aQ){aP.find(".btn.btn-primary").show(200);aP.find(".btn.btn-danger").show(200);aJ.html("Balance "+formatBTC(aQ)+" BTC");if(aQ>0){aJ.css("color","red")}else{aJ.css("color","black")}},function(){aP.find(".btn.btn-primary").show(200);aP.find(".btn.btn-danger").show(200);aJ.text("Error Fetching Balance")});var aK=false;var aM=0;var aI=null;var aL=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aL-aM)};aP.find(".btn.btn-primary").unbind().click(function(){changeMind();aP.find(".btn.btn-primary").hide();aP.find(".btn.btn-danger").hide();aI=setInterval(function(){if(aK){return}++aM;changeMind();if(aM==aL){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aQ in aN){X(aN[aQ])}c();h.backupWallet();clearInterval(aI)}},1000)});aP.find(".btn.btn-danger").unbind().click(function(){changeMind();aP.find(".btn.btn-primary").hide();aP.find(".btn.btn-danger").hide();aI=setInterval(function(){if(aK){return}++aM;changeMind();if(aM==aL){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aQ in aN){h.deleteAddress(aN[aQ])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aI)}}},1000)});aP.unbind().on("hidden",function(){if(aI){aK=true;clearInterval(aI);aI=null}});aP.find(".btn.btn-secondary").unbind().click(function(){aP.modal("hide")})}function ao(){var aJ=[];for(var aH in g){aJ.push(g[aH])}for(var aH in G){var aI=G[aH];if(aI.tag!=2&&aI.label){aJ.push(aI.label)}}return aJ}function M(aH){h.getSecondPassword(function(){var aJ=$("#sweep-address-modal");aJ.modal("show");BlockchainAPI.get_balance(aH,function(aK){aJ.find(".balance").text("Amount: "+formatBTC(aK)+" BTC")},function(){aJ.find(".balance").text("Error Fetching Balance")});var aI=aJ.find('select[name="change"]');l(aI,true);aJ.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer.min.js",function(){BlockchainAPI.get_balance(aH,function(aK){var aL=initNewTx();aL.fee=aL.base_fee;aL.to_addresses.push({address:new Bitcoin.Address($.trim(aI.val())),value:BigInteger.valueOf(aK).subtract(aL.fee)});aL.from_addresses=aH;aL.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aJ.modal("hide")});aJ.find(".btn.btn-secondary").unbind().click(function(){aJ.modal("hide")})})}function aq(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aH){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){Y($("#home-intro"))});$("#my-transactions-btn").click(function(){Y($("#my-transactions"))});$("#send-coins-btn").click(function(){Y($("#send-coins"))});$("#import-export-btn").click(function(){Y($("#import-export"));O()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal.min.js",function(){verifyMessageModal()})});$("#group-received").click(function(){loadScript("wallet/taint_grouping.min.js",function(){try{loadTaintData()}catch(aJ){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){Y($("#my-account"));var aJ=$("#account-settings-warning").show();var aK=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aJ.hide();loadScript("wallet/account.min.js",function(){AccountSettings.init(aK,function(){aK.show()},function(){Y($("#home-intro"))})},function(aL){h.makeNotice("error","misc-error",aL);Y($("#home-intro"))})},function(){Y($("#home-intro"))})})});$(".download-backup-btn").click(function(){window.open(root+"wallet/wallet.aes.json?guid="+K+"&sharedKey="+d)});$("#enable_archived_checkbox").change(function(){var aJ=$(this).is(":checked");$(".archived_checkbox").attr("checked",false);$(".archived_checkbox").attr("disabled",!aJ);$("#archived-sweep").attr("disabled",!aJ);$("#archived-delete").attr("disabled",!aJ)});$("#anonymous-addresses").on("show",function(){var aJ=$(this);loadScript("wallet/anonymous-addresses.min.js",function(){buildAnonymousTable(aJ)})});$("#active-addresses").on("show",function(){var aP=$(this).find("table:first");aP.find("tbody:gt(0)").remove();var aM=aP.find("tbody").empty();for(var aO in G){var aQ=G[aO];if(aQ.tag==2){continue}var aN="";if(aQ.tag==1){aN=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aQ.priv==null){aN=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aJ="";var aL=aQ.addr;if(aQ.label!=null){aL=aQ.label;aJ='<span class="hidden-phone"> - '+aQ.addr+"</span>"}var aK=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aQ.addr+'" target="new">'+aL+"</a>"+aJ+" "+aN+'<div></td><td><span style="color:green">'+formatMoney(aQ.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            </ul></div></td></tr>');(function(aR){aK.find(".act-archive").click(function(){h.archiveAddr(aR)});aK.find(".act-label").click(function(){loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aR)})});aK.find(".act-qr").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalQRCode(aR)})});aK.find(".act-sign").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalSignMessage(aR)})});aK.find(".act-request").click(function(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aR+"</b>",src:root+"payment_request?address="+aR})})})})(aQ.addr);if(aQ.balance>0&&aQ.priv){aP.prepend(aK)}else{aP.append(aK)}}aq()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").attr("checked",false);$("#archived-delete").attr("disabled",true);$("#archived-sweep").attr("disabled",true);$("#archived-addr tbody").empty();var aK=$(this).find("tbody");var aJ=h.getArchivedAddresses();var aL=function(){aK.empty();for(var aP in aJ){var aR=G[aJ[aP]];if(aR.tag!=2){continue}var aO="";if(aR.priv==null){aO=' <font color="red">(Watch Only)</font>'}var aM="";var aN=aR.addr;if(aR.label!=null){aN=aR.label;aM='<span class="hidden-phone"> - '+aR.addr+"</span>"}var aQ=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aR.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aR.addr+'" target="new">'+aN+"</a>"+aM+" "+aO+'<div></td><td><span style="color:green">'+formatBTC(aR.balance)+'<span class="hidden-phone"> BTC</span></span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aS){aQ.find(".act-unarchive").click(function(){h.unArchiveAddr(aS)})})(aR.addr);if(aR.balance>0&&aR.priv){aK.prepend(aQ)}else{aK.append(aQ)}}};aL();BlockchainAPI.get_balances(aJ,function(aM){aL()},function(aM){h.makeNotice("error","misc-error",aM)})});$("#archived-sweep").click(function(){var aJ=[];$(".archived_checkbox:checked").each(function(){var aK=G[$(this).val()];if(aK.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aJ.push(aK.addr)});if(aJ.length==0){return}M(aJ)});$("#archived-delete").click(function(){var aJ=[];$(".archived_checkbox:checked").each(function(){aJ.push($(this).val())});if(aJ.length==0){return}af(aJ)});$("#anonymous-never-ask").click(function(){SetCookie("anonymous-never-ask",$(this).is(":checked"))});$("#export-history").click(function(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})});$(".deposit-btn").click(function(){var aK=$(this);var aJ=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aK.data("title"),description:"Deposit into address <b>"+aJ+"</b>",top_right:'Have Questions? Read <a href="'+aK.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aJ+"&ptype="+aK.data("type")+"&guid="+K+"&sharedKey="+d})})});$(".withdraw-btn").click(function(){var aJ=$(this);h.getSecondPassword(function(){var aK=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aJ.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(am)+" BTC</b>",src:root+"withdraw?method="+aJ.data("type")+"&address="+aK+"&balance="+am+"&guid="+K+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){H();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aK=h.generateNewKey().getBitcoinAddress().toString();h.makeNotice("info","new-address","Generated new Bitcoin Address "+aK);loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aK)});h.backupWallet()})}catch(aJ){h.makeNotice("error","misc-error",aJ)}});$("#filter").change(function(){ak=0;ag=$(this).val();h.get_history()});var aI=$("#tx_display");aI.change(function(){SetCookie("tx_display",$(this).val());c()});var aH=getCookie("tx_display");if(aH!=null){aI.val(parseInt(aH))}$("#email-backup-btn").click(function(){E()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+K+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+K+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aL,aK){var aJ=$(this);r(aJ,aK);aJ.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aJ,"quick",initNewTx())})})});$("#send-email").on("show",function(aL,aK){var aJ=$(this);r(aJ,aK);aJ.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aJ,"email",initNewTx())})})});$("#send-anonymous").on("show",function(aL,aK){var aJ=$(this);r(aJ,aK);aJ.find(".mixer_fee").text(w);aJ.find(".fees,.free,.bonus").show();if(w<0){aJ.find(".fees,.free").hide()}else{if(w==0){aJ.find(".fees,.bonus").hide()}else{aJ.find(".free,.bonus").hide()}}aJ.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aJ,"anonymous",initNewTx())})});aJ.find(".anonymous-fees").text("0.00");aJ.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aN=parseFloat($.trim($(this).val()));var aM=0;if(aN>0){if(w>0){aM=parseFloat(aN+((aN/100)*w))}else{aM=parseFloat(aN);aJ.find(".bonus-value").text(-(Math.min($(this).val(),200)/100)*w)}}if(aN<0.5){aJ.find(".anonymous-fees").text("0.00")}else{aJ.find(".anonymous-fees").text(aM.toFixed(4))}aJ.find('input[name="send-value"]').val(aM).trigger("keyup")})});$("#send-custom").on("show",function(aL,aK){var aJ=$(this);r(aJ,aK);aJ.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aJ,"custom",initNewTx())})});aJ.find('select[name="from"]').unbind().change(function(){var aO=0;var aM=$(this).val();for(var aN in aM){if(aM[aN]=="any"){$(this).val("any");aO=am;break}else{var aP=G[aM[aN]];if(aP&&aP.balance){aO+=aP.balance}}}aJ.find(".amount-available").text(formatBTC(aO))}).trigger("change");aJ.find(".reset").unbind().click(function(){r(aJ,true);aJ.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aL,aK){var aJ=this;loadScript("wallet/dicegames.min.js",function(){try{DICEGame.init($(aJ))}catch(aM){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aM){h.makeNotice("error","misc-error",aM)})});$("#send-sms").on("show",function(aL,aK){if(aK){return}var aJ=$(this);r(aJ);$.get(resource+"wallet/country_codes.html").success(function(aM){aJ.find('select[name="sms-country-code"]').html(aM)}).error(function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")});aJ.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){var aM=initNewTx();startTxUI(aJ,"sms",aM)})})});$("#address-book").on("show",function(){var aK=$("#address-book-tbl tbody");if(ar(g)>0){aK.empty();for(var aJ in g){var aL=$("<tr><td>"+g[aJ]+'</td><td><div class="addr-book-entry">'+aJ+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aM){aL.find(".act-delete").click(function(){h.deleteAddressBook(aM)})})(aJ);aK.append(aL)}}});$('a[data-toggle="tab"]').on("show",function(aJ){$(aJ.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){Y($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()})}function p(){$(".resend-code").click(function(){h.setGUID(K,true)});aq();$("#restore-password").keypress(function(aH){if(aH.keyCode==13){aH.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aI){aI.preventDefault();var aH=$.trim($("#restore-guid").val());if(aH.length==0){return}if(K!=aH){h.setGUID(aH,false)}else{a()}});$(".modal").on("show",function(){J();$(this).center()}).on("shown",function(){J();$(this).center()})}function ad(aI){var aJ=Crypto.SHA256(aI+"?");switch(aJ.slice(0,2)){case"00":var aK=Crypto.SHA256(aI,{asBytes:true});return aK;break;case"01":var aH=Crypto.util.hexToBytes(aJ.slice(2,4))[0];var aL=Math.round(Math.pow(2,(aH/4)));var aK=Crypto.PBKDF2(aI,"Satoshi Nakamoto",32,{iterations:aL,asBytes:true});return aK;break;default:console.log("invalid key");break}}function av(){var aJ,aH="";if(window.getSelection){aJ=window.getSelection();if(aJ.rangeCount){var aK=aJ.getRangeAt(0).cloneContents();var aI=document.createElement("div");aI.appendChild(aK);aH=aI.innerText}}else{if(document.selection&&document.selection.type=="Text"){aH=document.selection.createRange().htmlText}}return aH}this.detectPrivateKeyFormat=function(aI){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aI)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aI)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aI)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aI)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aI)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aI)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aI)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aI)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aI)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aI)){var aH=Crypto.SHA256(aI+"?",{asBytes:true});if(aH[0]===0||aH[0]===1){return"mini"}}throw"Unknown Key Format "+aI};this.privateKeyStringToKey=function(aI,aK){var aH=null;if(aK=="base58"){aH=B58.decode(aI)}else{if(aK=="base64"){aH=Crypto.util.base64ToBytes(aI)}else{if(aK=="hex"){aH=Crypto.util.hexToBytes(aI)}else{if(aK=="mini"){aH=ad(aI)}else{if(aK=="sipa"){var aJ=B58.decode(aI);aJ.shift();aH=aJ.slice(0,aJ.length-4)}else{if(aK=="sipa"){var aJ=B58.decode(aI);aJ.shift();aH=aJ.slice(0,aJ.length-4)}else{if(aK=="compsipa"){var aJ=B58.decode(aI);aJ.shift();aJ.pop();aH=aJ.slice(0,aJ.length-4)}else{throw"Unsupported Key Format"}}}}}}}if(aH.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aH)};$(document).ready(function(){var aI=$(document.body);Z=aI.data("payload");K=aI.data("guid");d=aI.data("sharedkey");an=aI.data("payload-checksum");q=aI.data("auth-type");if(h.skip_init){return}if(top.location!=self.location){top.location=self.location.href}if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}$("input,button,select").attr("autocomplete","off");aI.ajaxStart(function(){$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){$(".loading-indicator").hide()}).click(function(){if(P){clearTimeout(P);P=setTimeout(h.logout,t)}rng_seed_time()}).keypress(function(){if(P){clearTimeout(P);P=setTimeout(h.logout,t)}rng_seed_time()});p();$(".restore-auth-"+q).show();j=$("#restore-wallet");j.show();var aJ=false;var aM=17,aL=86,aH=67,aK=67;$(document).keydown(function(aO){try{if(aO.keyCode==aM||aO.keyCode==aK){aJ=true}if(aJ&&aO.keyCode==aH){var aN=$.trim(av());var aP=G[aN];if(aP!=null){if(aP.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aP.tag==1){$("#not-synced-warning-modal").modal("show")}}}}}catch(aO){console.log(aO)}}).keyup(function(aN){if(aN.keyCode==aM||aN.keyCode==aK){aJ=false}})});this.unArchiveAddr=function(aH){var aH=G[aH];if(aH.tag==2){aH.tag=null;c();aa("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aH){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aH=G[aH];if(aH.tag==null||aH.tag==0){aH.tag=2;c();aa("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};function aG(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}this.addWatchOnlyAddress=function(aH){return aE(aH)};this.addPrivateKey=function(aI,aH){if(ab()){return false}if(aI==null){throw"Unable to generate a new bitcoin address."}if(aH){var aK=aI.getBitcoinAddressCompressed()}else{var aK=aI.getBitcoinAddress()}if(aK==null){throw"Generated invalid bitcoin address."}if(aE(aK.toString(),i(aI.priv))){G[aK].tag=1;try{ws.send('{"op":"addr_sub", "addr":"'+aK+'"}')}catch(aJ){}}else{throw"Unable to add generated bitcoin address."}return aK};this.generateNewKey=function(){var aH=new Bitcoin.ECKey(false);if(h.addPrivateKey(aH)){return aH}}};