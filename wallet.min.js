var MyWallet=new function(){var h=this;this.skip_init=false;var D="abcaa314-6f67-6705-b384-5d47fbe9d7cc";var ac;var M;var j;var az;var af;var w;var d;var ap=0;var P=0;var ak=0;var K=0;var aJ=0;var ax;var g={};var E=[];var F=false;var an=0;var aj=0;var at=1000;var I={};var aq;var ah;var x=1.5;var S=10;var b={};var aD=0;var q;var R;var W=[];var B;var N=60000;var A=false;var s={fee_policy:0,html5_notifications:false,logout_time:600000,tx_display:0,always_keep_local_backup:false};this.setEncryptedWalletData=function(aL){if(!aL||aL.length==0){return}ac=aL;aq=ab();try{if(aD==0||s.always_keep_local_backup){localStorage.setItem("payload",ac)}}catch(aM){console.log(aM)}};this.setRealAuthType=function(aL){this.real_auth_type=aL};this.addEventListener=function(aL){W.push(aL)};this.getLogoutTime=function(){return s.logout_time};this.setLogoutTime=function(aL){s.logout_time=aL;clearInterval(R);R=setTimeout(h.logout,h.getLogoutTime())};this.getDoubleEncryption=function(){return F};this.getEncryptedWalletData=function(){return ac};this.getFeePolicy=function(){return s.fee_policy};this.setFeePolicy=function(aL){s.fee_policy=aL};this.setAlwaysKeepLocalBackup=function(aL){s.always_keep_local_backup=aL};this.getAlwaysKeepLocalBackup=function(){return s.always_keep_local_backup};this.getGuid=function(){return M};this.getHTML5Notifications=function(){return s.html5_notifications};this.setHTML5Notifications=function(aL){s.html5_notifications=aL};this.getTransactions=function(){return E};this.addressExists=function(aL){return I[aL]!=null};this.getAddressTag=function(aL){return I[aL].tag};this.setAddressTag=function(aM,aL){I[aM].tag=aL};this.getAddressBook=function(){return g};this.getAddressLabel=function(aL){return I[aL].label};this.setAddressLabel=function(aL,aM){I[aL].label=aM};this.setAddressBalance=function(aL,aM){I[aL].balance=aM};this.getAddressBookLabel=function(aL){return g[aL]};this.isWatchOnly=function(aL){return I[aL].priv==null};this.getAddressBalance=function(aL){return I[aL].balance};this.getMixerFee=function(){return x};this.deleteAddress=function(aL){delete I[aL]};this.addAddressBookEntry=function(aM,aL){g[aM]=aL};this.getPrivateKey=function(aL){return I[aL].priv};this.setLabel=function(aL,aM){I[aL].label=aM;ad();c()};this.securePost=function(aM,aN,aO,aL){var aP=jQuery.extend({},aN);if(d==null||d.length==0||d.length!=36){throw"Shared key is invalid"}aP.sharedKey=d;aP.guid=M;aP.format=aN.format?aN.format:"plain";$.ajax({dataType:aN.format?aN.format:"text",type:"POST",url:root+aM,data:aP,success:function(aQ){aO(aQ)},error:function(aQ){aL(aQ)}})};this.isCorrectMainPassword=function(aL){return az==aL};this.setDoubleEncryption=function(aN,aL,aP){var aM=function(aQ){console.log("Panic "+aQ);window.location.reload()};try{if(F==aN){return}if(aN){h.getSecondPassword(function(){try{F=true;af=aL;for(var aS in I){var aU=I[aS];if(aU.priv!=null){aU.priv=i(B58.decode(aU.priv))}}var aQ=Crypto.SHA256(d+af,{asBytes:true});for(var aR=1;aR<S;++aR){aQ=Crypto.SHA256(aQ,{asBytes:true})}w=Crypto.util.bytesToHex(aQ);af=null;h.getSecondPassword(function(){try{h.checkAllKeys();h.backupWallet("update",function(){aP()},function(){aM(aV)})}catch(aV){aM(aV)}},function(){aM()})}catch(aT){aM(aT)}},function(){aM()})}else{h.getSecondPassword(function(){try{for(var aQ in I){var aS=I[aQ];if(aS.priv!=null){aS.priv=h.decryptPK(aS.priv)}}F=false;af=null;h.checkAllKeys();h.backupWallet("update",function(){aP()},function(){aM(aR)})}catch(aR){aM(aR)}},function(aQ){aM(aQ)})}}catch(aO){aM(aO)}};function L(){try{$(".popover").remove()}catch(aL){}}$(window).resize(function(){$(".modal:visible").center();L()});this.setLoadingText=function(aL){$(".loading-text").text(aL)};function aG(aM,aL){aM.click(function(){z(aL.txIndex,aL.result)});aM.find(".show-note").mouseover(function(){var aN=aL.note?aL.note:b[aL.hash];aB(this,aN,aL.hash)});aM.find(".add-note").mouseover(function(){m(this,aL.hash)});return aM}function t(aM,aS){var aL=0;for(var aO=0;aO<aM.inputs.length;++aO){var aN=aM.inputs[aO].prev_out;if(!aN||!aN.addr){continue}var aR=I[aN.addr];if(aR){var aQ=parseInt(aN.value);aL-=aQ;if(aS){P+=aQ;aR.balance-=aQ}}}for(var aP=0;aP<aM.out.length;++aP){var aN=aM.out[aP];if(!aN||!aN.addr){continue}var aR=I[aN.addr];if(aR){var aQ=parseInt(aN.value);aL+=aQ;if(aS){ak+=aQ;aR.balance+=aQ}}}return aL}function ab(){return Crypto.util.bytesToHex(Crypto.SHA256(ac,{asBytes:true}))}function y(aL){aL.onmessage=function(aT){try{var aQ=$.parseJSON(aT.data);if(aQ.op=="on_change"){var aU=ab();var aS=aQ.checksum;console.log("On change old "+aU+" ==  new "+aS);if(aU!=aS){setTimeout(J,250)}}else{if(aQ.op=="utx"){var aR=TransactionFromJSON(aQ.x);for(var aW in E){if(E[aW].txIndex==aR.txIndex){return}}var aY=t(aR,true);if(h.getHTML5Notifications()){var aP=function(aZ){try{if(window.webkitNotifications&&navigator.userAgent.indexOf("Chrome")>-1){if(webkitNotifications.checkPermission()==0){webkitNotifications.createNotification(aZ.iconUrl,aZ.title,aZ.body).show()}}else{if(window.Notification){if(Notification.permissionLevel()==="granted"){new Notification(aZ.title,aZ).show()}}}}catch(a0){}};try{aP({title:aY>0?"Payment Received":"Payment Sent",body:"Transaction Value "+formatBTC(aY)+" BTC",iconUrl:resource+"cube48.png"})}catch(aT){console.log(aT)}}aR.result=aY;ap+=aY;K++;aR.setConfirmations(0);playSound("beep");if(aj==0&&an==0){E.unshift(aR);var aV=false;if(E.length>50){E.pop();aV=true}}var aN=T();if("my-transactions"==aN){if(aj==0&&an==0){$("#no-transactions").hide();if(s.tx_display==0){var aM=$("#transactions-compact").show();aG($(C(aR,I,g)),aR).prependTo(aM.find("tbody")).find("div").hide().slideDown("slow");if(aV){aM.find("tbody tr:last-child").remove()}}else{var aM=$("#transactions-detailed").show();aM.prepend(aR.getHTML(I,g));if(aV){aM.find("div:last-child").remove()}setupSymbolToggle()}}}else{c()}}else{if(aQ.op=="block"){for(var aO=0;aO<aQ.x.txIndexes.length;++aO){for(var aX=0;aX<E.length;++aX){if(E[aX].txIndex==aQ.x.txIndexes[aO]){if(E[aX].blockHeight==null||E[aX].blockHeight==0){E[aX].blockHeight=aQ.x.height;break}}}}ao(BlockFromJSON(aQ.x));V()}}}}catch(aT){console.log(aT);console.log(aT.data)}};aL.onopen=function(){al("ok");var aP='{"op":"blocks_sub"}';if(M!=null){aP+='{"op":"wallet_sub","guid":"'+M+'"}'}try{var aN=h.getActiveAddresses();for(var aM in aN){aP+='{"op":"addr_sub", "addr":"'+aN[aM]+'"}'}}catch(aO){alert(aO)}aL.send(aP)};aL.onclose=function(){al("error")}}var aF="ok";function al(aM){var aL=$("#logout");if(aM=="loading_start"){aL.attr("src",resource+"logout-orange.png");return}else{if(aM!="loading_stop"){aF=aM}}if(aF=="ok"){aL.attr("src",resource+"logout.png")}else{if(aF=="error"){aL.attr("src",resource+"logout-red.png")}}}this.makeNotice=function(aM,aP,aO,aN){if(aO==null||aO.length==0){return}console.log(aO);if(aN==null){aN=5000}var aL=$('<div class="alert alert-block alert-'+aM+'"></div>');aL.text(""+aO);if($("#"+aP).length>0){aL.attr("id",aP);return}$("#notices").append(aL).hide().fadeIn(200);if(aN>0){(function(){var aQ=aL;setTimeout(function(){aQ.fadeOut(250,function(){$(this).remove()})},aN)})()}};function aw(aL){return aL}function am(aL){return h.decryptPK(aL)}function Y(aL){var aM=h.decodePK(aL);return Crypto.util.bytesToBase64(aM)}function k(aL){var aM=h.decodePK(aL);return Crypto.util.bytesToHex(aM)}this.base58ToSipa=function(aL,aQ){var aM=h.decodePK(aL);var aN=new Bitcoin.ECKey(aM);while(aM.length<32){aM.unshift(0)}aM.unshift(128);if(aN.getBitcoinAddress().toString()==aQ){}else{if(aN.getBitcoinAddressCompressed().toString()==aQ){aM.push(1)}else{throw"Private Key does not match bitcoin address"+aQ}}var aO=Crypto.SHA256(Crypto.SHA256(aM,{asBytes:true}),{asBytes:true});aM=aM.concat(aO.slice(0,4));var aP=B58.encode(aM);return aP};this.makeWalletJSON=function(aL){return h.makeCustomWalletJSON(aL,M,d)};this.makeCustomWalletJSON=function(aP,aM,aR){var aO=aw;if(aP=="base64"){aO=Y}else{if(aP=="hex"){aO=k}else{if(aP=="sipa"){aO=h.base58ToSipa}else{if(aP=="base58"){aO=am}}}}var aL='{\n	"guid" : "'+aM+'",\n	"sharedKey" : "'+aR+'",\n';if(F&&w!=null&&aO==aw){aL+='	"double_encryption" : '+F+',\n	"dpasswordhash" : "'+w+'",\n'}if(s){aL+='	"options" : '+JSON.stringify(s)+",\n"}aL+='	"keys" : [\n';for(var aN in I){var aQ=I[aN];aL+='	{"addr" : "'+aQ.addr+'"';if(aQ.priv!=null){aL+=',\n	 "priv" : "'+aO(aQ.priv,aQ.addr)+'"'}if(aQ.tag==2){aL+=',\n	 "tag" : '+aQ.tag}if(aQ.label!=null){aL+=',\n	 "label" : "'+aQ.label+'"'}aL+="},\n";atLeastOne=true}if(atLeastOne){aL=aL.substring(0,aL.length-2)}aL+="\n	]";if(av(g)>0){aL+=',\n	"address_book" : [\n';for(var aN in g){aL+='	{"addr" : "'+aN+'",\n';aL+='	 "label" : "'+g[aN]+'"},\n'}aL=aL.substring(0,aL.length-2);aL+="\n	]"}if(av(b)>0){aL+=',\n	"tx_notes" : '+JSON.stringify(b)}aL+="\n}";return aL};this.get_history=function(aM,aL){BlockchainAPI.get_history(function(aN){H(aN,false);c();if(aM){aM()}},function(){if(aL){aL()}},aj,an)};this.deleteAddressBook=function(aL){delete g[aL];ad();$("#send-coins").find(".tab-pane").trigger("show",true)};function u(aL){$("#send-coins").find(".tab-pane.active").trigger("show",aL);if(aL){BlockchainAPI.get_ticker();$(".send").attr("disabled",false)}}function l(aL,aM,aQ){var aP=aL.val();aL.empty();for(var aO in I){var aR=I[aO];if(!aR||aR.tag==2){continue}var aN=aR.label;if(!aN){aN=aR.addr.substring(0,15)+"..."}if(aM||aR.balance>0){aL.prepend('<option value="'+aR.addr+'">'+aN+" - "+formatBTC(aR.balance)+" BTC</option>")}}aL.prepend('<option value="any" selected>Any Address</option>');if(!aQ&&aP){aL.val(aP)}}function r(aN,aO){l(aN.find('select[name="from"]'),false,aO);l(aN.find('select[name="change"]'),true,aO);aN.find('select[name="change"]').prepend('<option value="new">New Address</option>');if(aO){aN.find("input").val("");aN.find(".send-value-usd").text(formatSymbol(0,symbol_local)).val("");aN.find(".amount-needed").text(0)}var aM=aN.find(".recipient-container");if(aO){var aQ=aM.find(".recipient:first-child").clone();aM.empty().append(aQ)}function aL(){var aR=0;aN.find('input[name="send-value"]').each(function(){var aS=parseFloat($(this).val());if(!isNaN(aS)){aR+=aS}});return aR}function aP(aR){aR.find('input[name="send-to-address"]').val("").typeahead({source:ar()}).next().click(function(){var aS=$(this).prev();h.scanQRCode(function(aT){console.log(aT);try{new Bitcoin.Address(aT);aS.val(aT)}catch(aU){loadScript("wallet/jsuri-1.1.1.min.js",function(){try{var aV=new Uri(aT);aS.val(aV.host());aR.find('input[name="send-value"]').val(aV.getQueryParamValue("amount"))}catch(aW){h.makeNotice("error","error","Invalid Bitcoin Address or URI")}},function(){h.makeNotice("error","error","Invalid Bitcoin Address or URI")})}},function(aT){h.makeNotice("error","misc-error",aT)})});aR.find(".local-symbol").text(symbol_local.symbol);aR.find('input[name="send-value"]').val("").bind("keyup change",function(aS){if(aS.keyCode=="9"){return}aN.find(".amount-needed").text(formatBTC(Bitcoin.Util.parseValue(aL().toFixed(8)).toString()));aR.find(".send-value-usd").val(convert($(this).val()*100000000,symbol_local.conversion)).text(formatSymbol($(this).val()*100000000,symbol_local))});aR.find(".send-value-usd").val("").text(formatSymbol(0,symbol_local)).bind("keyup change",function(aS){if(aS.keyCode=="9"){return}aR.find('input[name="send-value"]').val(formatBTC(parseFloat($(this).val())*symbol_local.conversion))})}aM.find(".recipient").each(function(){aP($(this))});aN.find(".remove-recipient").unbind().click(function(){var aR=aM.find(".recipient").length;if(aR>1){if(aR==2){$(this).hide(200)}aM.find(".recipient:last-child").remove()}});aN.find(".add-recipient").unbind().click(function(){var aR=aM.find(".recipient:first-child").clone();aR.appendTo(aM);aP(aR);aN.find(".remove-recipient").show(200)})}this.getAllAddresses=function(){var aM=[];for(var aL in I){aM.push(aL)}return aM};this.getPreferredAddress=function(){var aM=null;for(var aL in I){var aN=I[aL];if(aM==null){aM=aN}if(aN.priv!=null){if(aM==null){aM=aN}if(aN.tag==null||aN.tag==0){aM=aN;break}}}return aM.addr};function aI(){console.log("backupInstructionsModal");var aL=$("#restore-backup-modal");aL.modal({keyboard:true,backdrop:"static",show:true});aL.find(".btn.btn-secondary").unbind().click(function(){aL.modal("hide")})}this.scanQRCode=function(aN,aL){var aM=$("#qr-code-reader-modal");aM.modal({keyboard:false,backdrop:"static",show:true});loadScript("wallet/qr.code.reader.js",function(){QRCodeReader.init(aM,function(aO){aM.modal("hide");aN(aO)},function(aO){aM.modal("hide");aL(aO)})},aL);aM.find(".btn.btn-secondary").unbind().click(function(){QRCodeReader.stop();aM.modal("hide");aL()})};function U(aL){var aO=[];for(var aM in I){var aN=I[aM];if(aN.tag==aL){aO.push(aN.addr)}}return aO}this.getActiveAddresses=function(){return U()};this.getArchivedAddresses=function(){return U(2)};function ao(aO){if(aO!=null){ax=aO;for(var aM in E){var aL=E[aM];if(aL.blockHeight!=null&&aL.blockHeight>0){var aN=ax.height-aL.blockHeight+1;if(aN<=100){aL.setConfirmations(ax.height-aL.blockHeight+1)}else{aL.setConfirmations(null)}}else{aL.setConfirmations(0)}}}}function z(aM,aL){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Transaction Summary",description:"",src:root+"tx-summary/"+aM+"?result="+aL+"&guid="+M})})}this.deleteNote=function(aL){delete b[aL];c();ad()};function m(aL,aM){(function(aO,aQ){aO=$(aO);if(!aO.data("popover")){aO.popover({title:'Add Note <span style="float:right"><i class="icon-remove-sign"></i></span>',trigger:"manual",content:'<textarea style="width:97%;height:50px;margin-top:2px" placeholder="Enter the note here..."></textarea><div style="text-align:right"><button class="btn btn-small">Save</button></div>'})}else{if(aO.data("popover").tip().is(":visible")){return}}aO.popover("show");aO.mouseleave(function(){if(!aO.__timeout){aO.__timeout=setTimeout(function(){aO.popover("hide")},250)}});function aN(){if(aO.__timeout){clearTimeout(aO.__timeout);aO.__timeout=null}}var aP=aO.data("popover").tip().mouseenter(aN);aP.find("textarea").focus(aN);aP.mouseleave(function(){aO.__timeout=setTimeout(function(){aO.popover("hide")},250)});aP.find("i").unbind().click(function(){aO.popover("hide")});aP.find("button").click(function(){var aR=$.trim($("<div>"+aP.find("textarea").val()+"</div>").text().replace(/'/g,"").replace(/"/g,""));if(aR.length>0){b[aQ]=aR;ad()}c()})})(aL,aM)}function aB(aL,aM,aN){(function(aO,aP,aR){aO=$(aO);if(!aO.data("popover")){var aS="Note";if(b[aR]){aS+=' <span style="float:right"><img src="'+resource+'delete.png" /></span>'}$(aO).popover({title:aS,trigger:"manual",content:aP})}else{if(aO.data("popover").tip().is(":visible")){return}}aO.popover("show");aO.mouseleave(function(){if(!aO.__timeout){aO.__timeout=setTimeout(function(){aO.popover("hide")},250)}});var aQ=aO.data("popover").tip().mouseenter(function(){if(aO.__timeout){clearTimeout(aO.__timeout);aO.__timeout=null}});aQ.find("img").unbind().click(function(){h.deleteNote(aR)});aQ.mouseleave(function(){aO.__timeout=setTimeout(function(){aO.popover("hide")},250)})})(aL,aM,aN)}function C(aO,aT,aQ){var aU=aO.result;var aP='<tr class="pointer" id="tx-'+aO.txIndex+'"><td class="hidden-phone" style="width:365px"><div><ul style="margin-left:0px;" class="short-addr">';var aM=true;if(aU>=0){for(var aN=0;aN<aO.inputs.length;++aN){var aL=aO.inputs[aN].prev_out;if(!aL||!aL.addr){aM=false;aP+='<span class="label">Newly Generated Coins</span>'}else{var aR=aT[aL.addr];if(aR){continue}aM=false;aP+=formatOutput(aL,aT,aQ)}}}else{if(aU<0){for(var aN=0;aN<aO.out.length;++aN){var aL=aO.out[aN];var aR=aT[aL.addr];if(aR&&aL.type==0){continue}aM=false;aP+=formatOutput(aL,aT,aQ)}}}if(aM){aP+='<span class="label">Moved Between Wallet</info>'}aP+="</ul></div></td><td><div>";var aS=aO.note?aO.note:b[aO.hash];if(aS){aP+='<img src="'+resource+'note.png" class="show-note"> '}else{aP+='<img src="'+resource+'note_grey.png" class="add-note"> '}if(aO.time>0){aP+=dateToString(new Date(aO.time*1000))}if(aO.confirmations==0){aP+=' <span class="label label-important pull-right hidden-phone">Unconfirmed Transaction!</span> '}else{if(aO.confirmations>0){aP+=' <span class="label label-info pull-right hidden-phone">'+aO.confirmations+" Confirmations</span> "}}aP+="</div></td>";if(aU>0){aP+='<td style="color:green"><div>'+formatMoney(aU,true)+"</div></td>"}else{if(aU<0){aP+='<td style="color:red"><div>'+formatMoney(aU,true)+"</div></td>"}else{aP+="<td><div>"+formatMoney(aU,true)+"</div></td>"}}if(aO.balance==null){aP+="<td></td></tr>"}else{aP+='<td class="hidden-phone"><div>'+formatMoney(aO.balance)+"</div></td></tr>"}return aP}function T(){L();if(ap==null){$("#balance").html("Loading...")}else{$("#balance").html(formatSymbol(ap,symbol));$("#balance2").html(formatSymbol(ap,(symbol==symbol_local)?symbol_btc:symbol_local))}return j.attr("id")}function c(aL){var aM=T();if("send-coins"==aM){u(aL)}else{if("home-intro"==aM){f(aL)}else{if("receive-coins"==aM){aK(aL)}else{if("my-transactions"==aM){V(aL)}}}}}function f(aL){$("#summary-n-tx").html(K);$("#summary-received").html(formatMoney(ak,true));$("#summary-sent").html(formatMoney(P,true));$("#summary-balance").html(formatMoney(ap,symbol));var aN=h.getPreferredAddress();$("#tweet-for-btc").unbind().click(function(){window.open("https://twitter.com/share?url=https://blockchain.info/wallet&hashtags=tweet4btc,bitcoin,"+aN+"&text=Sign Up For a Free Bitcoin Wallet @ Blockchain.info","","toolbar=0, status=0, width=650, height=360")});if(h.isWatchOnly(aN)==null){$(".no-watch-only").hide()}else{$(".no-watch-only").show();var aM=$("#my-primary-address");if(aM.text()!=aN){aM.text(aN);loadScript("wallet/jquery.qrcode.min.js",function(){$("#my-primary-addres-qr-code").qrcode({width:125,height:125,text:aN})})}}}function Q(){var aL=$("#export-warning").show();var aM=$("#import-export-content").hide();$("#show-import-export").unbind().click(function(){h.getMainPassword(function(){aL.hide();loadScript("wallet/import-export.min.js",function(){ImportExport.init(aM,function(){aM.show()},function(){aa($("#home-intro"))})},function(aN){h.makeNotice("error","misc-error",aN);aa($("#home-intro"))})},function(){aa($("#home-intro"))})})}function V(){var aM=null;var aO=0;if(aM!=null){clearInterval(aM);aM=null}var aL;if(s.tx_display==0){$("#transactions-detailed").hide();aL=$("#transactions-compact").show().find("tbody").empty()}else{$("#transactions-compact").hide();aL=$("#transactions-detailed").empty().show()}if(E.length==0){$("#transactions-detailed, #transactions-compact").hide();$("#no-transactions").show();return}else{$("#no-transactions").hide()}var aN=function(){for(var aS=aO;aS<E.length&&aS<(aO+10);++aS){var aR=E[aS];if(s.tx_display==0){aL.append(aG($(C(aR,I,g)),aR))}else{aL.append(aR.getHTML(I,g))}}aO+=10;if(aO<E.length){aM=setTimeout(aN,15)}else{setupSymbolToggle();L();var aQ=$(".pagination ul").empty();if(an==0&&E.length<50){aQ.hide();return}else{aQ.show()}var aP=Math.ceil(aJ/50);var aT=" disabled";if(an>0){aT=""}aQ.append($('<li class="prev'+aT+'"><a>&larr; Previous</a></li>').click(function(){h.setPage(an-1)}));for(var aS=0;aS<aP&&aS<=10;++aS){(function(aU){var aV="";if(an==aU){aV=' class="active"'}aQ.append($("<li"+aV+'><a class="hidden-phone">'+aU+"</a></li>").click(function(){h.setPage(aU)}))})(aS)}var aT=" disabled";if(an<aP){aT=""}aQ.append($('<li class="next'+aT+'"><a>Next &rarr;</a></li>').click(function(){h.setPage(an+1)}))}};aN()}this.setPage=function(aL){an=aL;scroll(0,0);h.get_history()};function v(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Export History",description:"",src:root+"export-history?active="+h.getActiveAddresses().join("|")+"&archived="+h.getArchivedAddresses().join("|")})})}function H(aO,aN){if(!aN&&aO.mixer_fee){x=aO.mixer_fee}E.length=0;if(aO.wallet==null){ak=0;P=0;ap=0;K=0;aJ=0;return}ak=aO.wallet.total_received;P=aO.wallet.total_sent;ap=aO.wallet.final_balance;K=aO.wallet.n_tx;aJ=aO.wallet.n_tx_filtered;for(var aM=0;aM<aO.addresses.length;++aM){if(I[aO.addresses[aM].address]){I[aO.addresses[aM].address].balance=aO.addresses[aM].final_balance}}for(var aM=0;aM<aO.txs.length;++aM){var aL=TransactionFromJSON(aO.txs[aM]);aL.result=t(aL,false);E.push(aL)}if(aO.info){$("#nodes-connected").html(aO.info.nconnected);if(aO.info.latest_block!=null){ao(aO.info.latest_block)}setLocalSymbol(aO.info.symbol_local)}}function aC(){R=setTimeout(h.logout,h.getLogoutTime());for(var aM in W){W[aM]("did_decrypt")}window.location.hash="";try{var aL=localStorage.getItem("multiaddr");if(aL!=null){H($.parseJSON(aL),true);c()}}catch(aN){}h.get_history();aa($("#home-intro"));$("#initial_error,#initial_success").remove()}function J(){for(var aL in I){var aN=I[aL];if(aN.tag==1){alert("Warning! wallet data may have changed but cannot sync as you have uns-saved keys");return}}console.log("Get wallet with checksum "+aq);var aM={guid:M,sharedKey:d,format:"plain"};if(aq&&aq.length>0){aM.checksum=aq}$.ajax({type:"GET",url:root+"wallet/wallet.aes.json",data:aM,success:function(aO){if(aO==null||aO.length==0||aO=="Not modified"){return}console.log("Wallet data modified");h.setEncryptedWalletData(aO);if(X()){h.get_history();c()}else{window.location.reload()}}})}function X(){try{if(ac==null||ac.length==0){h.makeNotice("error","misc-error","No Wallet Data To Decrypt");return false}var aO=null;h.decrypt(ac,az,function(aP){try{aO=$.parseJSON(aP);return(aO!=null)}catch(aQ){return false}});if(aO==null){throw"Error Decrypting Wallet. Please check your password is correct."}if(aO.double_encryption&&aO.dpasswordhash){F=aO.double_encryption;w=aO.dpasswordhash}if(aO.options){$.extend(s,aO.options)}else{if(aO.fee_policy){h.setFeePolicy(aO.fee_policy)}if(aO.html5_notifications){h.setHTML5Notifications(aO.html5_notifications)}}I={};for(var aM=0;aM<aO.keys.length;++aM){var aL=aO.keys[aM];if(aL.addr==null||aL.addr.length==0||aL.addr=="undefined"){h.makeNotice("error","null-error","Your wallet contains an undefined address. This is a sign of possible corruption, please double check all your BTC is accounted for. Backup your wallet to remove this error.",15000);continue}I[aL.addr]=aL}g={};if(aO.address_book){for(var aM=0;aM<aO.address_book.length;++aM){h.addAddressBookEntry(aO.address_book[aM].addr,aO.address_book[aM].label)}}if(aO.tx_notes){b=aO.tx_notes}d=aO.sharedKey;if(d==null||d.length==0||d.length!=36){throw"Shared Key is invalid"}if(aq==null||aq.length==0){aq=ab()}J();e();return true}catch(aN){h.makeNotice("error","misc-error",aN)}return false}this.getPassword=function(aQ,aR,aO){aQ.modal({keyboard:false,backdrop:"static",show:true});aQ.center();var aN=aQ.find('input[name="password"]');var aM=aN,aL=false,aP=false;aQ.find(".vkeyboard li").click(function(){var aU=$(this),aT=aU.html();if(aU.hasClass("left-shift")||aU.hasClass("right-shift")){$(".letter").toggleClass("uppercase");$(".symbol span").toggle();aL=(aL===true)?false:true;aP=false;return false}if(aU.hasClass("capslock")){$(".letter").toggleClass("uppercase");aP=true;return false}if(aU.hasClass("delete")){var aS=aM.val();aM.val(aS.substr(0,aS.length-1));return false}if(aU.hasClass("symbol")){aT=$("span:visible",aU).html()}if(aU.hasClass("space")){aT=" "}if(aU.hasClass("tab")){aT="\t"}if(aU.hasClass("return")){aT="\n"}if(aU.hasClass("uppercase")){aT=aT.toUpperCase()}if(aL===true){$(".symbol span").toggle();if(aP===false){$(".letter").toggleClass("uppercase")}aL=false}aM.val(aM.val()+aT)});aN.unbind().keypress(function(aS){if(aS.keyCode==13){aS.preventDefault();aQ.find(".btn.btn-primary").click()}});aN.val("");aQ.find(".btn.btn-primary").unbind().click(function(){if(aR){aO=null;var aS=aR;aR=null;aQ.modal("hide");setTimeout(function(){aS(aN.val())},100)}});aQ.find(".btn.btn-secondary").unbind().click(function(){if(aO){var aS=aO;aO=null;setTimeout(function(){try{aS()}catch(aT){h.makeNotice("error","misc-error",aT)}},100)}aQ.modal("hide")});aQ.unbind().on("hidden",function(){if(aO){var aS=aO;aO=null;setTimeout(function(){try{aS()}catch(aT){h.makeNotice("error","misc-error",aT)}},100)}})};this.makePairingQRCode=function(aL){h.getMainPassword(function(){loadScript("wallet/jquery.qrcode.min.js",function(){try{aL($("<div></div>").qrcode({width:300,height:300,text:M+"|"+d+"|"+az}))}catch(aM){h.makeNotice("error","misc-error",aM)}})},function(){h.logout()})};this.getMainPassword=function(aM,aL){if(B>new Date().getTime()-N){return aM(az)}h.getPassword($("#main-password-modal"),function(aN){if(az==aN){B=new Date().getTime();if(aM){try{aM(az)}catch(aO){h.makeNotice("error","misc-error",aO)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aL){try{aL()}catch(aO){h.makeNotice("error","misc-error",aO)}}}},aL)};this.getSecondPassword=function(aN,aL){if(!F||af!=null){if(aN){try{aN(af)}catch(aM){h.makeNotice("error","misc-error",aM)}}return}h.getPassword($("#second-password-modal"),function(aO){if(aA(aO)){if(aN){try{aN(aO)}catch(aP){h.makeNotice("error","misc-error",aP)}}}else{h.makeNotice("error","misc-error","Password incorrect.");if(aL){try{aL()}catch(aP){h.makeNotice("error","misc-error",aP)}}}},aL)};function a(){if(A){console.log("Already initd");return}var aL=$("#restore-password");az=aL.val();aL.val("");B=new Date().getTime();if(ac==null||ac.length==0){h.setLoadingText("Validating Authentication key");var aM=$.trim($(".auth-"+q).find(".code").val());if(aM.length==0||aM.length>255){h.makeNotice("error","misc-error","You must enter a Two Factor Authentication code");return false}$.ajax({type:"POST",url:root+"wallet",data:{guid:M,payload:aM,length:aM.length,method:"get-wallet",format:"plain"},success:function(aN){try{if(aN==null||aN.length==0){h.makeNotice("error","misc-error","Server Return Empty Wallet Data");return}h.setEncryptedWalletData(aN);$(".auth-"+q).hide();$(".auth-0").show();if(X()){n();aC()}}catch(aO){h.makeNotice("error","misc-error",aO)}},error:function(aN){h.makeNotice("error","misc-error",aN.responseText)}})}else{if(X()){n();aC()}}return true}function e(){al("error");webSocketConnect(y);A=true;$("#tech-faq").hide();$("#intro-text").hide();$("#large-summary").show()}this.quickSendNoUI=function(aN,aM,aL){loadScript("wallet/signer.min.js",function(){h.getSecondPassword(function(){try{var aP=initNewTx();aP.from_addresses=h.getActiveAddresses();aP.to_addresses.push({address:new Bitcoin.Address(aN),value:Bitcoin.Util.parseValue(aM)});aP.addListener(aL);aP.start()}catch(aO){aL.on_error(aO)}},function(aO){aL.on_error(aO)})})};function G(){h.setLoadingText("Sending email backup");$.ajax({type:"POST",url:root+"wallet",data:{guid:M,sharedKey:d,method:"email-backup",format:"plain"},success:function(aL){h.makeNotice("success","backup-success",aL)},error:function(aL){h.makeNotice("error","misc-error",aL.responseText)}})}function ad(aO,aN,aM,aL){if(ah!=null){clearInterval(ah);ah=null}ah=setTimeout(function(){h.backupWallet(aO,aN,aM,aL)},3000)}this.backupWallet=function(aS,aR,aL){try{if(aS==null){aS="update"}if(av(I)==0){return}var aN=h.makeWalletJSON();var aQ=h.encrypt(aN,az);if(aQ.length==0){throw"Error encrypting the JSON output"}var aP=null;h.decrypt(aQ,az,function(aT){try{aP=$.parseJSON(aT);return(aP!=null)}catch(aU){return false}});if(aP==null){throw"Error Decrypting Previously encrypted JSON. Not Saving Wallet."}var aM=aq;h.setLoadingText("Saving wallet");h.setEncryptedWalletData(aQ);$.ajax({type:"POST",url:root+"wallet",data:{guid:M,length:aQ.length,payload:aQ,sharedKey:d,checksum:aq,old_checksum:aM,method:aS},converters:{"* text":window.String,"text html":true,"text json":window.String,"text xml":window.String},success:function(aU){var aW=false;for(var aT in I){var aV=I[aT];if(aV.tag==1){aV.tag=null;aW=true}}h.makeNotice("success","misc-success",aU);c();if(aR!=null){aR()}},error:function(aT){h.makeNotice("error","misc-error",aT.responseText,10000);c();if(aL!=null){aL()}}})}catch(aO){h.makeNotice("error","misc-error","Error Saving Wallet: "+aO,10000);c();if(aL!=null){aL(aO)}else{throw aO}}};function aE(aL){if(F){if(af==null){throw"Cannot encrypt private key without a password"}return h.encrypt(aL,d+af)}else{return aL}return null}this.isBase58=function(aN,aM){for(var aL=0;aL<aN.length;++aL){if(aN[aL]<0||aN[aL]>58){return false}}return true};this.encrypt=function(aM,aL){return Crypto.AES.encrypt(aM,aL,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:S})};this.decrypt=function(aO,aN,aQ,aM){try{var aL=Crypto.AES.decrypt(aO,aN,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:S});if(aL!=null&&aL.length>0){if(aQ(aL)){return aL}}}catch(aP){console.log(aP)}try{var aL=Crypto.AES.decrypt(aO,aN,{mode:new Crypto.mode.OFB(Crypto.pad.iso7816),iterations:1});if(aL!=null&&aL.length>0){if(aQ(aL)){return aL}}}catch(aP){console.log(aP)}try{var aL=Crypto.AES.decrypt(aO,aN,{mode:new Crypto.mode.CBC(Crypto.pad.iso10126),iterations:1});if(aL!=null&&aL.length>0){if(aQ(aL)){return aL}}}catch(aP){console.log(aP)}if(aM!=null){aM()}return null};this.setGUID=function(aO,aM){if(A){throw"Cannot Set GUID Once Initialized"}h.setLoadingText("Changing Wallet Identifier");$("#initial_error,#initial_success").remove();try{var aL=localStorage.getItem("guid")}catch(aP){}var aN=$("#restore-wallet-continue");aN.attr("disabled",true);$.ajax({type:"GET",dataType:"json",url:root+"wallet/"+aO,data:{format:"json",resend_code:aM},success:function(aR){aN.attr("disabled",false);$(".auth-"+q).hide();M=aR.guid;q=aR.auth_type;aD=aR.real_auth_type;h.setEncryptedWalletData(aR.payload);war_checksum=aR.war_checksum;setLocalSymbol(aR.symbol_local);$("#restore-guid").val(M);$(".auth-"+q).show();if(aR.initial_error){h.makeNotice("error","misc-error",aR.initial_error)}if(aR.initial_success){h.makeNotice("success","misc-success",aR.initial_success)}try{if(aL!=M){localStorage.clear();if(M!=D){localStorage.setItem("guid",M)}}}catch(aQ){}},error:function(aR){aN.attr("disabled",false);if(aL==aO&&ac){h.makeNotice("error","misc-error","Error Contacting Server. Using Local Wallet Cache.");M=aL;aq=ab();q=0;$("#restore-guid").val(M);$(".auth-"+q).show();return}try{var aQ=$.parseJSON(aR.responseText);if(aQ.initial_error){h.makeNotice("error","misc-error",aQ.initial_error);return}}catch(aR){}if(aR.responseText){h.makeNotice("error","misc-error",aR.responseText)}else{h.makeNotice("error","misc-error","Error changing wallet identifier")}}})};function i(aL){var aM=B58.encode(aL);return aE(aM)}this.decryptPK=function(aL){if(F){if(af==null){throw"Cannot decrypt private key without a password"}return h.decrypt(aL,d+af,h.isBase58)}else{return aL}return null};this.decodePK=function(aM){var aL=h.decryptPK(aM);if(aL!=null){return B58.decode(aL)}return null};this.signmessage=function(aL,aN){var aP=I[aL];var aO=h.decodePK(aP.priv);var aM=new Bitcoin.ECKey(aO);return Bitcoin.Message.signMessage(aM,aN,aP.addr)};function aA(aM){var aL=Crypto.SHA256(d+aM,{asBytes:true});var aO=aL;for(var aN=1;aN<S;++aN){aO=Crypto.SHA256(aO,{asBytes:true})}var aQ=Crypto.util.bytesToHex(aO);if(aQ==w){af=aM;return true}if(Crypto.util.bytesToHex(aL)==w){af=aM;w=aQ;return true}var aP=Crypto.SHA256(aM);if(aP==w){af=aM;w=aQ;return true}return false}this.checkAllKeys=function(aL){for(var aM in I){var aQ=I[aM];if(aQ.addr==null){throw"Null Address Found in wallet "+aM}if(aQ.addr.toString()==null){throw"Error decoding wallet address "+aQ.addr}if(aQ.priv!=null){var aP=h.decodePK(aQ.priv);var aO=new Bitcoin.ECKey(aP);var aN=aO.getBitcoinAddress().toString();if(aN!=aQ.addr&&aO.getBitcoinAddressCompressed().toString()!=aQ.addr){throw"Private key does not match bitcoin address "+aQ.addr+" != "+aN}if(aL){aQ.priv=i(aP)}}}h.makeNotice("success","wallet-success","Wallet verified.")};this.setMainPassword=function(aL){h.getMainPassword(function(){az=aL;h.backupWallet("update",function(){h.logout()},function(){h.logout()})})};function aa(aL){if(aL===j){return}if(j!=null){if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","")}j.hide()}j=aL;j.show();if($("#"+j.attr("id")+"-btn").length>0){$("#"+j.attr("id")+"-btn").parent().attr("class","active")}c(true)}function av(aN){var aM=0,aL;for(aL in aN){aM++}return aM}function Z(aL){I[aL].priv=null}function ae(){if(av(I)>=at){h.makeNotice("error","misc-error","We currently support a maximum of "+at+" private keys, please remove some unused ones.");return true}return false}function aH(aN,aL){var aM=I[aN];if(!aM||aM.length==0){I[aN]={addr:aN,priv:aL,balance:0};return true}else{if(!aM.priv&&aL){aM.priv=aL;return true}}return false}function o(){var aN=$("#add-address-book-entry-modal");aN.modal({keyboard:true,backdrop:"static",show:true});var aL=aN.find('input[name="label"]');var aM=aN.find('input[name="address"]');aL.val("");aM.val("");aN.find(".btn.btn-primary").unbind().click(function(){aN.modal("hide");var aP=$.trim($("<div>"+aL.val()+"</div>").text());var aO=$.trim(aM.val());if(aP.length==0){h.makeNotice("error","misc-error","You must enter a label for the address book entry");return false}if(aP.indexOf('"')!=-1){h.makeNotice("error","misc-error","Label cannot contain double quotes");return false}if(aO.length==0){h.makeNotice("error","misc-error","You must enter a bitcoin address for the address book entry");return false}var aR;try{aR=new Bitcoin.Address(aO);if(aR==null){throw"Null address"}}catch(aQ){h.makeNotice("error","misc-error","Bitcoin address invalid, please make sure you entered it correctly");return false}if(g[aO]!=null){h.makeNotice("error","misc-error","Bitcoin address already exists");return false}h.makeNotice("success","misc-success","Added Address book entry");h.addAddressBookEntry(aO,aP);ad();$("#send-coins").find(".tab-pane").trigger("show",true)});aN.find(".btn.btn-secondary").unbind().click(function(){aN.modal("hide")})}this.logout=function(){$.ajax({type:"GET",url:root+"wallet/logout",data:{format:"plain"},success:function(aL){window.location.reload()},error:function(){window.location.reload()}})};function ai(aR){var aT=$("#delete-address-modal");aT.modal({keyboard:true,backdrop:"static",show:true});aT.find(".btn.btn-primary").hide();aT.find(".btn.btn-danger").hide();$("#change-mind").hide();aT.find("#to-delete-address").html(aR.join(" "));aT.find("#delete-balance").empty();var aN=aT.find("#delete-balance");var aL=[];for(var aQ in aR){var aS=aR[aQ];if(I[aS]&&I[aS].priv){aL.push(aR[aQ])}}BlockchainAPI.get_balance(aL,function(aU){aT.find(".btn.btn-primary").show(200);aT.find(".btn.btn-danger").show(200);aN.html("Balance "+formatBTC(aU)+" BTC");if(aU>0){aN.css("color","red")}else{aN.css("color","black")}},function(){aT.find(".btn.btn-primary").show(200);aT.find(".btn.btn-danger").show(200);aN.text("Error Fetching Balance")});var aO=false;var aQ=0;var aM=null;var aP=10;changeMind=function(){$("#change-mind").show();$("#change-mind-time").text(aP-aQ)};aT.find(".btn.btn-primary").unbind().click(function(){changeMind();aT.find(".btn.btn-primary").hide();aT.find(".btn.btn-danger").hide();aM=setInterval(function(){if(aO){return}++aQ;changeMind();if(aQ==aP){$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Private Key Removed From Wallet");for(var aU in aR){Z(aR[aU])}c();h.backupWallet();clearInterval(aM)}},1000)});aT.find(".btn.btn-danger").unbind().click(function(){changeMind();aT.find(".btn.btn-primary").hide();aT.find(".btn.btn-danger").hide();aM=setInterval(function(){if(aO){return}++aQ;changeMind();if(aQ==aP){try{$("#delete-address-modal").modal("hide");h.makeNotice("warning","warning-deleted","Address & Private Key Removed From Wallet");for(var aU in aR){h.deleteAddress(aR[aU])}c();h.backupWallet("update",function(){h.get_history()})}finally{clearInterval(aM)}}},1000)});aT.unbind().on("hidden",function(){if(aM){aO=true;clearInterval(aM);aM=null}});aT.find(".btn.btn-secondary").unbind().click(function(){aT.modal("hide")})}function ar(){var aN=[];for(var aL in g){aN.push(g[aL])}for(var aL in I){var aM=I[aL];if(aM.tag!=2&&aM.label){aN.push(aM.label)}}return aN}function O(aL){h.getSecondPassword(function(){var aN=$("#sweep-address-modal");aN.modal("show");BlockchainAPI.get_balance(aL,function(aO){aN.find(".balance").text("Amount: "+formatBTC(aO)+" BTC")},function(){aN.find(".balance").text("Error Fetching Balance")});var aM=aN.find('select[name="change"]');l(aM,true);aN.find(".btn.btn-primary").unbind().click(function(){loadScript("wallet/signer.min.js",function(){BlockchainAPI.get_balance(aL,function(aO){var aP=initNewTx();aP.fee=aP.base_fee;aP.to_addresses.push({address:new Bitcoin.Address($.trim(aM.val())),value:BigInteger.valueOf(aO).subtract(aP.fee)});aP.from_addresses=aL;aP.start()},function(){h.makeNotice("error","misc-error","Error Getting Address Balance")})});aN.modal("hide")});aN.find(".btn.btn-secondary").unbind().click(function(){aN.modal("hide")})})}function au(){try{$(".pop").popover({offset:10,placement:"bottom"})}catch(aL){}}function n(){$("#add-address-book-entry-btn").click(function(){o()});$("#home-intro-btn").click(function(){aa($("#home-intro"))});$("#my-transactions-btn").click(function(){aa($("#my-transactions"))});$("#send-coins-btn").click(function(){aa($("#send-coins"))});$("#import-export-btn").click(function(){aa($("#import-export"));Q()});$("#chord-diagram").click(function(){window.open(root+"taint/"+h.getActiveAddresses().join("|"),null,"width=850,height=850")});$("#verify-message").click(function(){loadScript("wallet/address_modal.min.js",function(){verifyMessageModal()})});$("#group-received").click(function(){loadScript("wallet/taint_grouping.min.js",function(){try{loadTaintData()}catch(aL){h.makeNotice("error","misc-error","Unable To Load Taint Grouping Data")}})});$("#my-account-btn").click(function(){aa($("#my-account"));var aL=$("#account-settings-warning").show();var aM=$("#my-account-content").hide();$("#show-account-settings").unbind().click(function(){h.getMainPassword(function(){aL.hide();loadScript("wallet/account.min.js",function(){AccountSettings.init(aM,function(){aM.show()},function(){aa($("#home-intro"))})},function(aN){h.makeNotice("error","misc-error",aN);aa($("#home-intro"))})},function(){aa($("#home-intro"))})})});$("#enable_archived_checkbox").change(function(){var aL=$(this).is(":checked");$(".archived_checkbox").attr("checked",false);$(".archived_checkbox").attr("disabled",!aL);$("#archived-sweep").attr("disabled",!aL);$("#archived-delete").attr("disabled",!aL)});$("#anonymous-addresses").on("show",function(){var aL=$(this);loadScript("wallet/anonymous-addresses.min.js",function(){buildAnonymousTable(aL)})});$("#active-addresses").on("show",function(){var aR=$(this).find("table:first");aR.find("tbody:gt(0)").remove();var aO=aR.find("tbody").empty();for(var aQ in I){var aS=I[aQ];if(aS.tag==2){continue}var aP="";if(aS.tag==1){aP=' <font color="red" class="pop" title="Not Synced" data-content="This is a new address which has not yet been synced with our the server. Do not used this address yet.">(Not Synced)</font>'}else{if(aS.priv==null){aP=' <font color="red" class="pop" title="Watch Only" data-content="Watch Only means there is no private key associated with this bitcoin address. <br /><br /> Unless you have the private key stored elsewhere you do not own the funds at this address and can only observe the transactions.">(Watch Only)</font>'}}var aL="";var aN=aS.addr;if(aS.label!=null){aN=aS.label;aL='<span class="hidden-phone"> - '+aS.addr+"</span>"}var aM=$('<tr><td><div class="short-addr"><a href="'+root+"address/"+aS.addr+'" target="new">'+aN+"</a>"+aL+" "+aP+'<div></td><td><span style="color:green">'+formatMoney(aS.balance,true)+'</span></td>            <td><div class="btn-group pull-right"><a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#"><span class="hidden-phone">Actions </span><span class="caret"></span></a><ul class="dropdown-menu">             <li><a href="#" class="pop act-archive" title="Archive Address" data-content="Click this button to hide the address from the main view. You can restore or delete later by finding it in the Archived addresses tab.">Archive Address</a></li>            <li><a href="#" class="pop act-label" title="Label Address" data-content="Set the label for this address.">Label Address</a></li>            <li><a href="#" class="pop act-qr" title="Show QR Code" data-content="Show a QR Code for this address.">QR Code</a></li>            <li><a href="#" class="pop act-sign" title="Sign Message" data-content="Sign A message with this address.">Sign Message</a></li>            <li><a href="#" class="pop act-request" title="Request Payment" data-content="Click here to create a new QR Code payment request. The QR Code can be scanned using most popular bitcoin software and mobile apps.">Create Payment Request</a></li>            </ul></div></td></tr>');(function(aT){aM.find(".act-archive").click(function(){h.archiveAddr(aT)});aM.find(".act-label").click(function(){loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aT)})});aM.find(".act-qr").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalQRCode(aT)})});aM.find(".act-sign").click(function(){loadScript("wallet/address_modal.min.js",function(){showAddressModalSignMessage(aT)})});aM.find(".act-request").click(function(){loadScript("wallet/frame-modal.js",function(){showFrameModal({title:"Create Payment Request",description:"Request Payment into address <b>"+aT+"</b>",src:root+"payment_request?address="+aT})})})})(aS.addr);if(aS.balance>0&&aS.priv){aR.prepend(aM)}else{aR.append(aM)}}au()});$("#archived-addresses").on("show",function(){$("#enable_archived_checkbox").attr("checked",false);$("#archived-delete").attr("disabled",true);$("#archived-sweep").attr("disabled",true);$("#archived-addr tbody").empty();var aM=$(this).find("tbody");var aL=h.getArchivedAddresses();var aN=function(){aM.empty();for(var aR in aL){var aT=I[aL[aR]];if(aT.tag!=2){continue}var aQ="";if(aT.priv==null){aQ=' <font color="red">(Watch Only)</font>'}var aO="";var aP=aT.addr;if(aT.label!=null){aP=aT.label;aO='<span class="hidden-phone"> - '+aT.addr+"</span>"}var aS=$('<tr><td style="width:20px;"><input type="checkbox" class="archived_checkbox" value="'+aT.addr+'" disabled></td><td><div class="short-addr"><a href="'+root+"address/"+aT.addr+'" target="new">'+aP+"</a>"+aO+" "+aQ+'<div></td><td><span style="color:green">'+formatBTC(aT.balance)+'<span class="hidden-phone"> BTC</span></span></td><td style="width:16px"><img src="'+resource+'unarchive.png" class="act-unarchive" /></td></tr>');(function(aU){aS.find(".act-unarchive").click(function(){h.unArchiveAddr(aU)})})(aT.addr);if(aT.balance>0&&aT.priv){aM.prepend(aS)}else{aM.append(aS)}}};aN();BlockchainAPI.get_balances(aL,function(aO){aN()},function(aO){h.makeNotice("error","misc-error",aO)})});$("#archived-sweep").click(function(){var aL=[];$(".archived_checkbox:checked").each(function(){var aM=I[$(this).val()];if(aM.priv==null){h.makeNotice("error","misc-error","Cannot Sweep Watch Only Address");return}aL.push(aM.addr)});if(aL.length==0){return}O(aL)});$("#archived-delete").click(function(){var aL=[];$(".archived_checkbox:checked").each(function(){aL.push($(this).val())});if(aL.length==0){return}ai(aL)});$("#anonymous-never-ask").click(function(){SetCookie("anonymous-never-ask",$(this).is(":checked"))});$(".deposit-btn").click(function(){var aM=$(this);var aL=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aM.data("title"),description:"Deposit into address <b>"+aL+"</b>",top_right:'Have Questions? Read <a href="'+aM.data("link")+'" target="new">How It Works</a>',src:root+"deposit?address="+aL+"&ptype="+aM.data("type")+"&guid="+M+"&sharedKey="+d})})});$(".withdraw-btn").click(function(){var aL=$(this);h.getSecondPassword(function(){var aM=h.getPreferredAddress();loadScript("wallet/frame-modal.js",function(){showFrameModal({title:aL.data("title"),description:"Your Wallet Balance is <b>"+formatBTC(ap)+" BTC</b>",src:root+"withdraw?method="+aL.data("type")+"&address="+aM+"&balance="+ap+"&guid="+M+"&sharedKey="+d})})})});$("#logout").click(h.logout);$("#refresh").click(function(){J();h.get_history()});$("#summary-n-tx-chart").click(function(){window.open(root+"charts/n-transactions?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-received-chart").click(function(){window.open(root+"charts/received-per-day?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#summary-balance-chart").click(function(){window.open(root+"charts/balance?show_header=false&address="+h.getActiveAddresses().join("|"),null,"scroll=0,status=0,location=0,toolbar=0,width=1000,height=700")});$("#new-addr").click(function(){try{h.getSecondPassword(function(){var aM=h.generateNewKey().getBitcoinAddress().toString();h.makeNotice("info","new-address","Generated new Bitcoin Address "+aM);loadScript("wallet/address_modal.min.js",function(){showLabelAddressModal(aM)});h.backupWallet()})}catch(aL){h.makeNotice("error","misc-error",aL)}});$(".tx_filter a").click(function(){an=0;aj=$(this).data("value");h.get_history()});$(".tx_display a").click(function(){var aL=$(this).data("value");if(aL=="export"){v();return}s.tx_display=aL;c();ad()});$("#email-backup-btn").click(function(){G()});$("#dropbox-backup-btn").click(function(){window.open(root+"wallet/dropbox-login?guid="+M+"&sharedKey="+d)});$("#gdrive-backup-btn").click(function(){window.open(root+"wallet/gdrive-login?guid="+M+"&sharedKey="+d)});$("#large-summary").click(function(){toggleSymbol();c()});$("#send-quick").on("show",function(aN,aM){var aL=$(this);r(aL,aM);aL.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aL,"quick",initNewTx())})})});$("#send-email").on("show",function(aN,aM){var aL=$(this);r(aL,aM);aL.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aL,"email",initNewTx())})})});$("#send-anonymous").on("show",function(aN,aM){var aL=$(this);r(aL,aM);aL.find(".mixer_fee").text(x);aL.find(".fees,.free,.bonus").show();if(x<0){aL.find(".fees,.free").hide()}else{if(x==0){aL.find(".fees,.bonus").hide()}else{aL.find(".free,.bonus").hide()}}aL.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aL,"anonymous",initNewTx())})});aL.find(".anonymous-fees").text("0.00");aL.find('input[name="send-before-fees"]').unbind().bind("keyup change",function(){var aP=parseFloat($.trim($(this).val()));var aO=0;if(aP>0){if(x>0){aO=parseFloat(aP+((aP/100)*x))}else{aO=parseFloat(aP);aL.find(".bonus-value").text(-(Math.min($(this).val(),200)/100)*x)}}if(aP<0.5){aL.find(".anonymous-fees").text("0.00")}else{aL.find(".anonymous-fees").text(aO.toFixed(4))}aL.find('input[name="send-value"]').val(aO).trigger("keyup")})});$("#send-custom").on("show",function(aN,aM){var aL=$(this);r(aL,aM);aL.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){startTxUI(aL,"custom",initNewTx())})});aL.find('select[name="from"]').unbind().change(function(){var aQ=0;var aO=$(this).val();for(var aP in aO){if(aO[aP]=="any"){$(this).val("any");aQ=ap;break}else{var aR=I[aO[aP]];if(aR&&aR.balance){aQ+=aR.balance}}}aL.find(".amount-available").text(formatBTC(aQ))}).trigger("change");aL.find(".reset").unbind().click(function(){r(aL,true);aL.find('select[name="from"]').trigger("change")})});$("#send-satoshi-dice,#send-btcdice-dice").on("show",function(aN,aM){var aL=this;loadScript("wallet/dicegames.min.js",function(){try{DICEGame.init($(aL))}catch(aO){h.makeNotice("error","misc-error","Unable To Load Dice Bets")}},function(aO){h.makeNotice("error","misc-error",aO)})});$("#send-sms").on("show",function(aN,aM){if(aM){return}var aL=$(this);r(aL);$.ajax({type:"GET",url:resource+"wallet/country_codes.html",success:function(aO){aL.find('select[name="sms-country-code"]').html(aO)},error:function(){h.makeNotice("error","misc-error","Error Downloading SMS Country Codes")}});aL.find(".send").unbind().click(function(){loadScript("wallet/signer.min.js",function(){var aO=initNewTx();startTxUI(aL,"sms",aO)})})});$("#address-book").on("show",function(){var aM=$("#address-book-tbl tbody");if(av(g)>0){aM.empty();for(var aL in g){var aN=$("<tr><td>"+g[aL]+'</td><td><div class="addr-book-entry">'+aL+'</div></td><td style="width:16px" class="hidden-phone"><img src="'+resource+'delete.png" class="act-delete" /></td></tr>');(function(aO){aN.find(".act-delete").click(function(){h.deleteAddressBook(aO)})})(aL);aM.append(aN)}}});$('a[data-toggle="tab"]').unbind().on("show",function(aL){$(aL.target.hash).trigger("show")});$("#receive-coins-btn").click(function(){aa($("#receive-coins"))});$(".show_adv").click(function(){$(".modal:visible").center()});$(".download-backup-btn").show();au()}function p(){$(".resend-code").click(function(){h.setGUID(M,true)});$(".download-backup-btn").toggle(ac!=null).click(function(){$(this).attr("download","wallet.aes.json");if(!ac){h.makeNotice("error","error","No Wallet Data to Download");return}var aM=("download" in document.createElement("a"));if(window.Blob&&window.URL&&aM){var aN=new Blob([ac]);var aO=window.URL.createObjectURL(aN);$(this).attr("href",aO)}else{var aL=window.open(null,null,"width=700,height=800,toolbar=0");aL.document.write('<!DOCTYPE html><html><head></head><body><div style="word-wrap:break-word;" >'+ac+"</div></body></html>")}aI()});$(".auth-0,.auth-1,.auth-2,.auth-3,.auth-4,.auth-5").unbind().keypress(function(aL){if(aL.keyCode==13){aL.preventDefault();$("#restore-wallet-continue").click()}});$("#restore-wallet-continue").unbind().click(function(aM){aM.preventDefault();var aL=$.trim($("#restore-guid").val());if(aL.length==0){return}if(M!=aL){h.setGUID(aL,false)}else{a()}});$(".modal").on("show",function(){L();$(this).center()}).on("shown",function(){L();$(this).center()})}function ag(aM){var aN=Crypto.SHA256(aM+"?");switch(aN.slice(0,2)){case"00":var aO=Crypto.SHA256(aM,{asBytes:true});return aO;break;case"01":var aL=Crypto.util.hexToBytes(aN.slice(2,4))[0];var aP=Math.round(Math.pow(2,(aL/4)));var aO=Crypto.PBKDF2(aM,"Satoshi Nakamoto",32,{iterations:aP,asBytes:true});return aO;break;default:console.log("invalid key");break}}function ay(){var aN,aL="";if(window.getSelection){aN=window.getSelection();if(aN.rangeCount){var aO=aN.getRangeAt(0).cloneContents();var aM=document.createElement("div");aM.appendChild(aO);aL=aM.innerText}}else{if(document.selection&&document.selection.type=="Text"){aL=document.selection.createRange().htmlText}}return aL}this.detectPrivateKeyFormat=function(aM){if(/^5[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{50}$/.test(aM)){return"sipa"}if(/^[LK][123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{51}$/.test(aM)){return"compsipa"}if(/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{44}$/.test(aM)||/^[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{43}$/.test(aM)){return"base58"}if(/^[A-Fa-f0-9]{64}$/.test(aM)){return"hex"}if(/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789=+\/]{44}$/.test(aM)){return"base64"}if(/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{21}$/.test(aM)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{25}$/.test(aM)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{29}$/.test(aM)||/^S[123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]{30}$/.test(aM)){var aL=Crypto.SHA256(aM+"?",{asBytes:true});if(aL[0]===0||aL[0]===1){return"mini"}}throw"Unknown Key Format "+aM};this.privateKeyStringToKey=function(aM,aO){var aL=null;if(aO=="base58"){aL=B58.decode(aM)}else{if(aO=="base64"){aL=Crypto.util.base64ToBytes(aM)}else{if(aO=="hex"){aL=Crypto.util.hexToBytes(aM)}else{if(aO=="mini"){aL=ag(aM)}else{if(aO=="sipa"){var aN=B58.decode(aM);aN.shift();aL=aN.slice(0,aN.length-4)}else{if(aO=="sipa"){var aN=B58.decode(aM);aN.shift();aL=aN.slice(0,aN.length-4)}else{if(aO=="compsipa"){var aN=B58.decode(aM);aN.shift();aN.pop();aL=aN.slice(0,aN.length-4)}else{throw"Unsupported Key Format"}}}}}}}if(aL.length!=32){throw"Result not 32 bytes in length"}return new Bitcoin.ECKey(aL)};$(document).ready(function(){if(!$.isEmptyObject({})){h.makeNotice("error","error","Object.prototype has been extended by a browser extension. Please disable this extensions and reload the page.");return}var aM=$(document.body);M=aM.data("guid");d=aM.data("sharedkey");if(h.skip_init){return}try{ac=localStorage.getItem("payload");if(!M||M.length==0){M=localStorage.getItem("guid")}}catch(aO){}if(M&&M.length==36){setTimeout(function(){h.setGUID(M,false)},10)}if(top.location!=self.location){top.location=self.location.href}$("input,button,select").attr("autocomplete","off");aM.ajaxStart(function(){al("loading_start");$(".loading-indicator").fadeIn(200)}).ajaxStop(function(){al("loading_stop");$(".loading-indicator").hide()}).click(function(){if(R){clearTimeout(R);R=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()}).keypress(function(){if(R){clearTimeout(R);R=setTimeout(h.logout,h.getLogoutTime())}rng_seed_time()});p();$(".auth-"+q).show();j=$("#restore-wallet");j.show();var aN=false;var aR=17,aQ=86,aL=67,aP=67;$(document).keydown(function(aT){try{if(aT.keyCode==aR||aT.keyCode==aP){aN=true}if(aN&&aT.keyCode==aL){var aS=$.trim(ay());var aU=I[aS];if(aU!=null){if(aU.priv==null){$("#watch-only-copy-warning-modal").modal("show")}else{if(aU.tag==1){$("#not-synced-warning-modal").modal("show")}}}}}catch(aT){console.log(aT)}}).keyup(function(aS){if(aS.keyCode==aR||aS.keyCode==aP){aN=false}})});this.unArchiveAddr=function(aL){var aL=I[aL];if(aL.tag==2){aL.tag=null;c();ad("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Unarchive This Address")}};this.archiveAddr=function(aL){if(h.getActiveAddresses().length<=1){h.makeNotice("error","add-error","You must leave at least one active address");return}var aL=I[aL];if(aL.tag==null||aL.tag==0){aL.tag=2;c();ad("update",function(){h.get_history()})}else{h.makeNotice("error","add-error","Cannot Archive This Address")}};function aK(){$("#receive-coins").find(".tab-pane.active").trigger("show");setupToggle()}this.addWatchOnlyAddress=function(aL){return aH(aL)};this.addPrivateKey=function(aM,aL){if(ae()){return false}if(aM==null){throw"Unable to generate a new bitcoin address."}if(aL){var aO=aM.getBitcoinAddressCompressed()}else{var aO=aM.getBitcoinAddress()}if(aO==null){throw"Generated invalid bitcoin address."}if(aH(aO.toString(),i(aM.priv))){I[aO].tag=1;try{ws.send('{"op":"addr_sub", "addr":"'+aO+'"}')}catch(aN){}}else{throw"Unable to add generated bitcoin address."}return aO};this.generateNewKey=function(){var aL=new Bitcoin.ECKey(false);if(h.addPrivateKey(aL)){return aL}}};