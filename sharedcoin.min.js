var SharedCoin=new function(){var c=this;var f=0.5;var b=120000;var g=3;var l=0;var k=120000;var m={};var i=3;var j=MyWallet.getSharedcoinEndpoint()+"?version="+i;var e={};var a="sharedcoin-seed:";(function(n){n.retryAjax=function(p){var o;p.tryCount=(!p.tryCount)?0:p.tryCount;p.retryLimit=(!p.retryLimit)?2:p.retryLimit;p.suppressErrors=true;if(p.error){o=p.error;delete p.error}else{o=function(){}}p.complete=function(q,r){if(n.inArray(r,["timeout","abort","error"])>-1){this.tryCount++;if(this.tryCount<=this.retryLimit){if(this.tryCount===this.retryLimit){this.error=o;delete this.suppressErrors}n.ajax(this);return true}return true}};n.ajax(p)}}(jQuery));Bitcoin.Transaction.deserialize=function(w){function o(F){var D,E;D=F.splice(0,1)[0];if(D<253){E=[D]}else{if(D==253){E=F.splice(0,2)}else{if(D==254){E=F.splice(0,4)}else{E=F.splice(0,8)}}}return BigInteger.fromByteArrayUnsigned(E)}function z(D){return new BigInteger(D.splice(0,4).reverse()).intValue()}var y=new Bitcoin.Transaction();y.version=z(w);var s=o(w).intValue();for(var x=0;x<s;x++){var t=w.splice(0,32);var q=Crypto.util.bytesToBase64(t);var n=z(w);var v=o(w).intValue();var A=new Bitcoin.Script(w.splice(0,v));var r=z(w);var B=new Bitcoin.TransactionIn({outpoint:{hash:q,index:n},script:A,sequence:r});y.ins.push(B)}var C=o(w).intValue();for(var x=0;x<C;x++){var p=w.splice(0,8);var v=o(w).intValue();var A=new Bitcoin.Script(w.splice(0,v));var u=new Bitcoin.TransactionOut({script:A,value:p});y.outs.push(u)}y.lock_time=z(w);return y};function h(s,v){var t=[];var o=Math.round(s*1/v);var u=Math.round(0.5*o);var q=0;for(var p=0;p<v;p++){var r=Math.floor((Math.random()*o)+u);if(q+r>s||p==v-1){r=s-q}q+=r;t[p]=r;if(q==s){break}}return t}var d={show:function(){var n=this;n.modal=$("#sharedcoin-modal");n.modal.modal({keyboard:false,backdrop:"static",show:true});n.modal.find(".btn.btn-secondary").unbind().click(function(){n.hide()})},setAddressAndAmount:function(n,o){if(this.modal){this.modal.find(".total_value").text(formatBTC(o));this.modal.find(".address").text(n)}},hide:function(){if(this.modal){this.modal.modal("hide")}},disableCancel:function(){if(this.modal){this.modal.find(".alert-warning").show();this.modal.find(".alert-error").hide();this.modal.find(".btn.btn-secondary").prop("disabled",true)}},enableCancel:function(){if(this.modal){this.modal.find(".alert-error").show();this.modal.find(".alert-warning").hide();this.modal.find(".btn.btn-secondary").prop("disabled",false)}}};this.newProposal=function(){return{_pollForCompleted:function(p,o){var n=this;console.log("Offer._pollForCompleted()");MyWallet.setLoadingText("Waiting For Other Participants To Sign");$.retryAjax({dataType:"json",type:"POST",url:j,timeout:b,retryLimit:4,data:{method:"poll_for_proposal_completed",format:"json",proposal_id:n.proposal_id},success:function(q){p(q)},error:function(q){o(q.responseText)}})},pollForCompleted:function(q,o){var n=this;var p=function(r){if(r.status=="waiting"){n._pollForCompleted(p,o)}else{if(r.status=="not_found"){o("Proposal ID Not Found")}else{if(r.status=="complete"){q(r.tx_hash,r.tx)}else{o("Unknown status "+r.status)}}}};n._pollForCompleted(p,o)}}};this.newOffer=function(){return{offered_outpoints:[],request_outputs:[],offer_id:0,fee_percent:BigInteger.ZERO,submit:function(q,p,n){var o=this;MyWallet.setLoadingText("Submitting Offer");$.retryAjax({dataType:"json",type:"POST",url:j,timeout:b,retryLimit:g,data:{method:"submit_offer",fee_percent:o.fee_percent.toString(),format:"json",token:c.getToken(),offer:JSON.stringify(o)},success:function(r){if(r.status=="complete"){n(r.tx_hash,r.tx)}else{if(!r.offer_id){p("Null offer_id returned")}else{o.offer_id=r.offer_id;q()}}},error:function(r){p(r.responseText)}})},_pollForProposalID:function(p,o){var n=this;console.log("Offer._pollForProposalID()");MyWallet.setLoadingText("Waiting For Other Participants");$.retryAjax({dataType:"json",type:"POST",url:j,timeout:b,retryLimit:g,data:{method:"get_offer_id",format:"json",offer_id:n.offer_id},success:function(q){p(q)},error:function(q){o(q.responseText)}})},calculateFee:function(){var n=this;var q=BigInteger.ZERO;for(var o in n.offered_outpoints){q=q.add(BigInteger.valueOf(n.offered_outpoints[o].value))}var p=BigInteger.ZERO;for(var o in n.request_outputs){p=p.add(BigInteger.valueOf(n.request_outputs[o].value))}return q.subtract(p)},pollForProposalID:function(q,o){var n=this;var p=function(r){if(r.status=="waiting"){n._pollForProposalID(p,o)}else{if(r.status=="not_found"){o("Offer ID Not Found")}else{if(r.status=="active_proposal"){q(r.proposal_id)}else{o("Unknown status "+r.status)}}}};n._pollForProposalID(p,o)},getProposal:function(q,r,p,n){var o=this;console.log("SharedCoin.getProposal()");MyWallet.setLoadingText("Fetching Proposal");$.retryAjax({dataType:"json",type:"POST",url:j,timeout:b,retryLimit:g,data:{method:"get_proposal_id",format:"json",offer_id:o.offer_id,proposal_id:q},success:function(t){var s=c.newProposal();var u=jQuery.extend(s,t);if(u.status=="not_found"){p("Proposal or Offer ID Not Found")}else{if(u.status=="complete"){n(u.tx_hash,u.tx)}else{if(u.status=="signatures_needed"){r(u)}else{if(u.status=="waiting"){o.getProposal(q,r,p,n)}else{p("Unknown get_proposal_id status")}}}}},error:function(s){p(s.responseText)}})},isOutpointOneWeOffered:function(o){var n=this;var q=o.outpoint.hash;var t=Crypto.util.bytesToHex(Crypto.util.base64ToBytes(q).reverse());var p=o.outpoint.index;for(var r in n.offered_outpoints){var s=n.offered_outpoints[r];if(s.hash.toString()==t.toString()&&s.index.toString()==p.toString()){return true}}return false},isOutputOneWeRequested:function(p){var o=this;var t=p.value.slice(0);t.reverse();var n=Crypto.util.bytesToHex(p.script.buffer);var s=new BigInteger(t);for(var q in o.request_outputs){var r=o.request_outputs[q];if(r.script.toString()==n.toString()&&s.toString()==r.value.toString()){return true}}return false},isOutputChange:function(p){var o=this;var t=p.value.slice(0);t.reverse();var n=Crypto.util.bytesToHex(p.script.buffer);var s=new BigInteger(t);for(var q in o.request_outputs){var r=o.request_outputs[q];if(r.script.toString()==n.toString()&&s.toString()==r.value.toString()){return r.exclude_from_fee}}return false},determineOutputsToOfferNextStage:function(t,x,u){var y=this;try{var o=Crypto.util.hexToBytes(t);var q=Bitcoin.Transaction.deserialize(o);var v=[];for(var p=0;p<q.outs.length;++p){var n=q.outs[p];if(y.isOutputOneWeRequested(n)){if(!y.isOutputChange(n)){var s=n.value.slice(0);s.reverse();var w=new BigInteger(s);v.push({hash:null,index:parseInt(p),value:w.toString()})}}}x(v)}catch(r){u(r)}},checkProposal:function(u,w,v){console.log("Offer.checkProposal()");var y=this;try{if(u.tx==null){throw"Proposal Transaction Is Null"}var q=Crypto.util.hexToBytes(u.tx);var s=Bitcoin.Transaction.deserialize(q);if(s==null){throw"Error deserializing transaction"}var x=0;for(var r=0;r<s.outs.length;++r){var p=s.outs[r];if(y.isOutputOneWeRequested(p)){++x}}if(x<y.request_outputs.length){throw"Could not find all our requested outputs ("+x+" < "+y.request_outputs.length+")"}var o=0;for(var r=0;r<u.signature_requests.length;++r){var n=u.signature_requests[r].tx_input_index;if(y.isOutpointOneWeOffered(s.ins[n])){++o}}if(y.offered_outpoints.length!=o){throw"Could not find all our offered outpoints ("+y.offered_outpoints.length+" != "+o+")"}w(s)}catch(t){v(t)}},signNormal:function(n,r,t,q){console.log("Offer.signNormal()");var p=0;var s=[];var o=function(){setTimeout(function(){try{var u=r[p];if(u==null){throw"Null connected script"}var w=signInput(n,u.tx_input_index,u.priv_to_use,u,SIGHASH_ALL);if(w){p++;s.push({tx_input_index:u.tx_input_index,input_script:Crypto.util.bytesToHex(w.buffer),offer_outpoint_index:u.offer_outpoint_index});if(p==r.length){t(s)}else{o()}}else{throw"Unknown error signing transaction"}}catch(v){q(v)}},1)};o()},submitInputScripts:function(q,r,s,p,n){console.log("Offer.submitInputScripts()");var o=this;MyWallet.setLoadingText("Submitting Signatures");l=new Date().getTime();$.retryAjax({dataType:"json",type:"POST",url:j,timeout:b,retryLimit:g,data:{method:"submit_signatures",format:"json",input_scripts:JSON.stringify(r),offer_id:o.offer_id,proposal_id:q.proposal_id},success:function(t){if(t.status=="not_found"){p("Proposal Expired or Not Found")}else{if(t.status=="verification_failed"){p("Signature Verification Failed")}else{if(t.status=="complete"){n(t.tx_hash,t.tx)}else{if(t.status=="signatures_accepted"){s("Signatures Accepted")}else{p("Unknown status "+t.status)}}}}},error:function(t){p(t.responseText)}})},signInputs:function(v,s,y,w){console.log("Offer.signInputs()");var z=this;try{var t={};var o=[];for(var r=0;r<v.signature_requests.length;++r){var q=v.signature_requests[r];var x=new Bitcoin.Script(Crypto.util.hexToBytes(q.connected_script));if(x==null){throw"signInputs() Connected script is null"}x.tx_input_index=q.tx_input_index;x.offer_outpoint_index=q.offer_outpoint_index;var n=x.simpleOutPubKeyHash();var p=new Bitcoin.Address(n).toString();if(t[p]){x.priv_to_use=t[p]}else{if(e[p]){x.priv_to_use=Bitcoin.Base58.decode(e[p])}else{if(MyWallet.addressExists(p)&&!MyWallet.isWatchOnly(p)){x.priv_to_use=MyWallet.decodePK(MyWallet.getPrivateKey(p))}}}if(x.priv_to_use==null){throw"Private key not found"}else{t[p]=x.priv_to_use}o.push(x)}z.signNormal(s,o,function(A){y(A)},function(A){w(A)})}catch(u){w(u)}}}};this.generateAddressAndKeyFromCustomSeed=function(p,s){var r=Crypto.SHA256(p+s,{asBytes:true});var q=new Bitcoin.ECKey(r);if(r[0]%2==0){var o=q.getBitcoinAddress()}else{var o=q.getBitcoinAddressCompressed()}return{address:o,key:q}};this.generateAddressFromCustomSeed=function(p,q){var o=this.generateAddressAndKeyFromCustomSeed(p,q);e[o.address.toString()]=Bitcoin.Base58.encode(o.key.priv);return o.address};this.newPlan=function(){return{offers:[],n_stages:0,c_stage:0,address_seed:null,address_seen_n:0,generated_addresses:[],fee_percent_each_repetition:[],fee_each_repetition:[],generateAddressFromSeed:function(){if(this.address_seed==null){var o=[];o.length=18;new SecureRandom().nextBytes(o);this.address_seed=Crypto.util.bytesToHex(o);MyWallet.addAdditionalSeeds(a+this.address_seed)}var n=c.generateAddressFromCustomSeed(a+this.address_seed,this.address_seen_n);this.address_seen_n++;return n},generateChangeAddress:function(){var o=MyWallet.generateNewKey();var n=o.getBitcoinAddress();this.generated_addresses.push(n.toString());return n},executeOffer:function(p,q,o){function n(s,r){console.log("executeOffer.complete");p.determineOutputsToOfferNextStage(r,function(u){for(var t in u){u[t].hash=s}q(u)},o)}p.submit(function(){console.log("Successfully Submitted Offer");p.pollForProposalID(function(r){console.log("Proposal ID "+r);p.getProposal(r,function(s){console.log("Got Proposal");p.checkProposal(s,function(t){console.log("Proposal Looks Good");p.signInputs(s,t,function(u){console.log("Inputs Signed");p.submitInputScripts(s,u,function(v){console.log("Submitted Input Scripts");s.pollForCompleted(n,o)},o,n)},o)},o)},o,n)},o)},o,n)},execute:function(q,o){var n=this;var p=function(r){n.c_stage=r;var t=n.offers[r];console.log("Executing Stage "+r);var s=function(u){r++;if(r<n.n_stages){n.offers[r].offered_outpoints=u;p(r)}else{if(r==n.n_stages){q()}}};n.executeOffer(t,s,function(u){console.log("executeOffer failed "+u);setTimeout(function(){n.executeOffer(t,s,o)},5000)})};MyWallet.backupWallet("update",function(){console.log("Saved Wallet");var u=MyWallet.getAdditionalSeeds();var t=false;for(var s in u){var r=u[s];if(r.indexOf(n.address_seed)>=0){t=true;break}}if(!t){o("Address Seed Not Found")}else{p(0)}},o)},constructRepetitions:function(s,z,N){try{var K=this;var A=BigInteger.ZERO;for(var O in s.offered_outpoints){A=A.add(BigInteger.valueOf(s.offered_outpoints[O].value))}var q=A;var F=BigInteger.ZERO;for(var G=0;G<K.n_stages-1;++G){var o=c.newOffer();if(G==0){for(var O in s.request_outputs){if(s.request_outputs[O].exclude_from_fee){var D=s.request_outputs.splice(O,1)[0];F=BigInteger.valueOf(D.value);q=q.subtract(F);break}}o.offered_outpoints=s.offered_outpoints.slice(0);s.offered_outpoints=[]}o.fee_percent=K.fee_percent_each_repetition[G];q=q.subtract(K.fee_each_repetition[G]);var x=[10,5,1,0.5,0.3,0.1];var H=8;var S=Math.random();if(q.intValue()>=0.2*satoshi){var L=2;if(S>=0.5){L=3}}else{var L=1}var Q=BigInteger.ZERO;var t=100;if(F.compareTo(BigInteger.ZERO)<0){throw"totalChangeValueLeftToConsume < 0"}else{if(F.compareTo(BigInteger.ZERO)>0){Q=F.divide(BigInteger.valueOf(100)).multiply(BigInteger.valueOf(t))}}console.log("changeValue "+Q.toString());if(Q.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<=0||F.subtract(Q).compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<=0){Q=F;F=BigInteger.ZERO}else{F=F.subtract(Q)}if(F.compareTo(BigInteger.ZERO)<0){throw"totalChangeValueLeftToConsume < 0"}var r=q.add(F);var B=false;for(var p=0;p<1000;++p){for(var I in x){var w=(x[I]/100)*((Math.random()*30)-15);var u=BigInteger.valueOf(Math.round((x[I]+w)*satoshi));var E=r.divideAndRemainder(u);var n=E[0].intValue();if(n>c.getMaximumOfferNumberOfOutputs()){continue}if(n>=L&&n<=H){if(E[1].compareTo(BigInteger.ZERO)==0||E[1].compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))>=0){var C=[];if(E[1].compareTo(BigInteger.ZERO)>0){if(n<=1){if(E[1].compareTo(c.getMinimumInputValue())<0||E[1].compareTo(c.getMaximumOutputValue())>0){continue}var v=K.generateAddressFromSeed();o.request_outputs.push({value:E[1].toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(v).buffer)})}else{C=h(E[1].intValue(),n)}}var R=true;for(var J=0;J<n;++J){var M=u;if(C[J]&&C[J]>0){M=M.add(BigInteger.valueOf(C[J]))}if(M.compareTo(c.getMinimumInputValue())<0||M.compareTo(c.getMaximumOutputValue())>0){R=false;break}}if(!R){continue}for(var J=0;J<n;++J){var v=K.generateAddressFromSeed();var M=u;if(C[J]&&C[J]>0){M=M.add(BigInteger.valueOf(C[J]))}o.request_outputs.push({value:M.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(v).buffer)})}B=true;break}}}if(B){break}}if(!B){var v=K.generateAddressFromSeed();o.request_outputs.push({value:r.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(v).buffer)})}if(Q.compareTo(BigInteger.ZERO)>0){var y=K.generateChangeAddress();if(Q.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 0 ("+Q.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}o.request_outputs.push({value:Q.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(y).buffer),exclude_from_fee:true})}K.offers.push(o)}if(F.compareTo(BigInteger.ZERO)>0){var y=K.generateChangeAddress();if(F.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 1 ("+F.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}s.request_outputs.push({value:F.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(y).buffer),exclude_from_fee:true})}K.offers.push(s);z(K)}catch(P){N(P)}}}};this.getMaximumOfferNumberOfInputs=function(){return m.maximum_offer_number_of_inputs};this.getMaximumOfferNumberOfOutputs=function(){return m.maximum_offer_number_of_outputs};this.getMinimumOutputValue=function(){return m.minimum_output_value};this.getMinimumOutputValueExcludingFee=function(){return m.minimum_output_value_exclude_fee};this.getToken=function(){return m.token};this.getMinimumInputValue=function(){return m.minimum_input_value};this.getMinimumSupportedVersion=function(){return m.min_supported_version};this.getIsEnabled=function(){return m.enabled};this.getMaximumOutputValue=function(){return m.maximum_output_value};this.getFee=function(){return m.fee_percent};this.getMinimumFee=function(){return m.minimum_fee?m.minimum_fee:0};this.constructPlan=function(q,y,F){try{var D=this;var G=q.find('select[name="repetitions"]');var p=q.find('input[name="shared-coin-donate"]').is(":checked");console.log("donate "+p);var A=parseInt(G.val());if(A<=0){throw"invalid number of repetitions"}var s=c.newPlan();function u(N){for(var M in s.generated_addresses){MyWallet.deleteAddress(s.generated_addresses[M])}F(N)}var J=initNewTx();var r=q.find('select[name="from"]');var t=r.val();if(t==null||t=="any"){J.from_addresses=MyWallet.getActiveAddresses()}else{if(r.attr("multiple")=="multiple"){J.from_addresses=t}else{J.from_addresses=[t]}}var z=q.find(".recipient");z.each(function(){try{var T=$(this);var R=T.find('input[name="send-value"]');var O=T.find('input[name="send-to-address"]');var P=0;try{P=precisionToSatoshiBN(R.val());if(P==null||P.compareTo(BigInteger.ZERO)<=0){throw"You must enter a value greater than zero"}}catch(Q){throw"Invalid send amount"}var M=$.trim(O.val()).replace(/[\u200B-\u200D\uFEFF]/g,"");if(M==null||M.length==0){throw"You must enter a bitcoin address for each recipient"}var N=resolveAddress(M);if(N==null||N.length==0){throw"You must enter a bitcoin address for each recipient"}var S=new Bitcoin.Address(N);if(S.version!=0){throw"Sharedcoin only supports sending payments to regular bitcoin addresses"}J.to_addresses.push({address:S,value:P})}catch(Q){u(Q)}});if(J.to_addresses.length==0||J.to_addresses.length<z.length){return}var n=[];var w=[];var I=[];for(var H in J.to_addresses){var L=J.to_addresses[H];n.push(L.value);for(var B=A-1;B>=0;--B){var x=c.getFee();if(B==0&&p){x+=f}I[B]=x;var E=c.calculateFeeForValue(x,L.value);L.value=L.value.add(E);var C=w[B];if(C){w[B]=C.add(E)}else{w[B]=E}}}var v=s.generateAddressFromSeed();J.min_input_confirmations=1;J.do_not_use_unspent_cache=true;J.allow_adjust=false;J.change_address=v;J.base_fee=BigInteger.ZERO;J.min_input_size=BigInteger.valueOf(c.getMinimumInputValue());J.min_free_output_size=BigInteger.valueOf(satoshi);J.fee=BigInteger.ZERO;J.ask_for_fee=function(N,M){M()};var o=c.newOffer();J.addListener({on_error:function(M){u()}});J.signInputs=function(){try{var W=this;if(W.tx.ins.length>c.getMaximumOfferNumberOfInputs()){u("Maximum number of inputs exceeded. Please consolidate some or lower the send amount");return}for(var P=0;P<W.tx.ins.length;++P){var U=W.tx.ins[P];var N=U.outpoint.hash;var T=Crypto.util.bytesToHex(Crypto.util.base64ToBytes(N).reverse());o.offered_outpoints.push({hash:T,index:U.outpoint.index,value:U.outpoint.value.toString()})}for(var P=0;P<W.tx.outs.length;++P){var O=W.tx.outs[P];var S=O.value.slice(0);S.reverse();var V=new BigInteger(S);var M=new Bitcoin.Script(O.script).simpleOutPubKeyHash();var R=new Bitcoin.Address(M).toString();if(R.toString()==v.toString()){if(V.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 3 ("+V.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}o.request_outputs.push({value:V.toString(),script:Crypto.util.bytesToHex(O.script.buffer),exclude_from_fee:true})}else{if(n[P].compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){throw"Output Value Too Small"}o.request_outputs.push({value:n[P].toString(),script:Crypto.util.bytesToHex(O.script.buffer)})}}s.n_stages=A;s.c_stage=0;s.fee_each_repetition=w;s.fee_percent_each_repetition=I;s.constructRepetitions(o,y,function(X){u(X)})}catch(Q){u(Q)}};J.start()}catch(K){u(K)}};this.calculateFeeForValue=function(r,o){var p=BigInteger.valueOf(c.getMinimumFee());if(o.compareTo(BigInteger.ZERO)>0&&r>0){var q=Math.ceil(100/r);var n=o.divide(BigInteger.valueOf(q));if(p.compareTo(n)>0){return p}else{return n}}else{return p}};this.recoverSeeds=function(q,r,t){var u=$("#sharedcoin-recover-progress-modal");var n=u.find(".bar");u.modal("show");n.width("0%");var p=function(x){u.modal("hide");t(x)};var w=function(x){u.modal("hide");r(x)};var o=0;var v=0;function s(){if(!u.is(":visible")){return}if(o>=q.length){if(v>0){MyWallet.get_history();MyWallet.makeNotice("success","misc-success",formatBTC(v)+" recovered from intermediate addresses")}w();return}n.width(((o/q.length)*100)+"%");var z=q[o];++o;var B={};for(var A=0;A<100;++A){var y=c.generateAddressAndKeyFromCustomSeed(z,A);var x=y.address.toString();if(!MyWallet.addressExists(x)){B[x]=y.key}}BlockchainAPI.get_balances(Object.keys(B),function(F){try{var G=0;for(var D in F){var H=F[D].final_balance;if(H>0){console.log("Balance "+D+" = "+H);var C=B[D];var E=C.getBitcoinAddress().toString();try{if(MyWallet.addPrivateKey(C,{compressed:D!=E,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})){console.log("Imported "+D)}}catch(I){console.log("Error importing "+D)}}G+=H}if(G>0){v+=G;MyWallet.backupWalletDelayed("update",function(){setTimeout(s,500)})}else{setTimeout(s,500)}}catch(I){p(I)}},p)}setTimeout(s,100)};this.init=function(p){$("#sharedcoin-recover").unbind().click(function(){var t=$(this);MyWallet.getSecondPassword(function(){t.prop("disabled",true);var x=t.text();t.text("Working. Please Wait...");var y=MyWallet.getAdditionalSeeds();var u=[];for(var w in y){var v=y[w];if(v.indexOf(a)==0){u.push(v)}}c.recoverSeeds(u,function(){t.prop("disabled",false);t.text(x)},function(z){t.prop("disabled",false);t.text(x);MyWallet.makeNotice("error","misc-error",z)})})});var s=p.find(".send");var q=p.find(".send-options");var o=p.find('select[name="repetitions"]');s.unbind().prop("disabled",true);p.find('input[name="send-value"]').bind("keyup change",function(){n()});q.hide();function r(){var t=q.find("span");t.eq(0).text(formatBTC(c.getMaximumOutputValue()));t.eq(1).text(formatBTC(c.getMinimumOutputValue()));t.eq(2).text(c.getFee());t.eq(3).text(formatBTC(c.getMinimumFee()));q.show()}function n(){s.unbind();var u=parseInt(o.val());if(u>0&&c.getIsEnabled()&&i>=c.getMinimumSupportedVersion()){var t=precisionToSatoshiBN(p.find('input[name="send-value"]').val());if(t.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){s.prop("disabled",true)}else{if(t.compareTo(BigInteger.valueOf(c.getMaximumOutputValue()))>0){s.prop("disabled",true)}else{s.prop("disabled",false);s.unbind().click(function(){MyWallet.disableLogout(true);var v=function(y,x){p.find("input,select,button").prop("disabled",false);n();MyWallet.disableLogout(false);MyWallet.makeNotice("error","misc-error",y);setTimeout(function(){if(x&&x.c_stage>=0){console.log("Recover Seeds");d.hide();c.recoverSeeds([a+x.address_seed],function(){d.show()},function(){d.show()})}},1000);d.enableCancel()};var w=function(){p.find("input,select,button").prop("disabled",false);MyWallet.makeNotice("success","misc-success","Sharedcoin Transaction Successfully Completed");MyWallet.disableLogout(false);d.hide();n()};if(t.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){MyWallet.makeNotice("error","misc-error","The Minimum Send Value is "+formatPrecision(c.getMinimumOutputValue()));return}else{if(t.compareTo(BigInteger.valueOf(c.getMaximumOutputValue()))>0){MyWallet.makeNotice("error","misc-error","The Maximum Send Value is "+formatPrecision(c.getMaximumOutputValue()));return}}MyWallet.getSecondPassword(function(){loadScript("wallet/signer",function(){d.show();d.disableCancel();var A=precisionToSatoshiBN(p.find('input[name="send-value"]').val());var y=p.find('input[name="send-to-address"]').val();d.setAddressAndAmount(y,A);p.find("input,select,button").prop("disabled",true);MyWallet.setLoadingText("Constructing Plan. Please Wait.");var x=new Date().getTime()-l;var z=Math.max(0,k-x);if(z>0){$(".loading-indicator").fadeIn(200)}setTimeout(function(){$(".loading-indicator").hide();c.constructPlan(p,function(B){console.log("Created Plan");console.log(B);B.execute(w,function(C){v(C,B)})},v)},z)},v)},v)})}}}else{s.prop("disabled",true)}}MyWallet.setLoadingText("Fetching SharedCoin Info");$.retryAjax({dataType:"json",type:"POST",url:j,timeout:b,retryLimit:g,data:{method:"get_info",format:"json"},success:function(v){try{m=v;if(!c.getIsEnabled()){throw"Shared Coin is currently disabled"}if(i<c.getMinimumSupportedVersion()){throw"Version out of date. Please update your client or reload the page."}r();o.empty();for(var t=v.recommended_min_iterations;t<=v.recommended_max_iterations;t+=1){o.append('<option value="'+(t)+'">'+(t)+" Repetitions</option>")}o.val(v.recommended_iterations)}catch(u){MyWallet.makeNotice("error","misc-error",u)}n()},error:function(t){s.prop("disabled",true);MyWallet.makeNotice("error","misc-error",t.responseText)}});n()}};