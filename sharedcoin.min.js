var SharedCoin=new function(){var c=this;var a=120000;var f=2;(function(k){k.retryAjax=function(m){var l;m.tryCount=(!m.tryCount)?0:m.tryCount;m.retryLimit=(!m.retryLimit)?2:m.retryLimit;m.suppressErrors=true;if(m.error){l=m.error;delete m.error}else{l=function(){}}m.complete=function(n,o){if(k.inArray(o,["timeout","abort","error"])>-1){this.tryCount++;if(this.tryCount<=this.retryLimit){if(this.tryCount===this.retryLimit){this.error=l;delete this.suppressErrors}k.ajax(this);return true}return true}};k.ajax(m)}}(jQuery));Bitcoin.Transaction.deserialize=function(t){function l(C){var A,B;A=C.splice(0,1)[0];if(A<253){B=[A]}else{if(A==253){B=C.splice(0,2)}else{if(A==254){B=C.splice(0,4)}else{B=C.splice(0,8)}}}return BigInteger.fromByteArrayUnsigned(B)}function w(A){return new BigInteger(A.splice(0,4).reverse()).intValue()}var v=new Bitcoin.Transaction();v.version=w(t);var p=l(t).intValue();for(var u=0;u<p;u++){var q=t.splice(0,32);var n=Crypto.util.bytesToBase64(q);var k=w(t);var s=l(t).intValue();var x=new Bitcoin.Script(t.splice(0,s));var o=w(t);var y=new Bitcoin.TransactionIn({outpoint:{hash:n,index:k},script:x,sequence:o});v.ins.push(y)}var z=l(t).intValue();for(var u=0;u<z;u++){var m=t.splice(0,8);var s=l(t).intValue();var x=new Bitcoin.Script(t.splice(0,s));var r=new Bitcoin.TransactionOut({script:x,value:m});v.outs.push(r)}v.lock_time=w(t);return v};var j={};var h=3;var i=MyWallet.getSharedcoinEndpoint()+"?version="+h;var e={};var b="sharedcoin-seed:";function g(p,s){var q=[];var k=Math.round(p*1/s);var r=Math.round(0.5*k);var m=0;for(var l=0;l<s;l++){var o=Math.floor((Math.random()*k)+r);if(m+o>p||l==s-1){o=p-m}m+=o;q[l]=o;if(m==p){break}}return q}var d={show:function(){var k=this;k.modal=$("#sharedcoin-modal");k.modal.modal({keyboard:false,backdrop:"static",show:true});k.modal.find(".btn.btn-secondary").unbind().click(function(){k.hide()})},setAddressAndAmount:function(k,l){if(this.modal){this.modal.find(".total_value").text(formatBTC(l));this.modal.find(".address").text(k)}},hide:function(){if(this.modal){this.modal.modal("hide")}},disableCancel:function(){if(this.modal){this.modal.find(".alert-warning").show();this.modal.find(".alert-error").hide();this.modal.find(".btn.btn-secondary").prop("disabled",true)}},enableCancel:function(){if(this.modal){this.modal.find(".alert-error").show();this.modal.find(".alert-warning").hide();this.modal.find(".btn.btn-secondary").prop("disabled",false)}}};this.newProposal=function(){return{_pollForCompleted:function(m,l){var k=this;console.log("Offer._pollForCompleted()");MyWallet.setLoadingText("Waiting For Other Participants To Sign");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:a,retryLimit:f,data:{method:"poll_for_proposal_completed",format:"json",proposal_id:k.proposal_id},success:function(n){m(n)},error:function(n){l(n.responseText)}})},pollForCompleted:function(n,l){var k=this;var m=function(o){if(o.status=="waiting"){k._pollForCompleted(m,l)}else{if(o.status=="not_found"){l("Proposal ID Not Found")}else{if(o.status=="complete"){n(o.tx_hash,o.tx)}else{l("Unknown status "+o.status)}}}};k._pollForCompleted(m,l)}}};this.newOffer=function(){return{offered_outpoints:[],request_outputs:[],offer_id:0,submit:function(m,l){var k=this;MyWallet.setLoadingText("Submitting Offer");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:a,retryLimit:f,data:{method:"submit_offer",format:"json",token:c.getToken(),offer:JSON.stringify(k)},success:function(n){if(!n.offer_id){l("Null offer_id returned")}else{k.offer_id=n.offer_id;m()}},error:function(n){l(n.responseText)}})},_pollForProposalID:function(m,l){var k=this;console.log("Offer._pollForProposalID()");MyWallet.setLoadingText("Waiting For Other Participants");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:a,retryLimit:f,data:{method:"get_offer_id",format:"json",offer_id:k.offer_id},success:function(n){m(n)},error:function(n){l(n.responseText)}})},calculateFee:function(){var k=this;var n=BigInteger.ZERO;for(var l in k.offered_outpoints){n=n.add(BigInteger.valueOf(k.offered_outpoints[l].value))}var m=BigInteger.ZERO;for(var l in k.request_outputs){m=m.add(BigInteger.valueOf(k.request_outputs[l].value))}return n.subtract(m)},pollForProposalID:function(n,l){var k=this;var m=function(o){if(o.status=="waiting"){k._pollForProposalID(m,l)}else{if(o.status=="not_found"){l("Offer ID Not Found")}else{if(o.status=="active_proposal"){n(o.proposal_id)}else{l("Unknown status "+o.status)}}}};k._pollForProposalID(m,l)},getProposal:function(n,o,m,k){var l=this;console.log("SharedCoin.getProposal()");MyWallet.setLoadingText("Fetching Proposal");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:a,retryLimit:f,data:{method:"get_proposal_id",format:"json",offer_id:l.offer_id,proposal_id:n},success:function(q){var p=c.newProposal();var r=jQuery.extend(p,q);if(r.status=="not_found"){m("Proposal or Offer ID Not Found")}else{if(r.status=="complete"){k(r.tx_hash,r.tx)}else{if(r.status=="signatures_needed"){o(r)}}}},error:function(p){m(p.responseText)}})},isOutpointOneWeOffered:function(l){var k=this;var n=l.outpoint.hash;var q=Crypto.util.bytesToHex(Crypto.util.base64ToBytes(n).reverse());var m=l.outpoint.index;for(var o in k.offered_outpoints){var p=k.offered_outpoints[o];if(p.hash.toString()==q.toString()&&p.index.toString()==m.toString()){return true}}return false},isOutputOneWeRequested:function(m){var l=this;var q=m.value.slice(0);q.reverse();var k=Crypto.util.bytesToHex(m.script.buffer);var p=new BigInteger(q);for(var n in l.request_outputs){var o=l.request_outputs[n];if(o.script.toString()==k.toString()&&p.toString()==o.value.toString()){return true}}return false},isOutputChange:function(m){var l=this;var q=m.value.slice(0);q.reverse();var k=Crypto.util.bytesToHex(m.script.buffer);var p=new BigInteger(q);for(var n in l.request_outputs){var o=l.request_outputs[n];if(o.script.toString()==k.toString()&&p.toString()==o.value.toString()){return o.exclude_from_fee}}return false},determineOutputsToOfferNextStage:function(q,u,r){var v=this;try{var l=Crypto.util.hexToBytes(q);var n=Bitcoin.Transaction.deserialize(l);var s=[];for(var m=0;m<n.outs.length;++m){var k=n.outs[m];if(v.isOutputOneWeRequested(k)){if(!v.isOutputChange(k)){var p=k.value.slice(0);p.reverse();var t=new BigInteger(p);s.push({hash:null,index:parseInt(m),value:t.toString()})}}}u(s)}catch(o){r(o)}},checkProposal:function(r,t,s){console.log("Offer.checkProposal()");var v=this;try{if(r.tx==null){throw"Proposal Transaction Is Null"}var n=Crypto.util.hexToBytes(r.tx);var p=Bitcoin.Transaction.deserialize(n);if(p==null){throw"Error deserializing transaction"}var u=0;for(var o=0;o<p.outs.length;++o){var m=p.outs[o];if(v.isOutputOneWeRequested(m)){++u}}if(u<v.request_outputs.length){throw"Could not find all our requested outputs ("+u+" < "+v.request_outputs.length+")"}var l=0;for(var o=0;o<r.signature_requests.length;++o){var k=r.signature_requests[o].tx_input_index;if(v.isOutpointOneWeOffered(p.ins[k])){++l}}if(v.offered_outpoints.length!=l){throw"Could not find all our offered outpoints ("+v.offered_outpoints.length+" != "+l+")"}t(p)}catch(q){s(q)}},signNormal:function(k,o,q,n){console.log("Offer.signNormal()");var m=0;var p=[];var l=function(){setTimeout(function(){try{var r=o[m];var t=signInput(k,r.tx_input_index,r.priv_to_use,r,SIGHASH_ALL);if(t){m++;p.push({tx_input_index:r.tx_input_index,input_script:Crypto.util.bytesToHex(t.buffer),offer_outpoint_index:r.offer_outpoint_index});if(m==o.length){q(p)}else{l()}}else{throw"Unknown error signing transaction"}}catch(s){n(s)}},1)};l()},submitInputScripts:function(n,o,p,m,k){console.log("Offer.submitInputScripts()");var l=this;MyWallet.setLoadingText("Submitting Signatures");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:a,retryLimit:f,data:{method:"submit_signatures",format:"json",input_scripts:JSON.stringify(o),offer_id:l.offer_id,proposal_id:n.proposal_id},success:function(q){if(q.status=="not_found"){m("Proposal Expired or Not Found")}else{if(q.status=="verification_failed"){m("Signature Verification Failed")}else{if(q.status=="complete"){k(q.tx_hash,q.tx)}else{if(q.status=="signatures_accepted"){p("Signatures Accepted")}else{m("Unknown status "+q.status)}}}}},error:function(q){m(q.responseText)}})},signInputs:function(s,p,v,t){console.log("Offer.signInputs()");var w=this;try{var q={};var l=[];for(var o=0;o<s.signature_requests.length;++o){var n=s.signature_requests[o];var u=new Bitcoin.Script(Crypto.util.hexToBytes(n.connected_script));u.tx_input_index=n.tx_input_index;u.offer_outpoint_index=n.offer_outpoint_index;var k=u.simpleOutPubKeyHash();var m=new Bitcoin.Address(k).toString();if(q[m]){u.priv_to_use=q[m]}else{if(e[m]){u.priv_to_use=Bitcoin.Base58.decode(e[m])}else{if(MyWallet.addressExists(m)&&!MyWallet.isWatchOnly(m)){u.priv_to_use=MyWallet.decodePK(MyWallet.getPrivateKey(m))}}}if(u.priv_to_use==null){throw"Private key not found"}else{q[m]=u.priv_to_use}l.push(u)}w.signNormal(p,l,function(x){v(x)},function(x){t(x)})}catch(r){t(r)}}}};this.generateAddressFromCustomSeed=function(l,p){var o=Crypto.SHA256(l+p,{asBytes:true});var m=new Bitcoin.ECKey(o);if(o[0]%2==0){var k=m.getBitcoinAddress()}else{var k=m.getBitcoinAddressCompressed()}e[k.toString()]=Bitcoin.Base58.encode(m.priv);return k};this.newPlan=function(){return{offers:[],n_stages:0,c_stage:0,address_seed:null,address_seen_n:0,generated_addresses:[],generateAddressFromSeed:function(){if(this.address_seed==null){var l=[];l.length=18;new SecureRandom().nextBytes(l);this.address_seed=Crypto.util.bytesToHex(l);MyWallet.addAdditionalSeeds(b+this.address_seed)}var k=c.generateAddressFromCustomSeed(b+this.address_seed,this.address_seen_n);this.address_seen_n++;return k},generateChangeAddress:function(){var l=MyWallet.generateNewKey();var k=l.getBitcoinAddress();this.generated_addresses.push(k.toString());return k},executeOffer:function(m,n,l){function k(p,o){console.log("executeOffer.complete");m.determineOutputsToOfferNextStage(o,function(r){for(var q in r){r[q].hash=p}n(r)},l)}m.submit(function(){console.log("Successfully Submitted Offer");m.pollForProposalID(function(o){console.log("Proposal ID "+o);m.getProposal(o,function(p){console.log("Got Proposal");m.checkProposal(p,function(q){console.log("Proposal Looks Good");m.signInputs(p,q,function(r){console.log("Inputs Signed");m.submitInputScripts(p,r,function(s){console.log("Submitted Input Scripts");p.pollForCompleted(k,l)},l,k)},l)},l)},l,k)},l)},l)},execute:function(n,l){var k=this;var m=function(o){k.c_stage=o;var q=k.offers[o];console.log("Executing Stage "+o);var p=function(r){o++;if(o<k.n_stages){k.offers[o].offered_outpoints=r;m(o)}else{if(o==k.n_stages){n()}}};k.executeOffer(q,p,function(r){console.log("executeOffer failed "+r);setTimeout(function(){k.executeOffer(q,p,l)},5000)})};MyWallet.backupWallet("update",function(){console.log("Saved Wallet");var r=MyWallet.getAdditionalSeeds();var q=false;for(var p in r){var o=r[p];if(o.indexOf(k.address_seed)>=0){q=true;break}}if(!q){l("Address Seed Not Found")}else{m(0)}},l)},constructRepetitions:function(q,w,x,L){try{var I=this;var y=BigInteger.ZERO;for(var M in q.offered_outpoints){y=y.add(BigInteger.valueOf(q.offered_outpoints[M].value))}var n=y;var D=BigInteger.ZERO;for(var E=0;E<I.n_stages-1;++E){var l=c.newOffer();if(E==0){for(var M in q.request_outputs){if(q.request_outputs[M].exclude_from_fee){var B=q.request_outputs.splice(M,1)[0];D=BigInteger.valueOf(B.value);n=n.subtract(D);break}}l.offered_outpoints=q.offered_outpoints.slice(0);q.offered_outpoints=[]}n=n.subtract(w[E]);var u=[10,5,1,0.5,0.3,0.1];var F=8;var Q=Math.random();if(n.intValue()>=0.2*satoshi){var J=2;if(Q>=0.5){J=3}}else{var J=1}var O=BigInteger.ZERO;var p=100;if(D.compareTo(BigInteger.ZERO)<0){throw"totalChangeValueLeftToConsume < 0"}else{if(D.compareTo(BigInteger.ZERO)>0){O=D.divide(BigInteger.valueOf(100)).multiply(BigInteger.valueOf(p))}}console.log("changeValue "+O.toString());if(O.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<=0||D.subtract(O).compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<=0){O=D;D=BigInteger.ZERO}else{D=D.subtract(O)}if(D.compareTo(BigInteger.ZERO)<0){throw"totalChangeValueLeftToConsume < 0"}var o=n.add(D);var z=false;for(var m=0;m<1000;++m){for(var G in u){var t=(u[G]/100)*((Math.random()*30)-15);var r=BigInteger.valueOf(Math.round((u[G]+t)*satoshi));var C=o.divideAndRemainder(r);var k=C[0].intValue();if(k>c.getMaximumOfferNumberOfOutputs()){continue}if(k>=J&&k<=F){if(C[1].compareTo(BigInteger.ZERO)==0||C[1].compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))>=0){var A=[];if(C[1].compareTo(BigInteger.ZERO)>0){if(k<=1){var s=I.generateAddressFromSeed();if(C[1].compareTo(c.getMinimumInputValue())<0||C[1].compareTo(c.getMaximumOutputValue())>0){continue}l.request_outputs.push({value:C[1].toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(s).buffer)})}else{A=g(C[1].intValue(),k)}}var P=true;for(var H=0;H<k;++H){var K=r;if(A[H]&&A[H]>0){K=K.add(BigInteger.valueOf(A[H]))}if(K.compareTo(c.getMinimumInputValue())<0||K.compareTo(c.getMaximumOutputValue())>0){P=false;break}}if(!P){continue}for(var H=0;H<k;++H){var s=I.generateAddressFromSeed();var K=r;if(A[H]&&A[H]>0){K=K.add(BigInteger.valueOf(A[H]))}l.request_outputs.push({value:K.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(s).buffer)})}z=true;break}}}if(z){break}}if(!z){var s=I.generateAddressFromSeed();l.request_outputs.push({value:o.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(s).buffer)})}if(O.compareTo(BigInteger.ZERO)>0){var v=I.generateChangeAddress();if(O.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 0 ("+O.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}l.request_outputs.push({value:O.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(v).buffer),exclude_from_fee:true})}I.offers.push(l)}if(D.compareTo(BigInteger.ZERO)>0){var v=I.generateChangeAddress();if(D.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 1 ("+D.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}q.request_outputs.push({value:D.toString(),script:Crypto.util.bytesToHex(Script.createOutputScript(v).buffer),exclude_from_fee:true})}I.offers.push(q);x(I)}catch(N){L(N)}}}};this.getMaximumOfferNumberOfInputs=function(){return j.maximum_offer_number_of_inputs};this.getMaximumOfferNumberOfOutputs=function(){return j.maximum_offer_number_of_outputs};this.getMinimumOutputValue=function(){return j.minimum_output_value};this.getMinimumOutputValueExcludingFee=function(){return j.minimum_output_value_exclude_fee};this.getToken=function(){return j.token};this.getMinimumInputValue=function(){return j.minimum_input_value};this.getMinimumSupportedVersion=function(){return j.min_supported_version};this.getIsEnabled=function(){return j.enabled};this.getMaximumOutputValue=function(){return j.maximum_output_value};this.getFee=function(){return j.fee_percent};this.getMinimumFee=function(){return j.minimum_fee?j.minimum_fee:0};this.constructPlan=function(m,t,A){try{var y=this;var B=m.find('select[name="repetitions"]');var v=parseInt(B.val());if(v<=0){throw"invalid number of repetitions"}var o=c.newPlan();function q(H){for(var G in o.generated_addresses){MyWallet.deleteAddress(o.generated_addresses[G])}A(H)}var D=initNewTx();var n=m.find('select[name="from"]');var p=n.val();if(p==null||p=="any"){D.from_addresses=MyWallet.getActiveAddresses()}else{if(n.attr("multiple")=="multiple"){D.from_addresses=p}else{D.from_addresses=[p]}}var u=m.find(".recipient");u.each(function(){try{var M=$(this);var L=M.find('input[name="send-value"]');var I=M.find('input[name="send-to-address"]');var J=0;try{J=precisionToSatoshiBN(L.val());if(J==null||J.compareTo(BigInteger.ZERO)<=0){throw"You must enter a value greater than zero"}}catch(K){throw"Invalid send amount"}var G=$.trim(I.val()).replace(/[\u200B-\u200D\uFEFF]/g,"");if(G==null||G.length==0){throw"You must enter a bitcoin address for each recipient"}var H=resolveAddress(G);if(H==null||H.length==0){throw"You must enter a bitcoin address for each recipient"}D.to_addresses.push({address:new Bitcoin.Address(H),value:J})}catch(K){q(K)}});if(D.to_addresses.length==0||D.to_addresses.length<u.length){return}var k=[];var s=[];for(var C in D.to_addresses){var F=D.to_addresses[C];k.push(F.value);for(var w=v-1;w>=0;--w){var z=c.calculateFeeForValue(F.value);F.value=F.value.add(z);var x=s[w];if(x){s[w]=x.add(z)}else{s[w]=z}}}var r=o.generateAddressFromSeed();D.min_input_confirmations=1;D.allow_adjust=false;D.change_address=r;D.base_fee=BigInteger.ZERO;D.min_input_size=BigInteger.valueOf(c.getMinimumInputValue());D.min_free_output_size=BigInteger.valueOf(satoshi);D.fee=BigInteger.ZERO;D.ask_for_fee=function(H,G){G()};var l=c.newOffer();D.addListener({on_error:function(G){q()}});D.signInputs=function(){try{var Q=this;if(Q.tx.ins.length>c.getMaximumOfferNumberOfInputs()){q("Maximum number of inputs exceeded. Please consolidate some or lower the send amount");return}for(var J=0;J<Q.tx.ins.length;++J){var O=Q.tx.ins[J];var H=O.outpoint.hash;var N=Crypto.util.bytesToHex(Crypto.util.base64ToBytes(H).reverse());l.offered_outpoints.push({hash:N,index:O.outpoint.index,value:O.outpoint.value.toString()})}for(var J=0;J<Q.tx.outs.length;++J){var I=Q.tx.outs[J];var M=I.value.slice(0);M.reverse();var P=new BigInteger(M);var G=new Bitcoin.Script(I.script).simpleOutPubKeyHash();var L=new Bitcoin.Address(G).toString();if(L.toString()==r.toString()){if(P.compareTo(BigInteger.valueOf(c.getMinimumOutputValueExcludingFee()))<0){throw"Change Value Too Small 3 ("+P.toString()+" < "+c.getMinimumOutputValueExcludingFee()+")"}l.request_outputs.push({value:P.toString(),script:Crypto.util.bytesToHex(I.script.buffer),exclude_from_fee:true})}else{if(k[J].compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){throw"Output Value Too Small"}l.request_outputs.push({value:k[J].toString(),script:Crypto.util.bytesToHex(I.script.buffer)})}}o.n_stages=v;o.c_stage=0;o.constructRepetitions(l,s,t,function(R){q(R)})}catch(K){q(K)}};D.start()}catch(E){q(E)}};this.calculateFeeForValue=function(l){var m=BigInteger.valueOf(c.getMinimumFee());if(l.compareTo(BigInteger.ZERO)>0&&c.getFee()>0){var n=Math.ceil(100/c.getFee());var k=l.divide(BigInteger.valueOf(n));if(m.compareTo(k)>0){return m}else{return k}}else{return m}};this.recoverSeeds=function(k,p,l){var m=0;var o=[];function n(){var r=k[m];++m;for(var s=0;s<100;++s){var q=c.generateAddressFromCustomSeed(r,s).toString();o.push(q)}if(m==k.length){while(o.length>0){(function(t){BlockchainAPI.get_balances(t,function(y){try{var z=0;for(var x in y){var v=x;var A=y[v].final_balance;if(A>0){console.log("Balance "+v+" = "+A);var u=new Bitcoin.ECKey(Bitcoin.Base58.decode(e[v]));var w=u.getBitcoinAddress().toString();try{if(MyWallet.addPrivateKey(u,{compressed:v!=w,app_name:IMPORTED_APP_NAME,app_version:IMPORTED_APP_VERSION})){console.log("Imported "+v)}}catch(B){console.log("Error importing "+v)}}z+=A}MyWallet.makeNotice("success","misc-success",formatBTC(z)+" recovered from intermediate addresses");if(z>0){MyWallet.backupWalletDelayed("update",function(){MyWallet.get_history()})}p()}catch(B){l(B)}},l)})(o.splice(0,1000))}}else{setTimeout(n,100)}}setTimeout(n,100)};this.init=function(m){$("#sharedcoin-recover").unbind().click(function(){var q=$(this);MyWallet.getSecondPassword(function(){q.prop("disabled",true);var u=q.text();q.text("Working. Please Wait...");var v=MyWallet.getAdditionalSeeds();var r=[];for(var t in v){var s=v[t];if(s.indexOf(b)==0){r.push(s)}}c.recoverSeeds(r,function(){q.prop("disabled",false);q.text(u)},function(w){q.prop("disabled",false);q.text(u);MyWallet.makeNotice("error","misc-error",w)})})});var p=m.find(".send");var n=m.find(".send-options");var l=m.find('select[name="repetitions"]');p.unbind().prop("disabled",true);m.find('input[name="send-value"]').bind("keyup change",function(){k()});n.hide();function o(){var q=n.find("span");q.eq(0).text(formatBTC(c.getMaximumOutputValue()));q.eq(1).text(formatBTC(c.getMinimumOutputValue()));q.eq(2).text(c.getFee());q.eq(3).text(formatBTC(c.getMinimumFee()));n.show()}function k(){p.unbind();var r=parseInt(l.val());if(r>0&&c.getIsEnabled()&&h>=c.getMinimumSupportedVersion()){var q=precisionToSatoshiBN(m.find('input[name="send-value"]').val());if(q.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){p.prop("disabled",true)}else{if(q.compareTo(BigInteger.valueOf(c.getMaximumOutputValue()))>0){p.prop("disabled",true)}else{p.prop("disabled",false);p.unbind().click(function(){MyWallet.disableLogout(true);var s=function(v,u){m.find("input,select,button").prop("disabled",false);k();MyWallet.disableLogout(false);MyWallet.makeNotice("error","misc-error",v);setTimeout(function(){if(u&&u.c_stage>=0){console.log("Recover Seed");c.recoverSeeds([b+u.address_seed],function(){console.log("Recover Success")},function(){console.log("Recover Error")})}},2000);d.enableCancel()};var t=function(){m.find("input,select,button").prop("disabled",false);MyWallet.makeNotice("success","misc-success","Sharedcoin Transaction Successfully Completed");MyWallet.disableLogout(false);d.hide();k()};if(q.compareTo(BigInteger.valueOf(c.getMinimumOutputValue()))<0){MyWallet.makeNotice("error","misc-error","The Minimum Send Value is "+formatPrecision(c.getMinimumOutputValue()));return}else{if(q.compareTo(BigInteger.valueOf(c.getMaximumOutputValue()))>0){MyWallet.makeNotice("error","misc-error","The Maximum Send Value is "+formatPrecision(c.getMaximumOutputValue()));return}}MyWallet.getSecondPassword(function(){loadScript("wallet/signer",function(){d.show();d.disableCancel();var v=precisionToSatoshiBN(m.find('input[name="send-value"]').val());var u=m.find('input[name="send-to-address"]').val();d.setAddressAndAmount(u,v);m.find("input,select,button").prop("disabled",true);c.constructPlan(m,function(w){console.log("Created Plan");console.log(w);w.execute(t,function(x){s(x,w)})},s)},s)},s)})}}}else{p.prop("disabled",true)}}if($.isEmptyObject(j)){MyWallet.setLoadingText("Fetching SharedCoin Info");$.retryAjax({dataType:"json",type:"POST",url:i,timeout:a,retryLimit:f,data:{method:"get_info",format:"json"},success:function(s){try{j=s;if(!c.getIsEnabled()){throw"Shared Coin is currently disabled"}if(h<c.getMinimumSupportedVersion()){throw"Version out of date. Please update your client or reload the page."}o();l.empty();for(var q=s.recommended_min_iterations;q<=s.recommended_max_iterations;q+=1){l.append('<option value="'+(q)+'">'+(q)+" Repetitions</option>")}l.val(s.recommended_iterations)}catch(r){MyWallet.makeNotice("error","misc-error",r)}k()},error:function(q){p.prop("disabled",true);MyWallet.makeNotice("error","misc-error",q.responseText)}})}else{o()}k()}};