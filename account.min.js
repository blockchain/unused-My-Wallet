function updateKV(d,b,a,c,e){if(!isInitialized||offline){return}if(a==null||a.length==0){makeNotice("error","misc-error",d+": Invalid value");return}if(sharedKey==null||sharedKey.length==0||sharedKey.length!=36){makeNotice("error","misc-error","Shared key is invalid");return}a=$.trim(a);setLoadingText(d);$.post("/wallet",{guid:guid,sharedKey:sharedKey,length:(a+"").length,payload:a+"",method:b,format:"plain"},function(f){makeNotice("success",b+"-success",f);if(c){c()}}).error(function(f){makeNotice("error",b+"-error",f.responseText);if(e){e()}})}function setDoubleEncryptionButton(){if(double_encryption){$(".double-encryption-off").hide();$(".double-encryption-on").show()}else{$(".double-encryption-on").hide();$(".double-encryption-off").show()}$("#double-password").val("");$("#double-password2").val("")}function setDoubleEncryption(a){var f=function(g){console.log("Panic "+g);window.location.reload()};try{if(double_encryption==a){return}if(a){var c=$("#double-password").val();var b=$("#double-password2").val();if(c==null||c.length==0||c.length<4||c.length>255){makeNotice("error","misc-error","Password must be 4 characters or more in length");return}if(c!=b){makeNotice("error","misc-error","Passwords do not match.");return}if(c==password){makeNotice("error","misc-error","Second password should not be the same as your main password.");return}getSecondPassword(function(){try{double_encryption=true;dpassword=c;for(var l in addresses){var k=addresses[l];if(k.priv!=null){k.priv=encodePK(B58.decode(k.priv))}}var h=Crypto.SHA256(sharedKey+dpassword,{asBytes:true});for(var g=1;g<pbkdf2_iterations;++g){h=Crypto.SHA256(h,{asBytes:true})}dpasswordhash=Crypto.util.bytesToHex(h);dpassword=null;getSecondPassword(function(){try{checkAllKeys();backupWallet("update",function(){setDoubleEncryptionButton()},function(){f(i)})}catch(i){f(i)}},function(){f()})}catch(j){f(j)}},function(){f()})}else{getSecondPassword(function(){try{for(var i in addresses){var h=addresses[i];if(h.priv!=null){h.priv=decryptPK(h.priv)}}double_encryption=false;dpassword=null;checkAllKeys();backupWallet("update",function(){setDoubleEncryptionButton()},function(){f(g)})}catch(g){f(g)}},function(){f()})}}catch(d){f(d)}}function getAccountInfo(){if(!isInitialized||offline){return}setLoadingText("Getting Wallet Info");$.post("/wallet",{guid:guid,sharedKey:sharedKey,method:"get-info"},function(d){if(d.email!=null){$("#wallet-email").val(d.email);$(".my-email").text(d.email)}$("#wallet-phrase").val(d.phrase);$("#two-factor-select").val(d.auth_type);$(".two-factor").hide();$(".two-factor.t"+d.auth_type).show(200);var c=$("#notifications-type");c.find(":checkbox").prop("checked",false);c.find('[class^="type"]').hide();for(var b in d.notifications_type){var a=d.notifications_type[b];console.log(a);c.find(':checkbox[value="'+a+'"]').prop("checked",true);c.find(".type-"+a).show()}$("#notifications-confirmations").val(d.notifications_confirmations);$("#notifications-on").val(d.notifications_on);if(d.alias!=null&&d.alias.length>0){$("#wallet-alias").val(d.alias);$(".alias").text("https://blockchain.info/wallet/"+d.alias);$(".alias").show(200)}loadScript(resource+"wallet/qr.code.creator.js",function(){try{var g=makeQRCode(300,300,1,guid+"|"+sharedKey+"|"+password);$("#device-qr-code").empty().append(g);if(d.google_secret_url!=null&&d.google_secret_url.length>0){var f=makeQRCode(300,300,1,d.google_secret_url);$("#wallet-google-qr").empty().append(f)}}catch(h){makeNotice("error","misc-error",h)}});if(d.auto_email_backup==1){$("#auto-email-backup").prop("checked",true)}else{$("#auto-email-backup").prop("checked",false)}$("#wallet-http-url").val(d.http_url);$("#wallet-http-url").val(d.http_url);$("#wallet-skype").val(d.skype_username);$("#wallet-yubikey").val(d.yubikey);if(d.password_hint1){$("#password-hint1").val(d.password_hint1)}if(d.password_hint2){$("#password-hint2").val(d.password_hint2)}$("#ip-lock").val(d.ip_lock);$("#my-ip").text(d.my_ip);if(d.ip_lock_on==1){$("#ip-lock-on").prop("checked",true)}else{$("#ip-lock-on").prop("checked",false)}if(d.email_verified==0){$("#verify-email").show();$("#email-verified").hide()}else{$("#verify-email").hide();$("#email-verified").show()}$("#my-ip").text(d.my_ip);$(".wallet-sms").val(d.sms_number);if(d.sms_verified==0){$(".sms-unverified").show();$(".sms-verified").hide()}else{$(".sms-verified").show().trigger("show");$(".sms-unverified").hide()}$.get(resource+"wallet/country_codes.html").success(function(e){$(".wallet-sms-country-codes").html(e)}).error(function(){makeNotice("error","misc-error","Error Downloading SMS Country Codes")})}).error(function(a){makeNotice("error","misc-error",a.responseText)})}function bindAccountButtons(){var a=$("#notifications-type");a.find(":checkbox").unbind().change(function(){var b=[];a.find(":checkbox:checked").each(function(){b.push($(this).val())});if(!b.length){b.push(0)}updateKV("Updating Notifications Type","update-notifications-type",b.join("|"));a.find(".type-"+$(this).val()).toggle();queryAPIMultiAddress()});$("#password-hint1").unbind().change(function(){updateKV("Updating Main Password Hint","update-password-hint1",$(this).val())});$("#password-hint2").unbind().change(function(){updateKV("Updating Second Password Hint","update-password-hint2",$(this).val())});$("#ip-lock-on").unbind().change(function(){updateKV("Updating IP Lock","update-ip-lock-on",$(this).is(":checked"))});$("#ip-lock").unbind().change(function(){updateKV("Updating Locked Ip Addresses","update-ip-lock",$(this).val())});$("#notifications-on").unbind().change(function(){updateKV("Updating Notifications Settings","update-notifications-on",$(this).val())});$("#auto-email-backup").unbind().change(function(){updateKV("Updating Auto Backup Settings","update-auto-email-backup",$(this).is(":checked"))});$("#two-factor-select").unbind().change(function(){var b=parseInt($(this).val());updateKV("Updating Two Factor Authentication","update-auth-type",b,function(){if(b==4){getAccountInfo()}updateCacheManifest()});$(".two-factor").hide(200);$(".two-factor.t"+b).show(200)});$("#wallet-email-send").click(function(){$("#wallet-email").trigger("change")});$("#wallet-email").unbind().change(function(c){var b=$(this).val();if(!validateEmail(b)){makeNotice("error","misc-error","Email address is not valid");return}updateKV("Updating Email","update-email",b);$("#verify-email").show(200);$("#email-verified").hide()});$("#wallet-double-encryption-enable").click(function(b){setDoubleEncryption(true)});$("#wallet-double-encryption-disable").click(function(b){setDoubleEncryption(false)});$("#wallet-email-code").unbind().change(function(b){if(!isInitialized||offline){return}var c=$(this).val();if(c==null||c.length==0||c.length>255){makeNotice("error","misc-error","You must enter a code to verify");return}c=$.trim(c);setLoadingText("Verifying Email");$.post("/wallet",{guid:guid,payload:c,sharedKey:sharedKey,length:c.length,method:"verify-email"},function(d){makeNotice("success","misc-success",d);$("#verify-email").hide();$("#email-verified").show(200)}).error(function(d){makeNotice("error","misc-error",d.responseText);$("#verify-email").show(200);$("#email-verified").hide()})});$(".wallet-sms-code").unbind().change(function(b){var c=$(this).val();if(c==null||c.length==0||c.length>255){makeNotice("error","misc-error","You must enter an SMS code to verify");return}c=$.trim(c);setLoadingText("Verifying SMS Code");$.post("/wallet",{guid:guid,payload:c,sharedKey:sharedKey,length:c.length,method:"verify-sms"},function(d){makeNotice("success","misc-success",d);$(".sms-unverified").hide();$(".sms-verified").show(200).trigger("show")}).error(function(d){makeNotice("error","misc-error",d.responseText);$(".sms-verified").hide();$(".sms-unverified").show(200)})});$(".wallet-sms").unbind().change(function(c){var b=$.trim($(this).val());if(b==null||b.length==0){return}if(b.charAt(0)=="0"){b=b.substring(1)}if(b.charAt(0)!="+"){b="+"+$(".wallet-sms-country-codes").val()+b}updateKV("Updating Cell Number","update-sms",b);$(".sms-unverified").show(200);$(".sms-verified").hide()});$("#run-key-check").click(function(){getSecondPassword(function(){try{checkAllKeys(true);backupWallet()}catch(b){makeNotice("error","misc-error",b)}})});$("#local_currency").unbind().change(function(){if(symbol!=symbol_local){toggleSymbol()}updateKV("Updating Local Currency","update-country",$(this).val(),function(){queryAPIMultiAddress()})});$("#notifications-confirmations").unbind().change(function(b){updateKV("Updating Notification Confirmations","update-notifications-confirmations",$(this).val())});$("#wallet-yubikey").unbind().change(function(b){updateKV("Updating Yubikey","update-yubikey",$(this).val())});$("#wallet-skype").unbind().change(function(b){updateKV("Updating Skype Username","update-skype",$(this).val())});$("#wallet-http-url").unbind().change(function(b){updateKV("Updating HTTP url","update-http-url",$(this).val())});$("#wallet-phrase").unbind().change(function(c){var b=$(this).val();if(b==null||b.length==0||b.length>255){makeNotice("error","misc-error","You must enter a secret phrase");return}updateKV("Updating Secret Phrase","update-phrase",b)});$("#wallet-alias").unbind().change(function(b){$(this).val($(this).val().replace(/[\.,\/ #!$%\^&\*;:{}=`~()]/g,""));if($(this).val().length>0){$(".alias").fadeIn(200);$(".alias").text("https://blockchain.info/wallet/"+$(this).val())}updateKV("Updating Alias","update-alias",$(this).val())})};